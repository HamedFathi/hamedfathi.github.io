<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>A Professional ASP.NET Core API - External APIs - Hamed Fathi&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Hamed Fathi&#039;s Blog"><meta name="msapplication-TileImage" content="/img/pic.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Hamed Fathi&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="In many projects we want to call external APIs and use their results in our application. In this article, we will address the following:  HttpClientFactory Refit Polly"><meta property="og:type" content="blog"><meta property="og:title" content="A Professional ASP.NET Core API - External APIs"><meta property="og:url" content="https://hamedfathi.github.io/a-professional-asp.net-core-api-external-apis/"><meta property="og:site_name" content="Hamed Fathi&#039;s Blog"><meta property="og:description" content="In many projects we want to call external APIs and use their results in our application. In this article, we will address the following:  HttpClientFactory Refit Polly"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://hamedfathi.github.io/img/og_image.png"><meta property="article:published_time" content="2020-09-03T00:00:00.000Z"><meta property="article:modified_time" content="2023-07-28T08:36:42.658Z"><meta property="article:author" content="Hamed Fathi"><meta property="article:tag" content="dotnet"><meta property="article:tag" content="aspnetcore"><meta property="article:tag" content="webapi"><meta property="article:tag" content="api"><meta property="article:tag" content="polly"><meta property="article:tag" content="refit"><meta property="article:tag" content="resiliency"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://hamedfathi.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hamedfathi.github.io/a-professional-asp.net-core-api-external-apis/"},"headline":"A Professional ASP.NET Core API - External APIs","image":["https://hamedfathi.github.io/img/og_image.png"],"datePublished":"2020-09-03T00:00:00.000Z","dateModified":"2023-07-28T08:36:42.658Z","author":{"@type":"Person","name":"Hamed Fathi"},"publisher":{"@type":"Organization","name":"Hamed Fathi's Blog","logo":{"@type":"ImageObject"}},"description":"In many projects we want to call external APIs and use their results in our application. In this article, we will address the following:  HttpClientFactory Refit Polly"}</script><link rel="canonical" href="https://hamedfathi.github.io/a-professional-asp.net-core-api-external-apis/"><link rel="icon" href="/img/pic.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Hamed Fathi&#039;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/hamedfathi"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-09-03T00:00:00.000Z" title="9/3/2020, 12:00:00 AM">2020-09-03</time></span><span class="level-item"><a class="link-muted" href="/categories/aspnetcore-api/">aspnetcore-api</a></span></div></div><h1 class="title is-3 is-size-4-mobile">A Professional ASP.NET Core API - External APIs</h1><div class="content"><p>In many projects we want to call external APIs and use their results in our application. In this article, we will address the following:</p>
<ul>
<li>HttpClientFactory</li>
<li>Refit</li>
<li>Polly</li>
</ul>
<span id="more"></span>

<h2 id="HttpClientFactory"><a href="#HttpClientFactory" class="headerlink" title="HttpClientFactory"></a>HttpClientFactory</h2><p>Microsoft introduced the <code>HttpClient</code> in .Net Framework 4.5 and is the most popular way to consume a Web API in your .NET server-side code. But it has some serious issues like disposing the HttpClient object doesn’t close the socket immediately, too many instances affecting the performance and Singleton HttpClient or shared HttpClient instance not respecting the DNS Time to Live (TTL) settings. <code>HttpClientFactory</code> solves the all these problems. It is one of the newest feature of ASP.NET Core 2.1. It provides a central location for naming and configuring and consuming logical HttpClients in your application, and this post talks about 3 ways to use HTTPClientFactory in ASP.NET Core 2.1.</p>
<p>There are 3 different ways to use it and we’ll see an example of each of them.</p>
<ul>
<li>Using HttpClientFactory Directly</li>
<li>Named Clients</li>
<li>Typed Clients</li>
</ul>
<p><strong>Using HttpClientFactory Directly</strong></p>
<p> you’ll always have to register the HttpClient in <code>ConfigureServices</code> method of the <code>Startup.cs</code> class. The following line of code registers HttpClient with no special configuration.</p>
 <figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Startup.ConfigureServices</span><br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><br>&#123;<br>    services.AddControllers();<br><br>	<span class="hljs-comment">// HERE</span><br>    services.AddHttpClient();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>You can use it in the following way in the API controller.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ValuesController</span> : <span class="hljs-title">Controller</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IHttpClientFactory _httpClientFactory;<br>  <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ValuesController</span>(<span class="hljs-params">IHttpClientFactory httpClientFactory</span>)</span><br>    &#123;<br>        _httpClientFactory = httpClientFactory;<br>    &#125;<br>  <br>    [<span class="hljs-meta">HttpGet</span>]<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;ActionResult&gt; <span class="hljs-title">Get</span>(<span class="hljs-params"></span>)</span><br>    &#123;<br>        <span class="hljs-keyword">var</span> client = _httpClientFactory.CreateClient();<br>        client.BaseAddress = <span class="hljs-keyword">new</span> Uri(<span class="hljs-string">&quot;http://api.github.com&quot;</span>);<br>        <span class="hljs-built_in">string</span> result = <span class="hljs-keyword">await</span> client.GetStringAsync(<span class="hljs-string">&quot;/&quot;</span>);<br>        <span class="hljs-keyword">return</span> Ok(result);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>Named Clients</strong></p>
<p>The basic use of HTTPClientFactory in above example is ideal in a situation where you need to make a quick request from a single place in the code. When you need to make multiple requests from multiple places from your code, “Named Clients” will help you. With named clients, you can define the HTTP client with some pre-configured settings which will be applied when creating the HttpClient. Like,</p>
 <figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Startup.ConfigureServices</span><br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><br>&#123;<br>    services.AddControllers();<br><br>	<span class="hljs-comment">// HERE</span><br>    services.AddHttpClient();<br>    services.AddHttpClient(<span class="hljs-string">&quot;github&quot;</span>, c =&gt;<br>    &#123;<br>        c.BaseAddress = <span class="hljs-keyword">new</span> Uri(<span class="hljs-string">&quot;https://api.github.com/&quot;</span>);<br>        c.DefaultRequestHeaders.Add(<span class="hljs-string">&quot;Accept&quot;</span>, <span class="hljs-string">&quot;application/vnd.github.v3+json&quot;</span>);<br>        c.DefaultRequestHeaders.Add(<span class="hljs-string">&quot;User-Agent&quot;</span>, <span class="hljs-string">&quot;HttpClientFactory-Sample&quot;</span>);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>
<p> Here we call <code>AddHttpClient</code> twice, once with the name “github” and once without. The github client has some default configuration applied, namely the base address and two headers required to work with the GitHub API. The overload of <code>AddHttpClient</code> method accepts two parameters, a name and an Action delegate taking a HttpClient which allows us to configure the HttpClient.</p>
<p>You can use named client in the following way in the API controller.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ValuesController</span> : <span class="hljs-title">Controller</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IHttpClientFactory _httpClientFactory;<br>  <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ValuesController</span>(<span class="hljs-params">IHttpClientFactory httpClientFactory</span>)</span><br>    &#123;<br>        _httpClientFactory = httpClientFactory;<br>    &#125;<br>  <br>    [<span class="hljs-meta">HttpGet</span>]<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;ActionResult&gt; <span class="hljs-title">Get</span>(<span class="hljs-params"></span>)</span><br>    &#123;<br>        <span class="hljs-keyword">var</span> client = _httpClientFactory.CreateClient(<span class="hljs-string">&quot;github&quot;</span>);<br>        <span class="hljs-built_in">string</span> result = <span class="hljs-keyword">await</span> client.GetStringAsync(<span class="hljs-string">&quot;/&quot;</span>);<br>        <span class="hljs-keyword">return</span> Ok(result);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Here, we are passing the registered name of the client in <code>CreateClient()</code> method to create HttpClient. This is useful as the default configuration defined at the time of registration will be pre-applied when we ask for a named client.</p>
<p><strong>Typed Client</strong></p>
<p> Using Typed clients, you can define pre-configuration for your HttpClient inside a custom class. This custom class can be registered as Typed client, and later when needed, it can be injected via the calling class constructor. I prefer Typed Client for the following reasons,</p>
<ul>
<li>Flexible approach compare to named clients.</li>
<li>You no longer have to deal with strings (like in named clients).</li>
<li>You can encapsulate the HTTP calls and all logic dealing with that endpoint.</li>
</ul>
<p>Let’s see an example. Below is a custom class defined for Github client.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GitHubClient</span><br>&#123;<br>    <span class="hljs-keyword">public</span> HttpClient Client &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GitHubClient</span>(<span class="hljs-params">HttpClient httpClient</span>)</span><br>    &#123;<br>        httpClient.BaseAddress = <span class="hljs-keyword">new</span> Uri(<span class="hljs-string">&quot;https://api.github.com/&quot;</span>);<br>        httpClient.DefaultRequestHeaders.Add(<span class="hljs-string">&quot;Accept&quot;</span>, <span class="hljs-string">&quot;application/vnd.github.v3+json&quot;</span>);<br>        httpClient.DefaultRequestHeaders.Add(<span class="hljs-string">&quot;User-Agent&quot;</span>, <span class="hljs-string">&quot;HttpClientFactory-Sample&quot;</span>);<br>        Client = httpClient;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>You can register this as a typed client using the following line.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cs">services.AddHttpClient&lt;GitHubClient&gt;();<br></code></pre></td></tr></table></figure>

<p>And, use it in the following way in the API controller.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ValuesController</span> : <span class="hljs-title">Controller</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> GitHubClient _gitHubClient;;<br>  <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ValuesController</span>(<span class="hljs-params">GitHubClient gitHubClient</span>)</span><br>    &#123;<br>        _gitHubClient = gitHubClient;<br>    &#125;<br>  <br>    [<span class="hljs-meta">HttpGet</span>]<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;ActionResult&gt; <span class="hljs-title">Get</span>(<span class="hljs-params"></span>)</span><br>    &#123;<br>        <span class="hljs-built_in">string</span> result = <span class="hljs-keyword">await</span> _gitHubClient.client.GetStringAsync(<span class="hljs-string">&quot;/&quot;</span>);<br>        <span class="hljs-keyword">return</span> Ok(result);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>This works great. There is another better way of making typed client work. Here, the HttpClient is exposed directly, but you can encapsulate the HttpClient entirely using the following way. First, define a contract for the <code>GitHubClient</code>.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IGitHubClient</span><br>&#123;<br>    <span class="hljs-function">Task&lt;<span class="hljs-built_in">string</span>&gt; <span class="hljs-title">GetData</span>(<span class="hljs-params"></span>)</span>;<br>&#125;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GitHubClient</span> : <span class="hljs-title">IGitHubClient</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> HttpClient _client;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GitHubClient</span>(<span class="hljs-params">HttpClient httpClient</span>)</span><br>    &#123;<br>        httpClient.BaseAddress = <span class="hljs-keyword">new</span> Uri(<span class="hljs-string">&quot;https://api.github.com/&quot;</span>);<br>        httpClient.DefaultRequestHeaders.Add(<span class="hljs-string">&quot;Accept&quot;</span>, <span class="hljs-string">&quot;application/vnd.github.v3+json&quot;</span>);<br>        httpClient.DefaultRequestHeaders.Add(<span class="hljs-string">&quot;User-Agent&quot;</span>, <span class="hljs-string">&quot;HttpClientFactory-Sample&quot;</span>);<br>        _client = httpClient;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-built_in">string</span>&gt; <span class="hljs-title">GetData</span>(<span class="hljs-params"></span>)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> _client.GetStringAsync(<span class="hljs-string">&quot;/&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Register this as a typed client using the following line.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cs">services.AddHttpClient&lt;IGitHubClient, GitHubClient&gt;();<br></code></pre></td></tr></table></figure>

<p>And, use it in the following way in the API controller.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ValuesController</span> : <span class="hljs-title">Controller</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IGitHubClient _gitHubClient;;<br>     <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ValuesController</span>(<span class="hljs-params">IGitHubClient gitHubClient</span>)</span><br>    &#123;<br>        _gitHubClient = gitHubClient;<br>    &#125;<br>     <br>    [<span class="hljs-meta">HttpGet</span>]<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;ActionResult&gt; <span class="hljs-title">Get</span>(<span class="hljs-params"></span>)</span><br>    &#123;<br>        <span class="hljs-built_in">string</span> result = <span class="hljs-keyword">await</span> _gitHubClient.GetData();<br>        <span class="hljs-keyword">return</span> Ok(result);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>This approach also makes unit testing easy while testing HttpClients as you no longer have to mock them.</p>
<h2 id="Refit"><a href="#Refit" class="headerlink" title="Refit"></a>Refit</h2><p>Refit is a library heavily inspired by <code>Square&#39;s Retrofit</code> library, and it turns your REST API into a live interface:</p>
<p>Install below packages</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Install-Package refit -Version 5.2.1<br>dotnet add package refit --version 5.2.1<br>&lt;PackageReference Include=<span class="hljs-string">&quot;refit&quot;</span> Version=<span class="hljs-string">&quot;5.2.1&quot;</span> /&gt;<br><br>Install-Package Refit.HttpClientFactory -Version 5.2.1<br>dotnet add package Refit.HttpClientFactory --version 5.2.1<br>&lt;PackageReference Include=<span class="hljs-string">&quot;Refit.HttpClientFactory&quot;</span> Version=<span class="hljs-string">&quot;5.2.1&quot;</span> /&gt;<br><br>Install-Package Newtonsoft.Json -Version 12.0.3<br>dotnet add package Newtonsoft.Json --version 12.0.3<br>&lt;PackageReference Include=<span class="hljs-string">&quot;Newtonsoft.Json&quot;</span> Version=<span class="hljs-string">&quot;12.0.3&quot;</span> /&gt;<br></code></pre></td></tr></table></figure>

<p>Suppose in our project we want to call the following address to get comprehensive information about the <code>country</code> we want.</p>
<p>The documentation and how to call it is as follows:</p>
<p><strong>Doc</strong>: <a target="_blank" rel="noopener" href="https://restcountries.eu/">https://restcountries.eu/</a></p>
<p><strong>API</strong>: <a target="_blank" rel="noopener" href="https://restcountries.eu/rest/v2/name/usa">https://restcountries.eu/rest/v2/name/usa</a></p>
<p>Based on the documentation and results provided as an example, we want to have a strongly typed output so I used <a target="_blank" rel="noopener" href="https://json2csharp.com/">json2csharp</a> to convert <code>JSON</code> to <code>C#</code> but I made some changes to the result like the following:</p>
<ul>
<li>Replace all <code>int</code> with <code>double</code></li>
<li>Removed <code>Root</code> class</li>
<li>Changed <code>MyArray</code> to <code>Country</code></li>
</ul>
<p><code>JsonProperty</code> uses for <code>Newtonsoft.Json</code> library but if you want to use the new <code>System.Text.Json</code> library, you should change it to <code>JsonPropertyName</code>.</p>
<p><strong>C# Class</strong></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Currency</span><br>&#123;<br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;code&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Code &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;name&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;symbol&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Symbol &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Language</span><br>&#123;<br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;iso639_1&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Iso6391 &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;iso639_2&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Iso6392 &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;name&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;nativeName&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> NativeName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Translations</span><br>&#123;<br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;de&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> De &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;es&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Es &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;fr&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Fr &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;ja&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Ja &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;it&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> It &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;br&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Br &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;pt&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Pt &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;nl&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Nl &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;hr&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Hr &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;fa&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Fa &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Country</span><br>&#123;<br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;name&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;topLevelDomain&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> List&lt;<span class="hljs-built_in">string</span>&gt; TopLevelDomain &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;alpha2Code&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Alpha2Code &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;alpha3Code&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Alpha3Code &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;callingCodes&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> List&lt;<span class="hljs-built_in">string</span>&gt; CallingCodes &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;capital&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Capital &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;altSpellings&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> List&lt;<span class="hljs-built_in">string</span>&gt; AltSpellings &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;region&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Region &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;subregion&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Subregion &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;population&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> Population &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;latlng&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> List&lt;<span class="hljs-built_in">double</span>&gt; Latlng &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;demonym&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Demonym &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;area&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> Area &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;gini&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">object</span> Gini &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;timezones&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> List&lt;<span class="hljs-built_in">string</span>&gt; Timezones &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;borders&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> List&lt;<span class="hljs-built_in">object</span>&gt; Borders &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;nativeName&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> NativeName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;numericCode&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> NumericCode &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;currencies&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> List&lt;Currency&gt; Currencies &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;languages&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> List&lt;Language&gt; Languages &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;translations&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> Translations Translations &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;flag&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Flag &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;regionalBlocs&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> List&lt;<span class="hljs-built_in">object</span>&gt; RegionalBlocs &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    [<span class="hljs-meta">JsonProperty(<span class="hljs-meta-string">&quot;cioc&quot;</span>)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Cioc &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Now, We want to use <code>Refit</code> to fetch data so write the following interface.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">ICountryApi</span><br>&#123;<br>    <span class="hljs-comment">// You have to start the URL with &#x27;/&#x27;</span><br>    [<span class="hljs-meta">Get(<span class="hljs-meta-string">&quot;/&#123;version&#125;/name/&#123;country&#125;&quot;</span>)</span>]<br>    Task&lt;List&lt;Country&gt;&gt; GetCountry(<span class="hljs-built_in">string</span> version,<span class="hljs-built_in">string</span> country);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>And write your base address in <code>appsettings.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// appsettings.json</span><br><span class="hljs-comment">// Don&#x27;t use &#x27;/&#x27; at the end of the URL.</span><br><span class="hljs-string">&quot;MyRefitOptions&quot;</span>: &#123;<br>  <span class="hljs-attr">&quot;BaseAddress&quot;</span>: <span class="hljs-string">&quot;https://restcountries.eu/rest&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>Register <code>Refit</code> client like below</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><br>&#123;<br>    services.AddControllers();<br>    <br>    services.AddRefitClient&lt;ICountryApi&gt;(settings)<br>            .ConfigureHttpClient(c =&gt; c.BaseAddress = <span class="hljs-keyword">new</span> Uri(Configuration[<span class="hljs-string">&quot;MyRefitOptions:BaseAddress&quot;</span>]))                         <br>            ;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Use it inside a controller as following</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cs">[<span class="hljs-meta">ApiController</span>]<br>[<span class="hljs-meta">Route(<span class="hljs-meta-string">&quot;[controller]&quot;</span>)</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CountryController</span> : <span class="hljs-title">ControllerBase</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ICountryApi _countryApi;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CountryController</span>(<span class="hljs-params">ICountryApi countryApi</span>)</span><br>    &#123;<br>        _countryApi = countryApi;<br>    &#125;<br><br>    [<span class="hljs-meta">HttpGet</span>]<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;Country&gt; <span class="hljs-title">Get</span>(<span class="hljs-params"></span>)</span><br>    &#123;<br>        <span class="hljs-keyword">var</span> countries = _countryApi.GetCountry(<span class="hljs-string">&quot;v2&quot;</span>, <span class="hljs-string">&quot;usa&quot;</span>).GetAwaiter().GetResult();<br>        <span class="hljs-keyword">return</span> countries;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Using-Refit-with-the-System-Text-Json"><a href="#Using-Refit-with-the-System-Text-Json" class="headerlink" title="Using Refit with the System.Text.Json"></a>Using Refit with the System.Text.Json</h2><p>Using <code>Refit</code> with the new System.Text.Json APIs in .NET Core 3.0 to boost performance:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">using</span> System.Text.Json;<br><br><span class="hljs-keyword">var</span> options = <span class="hljs-keyword">new</span> JsonSerializerOptions()<br>&#123;<br>    PropertyNamingPolicy = JsonNamingPolicy.CamelCase,                <br>    WriteIndented = <span class="hljs-literal">true</span>,<br>&#125;;<br><br><span class="hljs-keyword">var</span> settings = <span class="hljs-keyword">new</span> RefitSettings()<br>&#123;<br>    ContentSerializer = <span class="hljs-keyword">new</span> SystemTextJsonContentSerializer(options)<br>&#125;;<br><br>services.AddRefitClient&lt;ICountryApi&gt;(settings <span class="hljs-comment">/*HERE*/</span>)<br>        .ConfigureHttpClient(c =&gt; c.BaseAddress = <span class="hljs-keyword">new</span> Uri(Configuration[<span class="hljs-string">&quot;MyRefitOptions:BaseAddress&quot;</span>]))                         <br>        ;<br></code></pre></td></tr></table></figure>

<h2 id="Polly"><a href="#Polly" class="headerlink" title="Polly"></a>Polly</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Install-Package Polly -Version 7.2.1<br>dotnet add package Polly --version 7.2.1<br>&lt;PackageReference Include=<span class="hljs-string">&quot;Polly&quot;</span> Version=<span class="hljs-string">&quot;7.2.1&quot;</span> /&gt;<br></code></pre></td></tr></table></figure>

<p><code>Polly</code> is a .NET resilience and transient-fault-handling library that allows developers to express policies such as <code>Retry</code>, <code>Circuit Breaker</code>, <code>Timeout</code>, <code>Bulkhead Isolation</code>, and <code>Fallback</code> in a fluent and thread-safe manner.</p>
<p>There are many topics in which you can use <code>Polly</code> and for this you should refer to its <a target="_blank" rel="noopener" href="https://github.com/App-vNext/Polly">site</a>. But one of the most important reasons for using <code>Polly</code> is the <code>retry</code> process.</p>
<p><strong>Retry</strong></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Retry once</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .Retry()<br><br><span class="hljs-comment">// Retry multiple times</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .Retry(<span class="hljs-number">3</span>)<br><br><span class="hljs-comment">// Retry multiple times, calling an action on each retry </span><br><span class="hljs-comment">// with the current exception and retry count</span><br>Policy<br>    .Handle&lt;SomeExceptionType&gt;()<br>    .Retry(<span class="hljs-number">3</span>, onRetry: (exception, retryCount) =&gt;<br>    &#123;<br>        <span class="hljs-comment">// Add logic to be executed before each retry, such as logging</span><br>    &#125;);<br><br><span class="hljs-comment">// Retry multiple times, calling an action on each retry </span><br><span class="hljs-comment">// with the current exception, retry count and context </span><br><span class="hljs-comment">// provided to Execute()</span><br>Policy<br>    .Handle&lt;SomeExceptionType&gt;()<br>    .Retry(<span class="hljs-number">3</span>, onRetry: (exception, retryCount, context) =&gt;<br>    &#123;<br>        <span class="hljs-comment">// Add logic to be executed before each retry, such as logging </span><br>    &#125;);<br></code></pre></td></tr></table></figure>

<p><strong>Retry forever (until succeeds)</strong></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Retry forever</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .RetryForever()<br><br><span class="hljs-comment">// Retry forever, calling an action on each retry with the </span><br><span class="hljs-comment">// current exception</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .RetryForever(onRetry: exception =&gt;<br>  &#123;<br>        <span class="hljs-comment">// Add logic to be executed before each retry, such as logging       </span><br>  &#125;);<br><br><span class="hljs-comment">// Retry forever, calling an action on each retry with the</span><br><span class="hljs-comment">// current exception and context provided to Execute()</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .RetryForever(onRetry: (exception, context) =&gt;<br>  &#123;<br>        <span class="hljs-comment">// Add logic to be executed before each retry, such as logging       </span><br>  &#125;);<br></code></pre></td></tr></table></figure>

<p><strong>Wait and retry</strong></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Retry, waiting a specified duration between each retry. </span><br><span class="hljs-comment">// (The wait is imposed on catching the failure, before making the next try.)</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .WaitAndRetry(<span class="hljs-keyword">new</span>[]<br>  &#123;<br>    TimeSpan.FromSeconds(<span class="hljs-number">1</span>),<br>    TimeSpan.FromSeconds(<span class="hljs-number">2</span>),<br>    TimeSpan.FromSeconds(<span class="hljs-number">3</span>)<br>  &#125;);<br><br><span class="hljs-comment">// Retry, waiting a specified duration between each retry, </span><br><span class="hljs-comment">// calling an action on each retry with the current exception</span><br><span class="hljs-comment">// and duration</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .WaitAndRetry(<span class="hljs-keyword">new</span>[]<br>  &#123;<br>    TimeSpan.FromSeconds(<span class="hljs-number">1</span>),<br>    TimeSpan.FromSeconds(<span class="hljs-number">2</span>),<br>    TimeSpan.FromSeconds(<span class="hljs-number">3</span>)<br>  &#125;, (exception, timeSpan) =&gt; &#123;<br>    <span class="hljs-comment">// Add logic to be executed before each retry, such as logging    </span><br>  &#125;); <br><br><span class="hljs-comment">// Retry, waiting a specified duration between each retry, </span><br><span class="hljs-comment">// calling an action on each retry with the current exception, </span><br><span class="hljs-comment">// duration and context provided to Execute()</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .WaitAndRetry(<span class="hljs-keyword">new</span>[]<br>  &#123;<br>    TimeSpan.FromSeconds(<span class="hljs-number">1</span>),<br>    TimeSpan.FromSeconds(<span class="hljs-number">2</span>),<br>    TimeSpan.FromSeconds(<span class="hljs-number">3</span>)<br>  &#125;, (exception, timeSpan, context) =&gt; &#123;<br>    <span class="hljs-comment">// Add logic to be executed before each retry, such as logging    </span><br>  &#125;);<br><br><span class="hljs-comment">// Retry, waiting a specified duration between each retry, </span><br><span class="hljs-comment">// calling an action on each retry with the current exception, </span><br><span class="hljs-comment">// duration, retry count, and context provided to Execute()</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .WaitAndRetry(<span class="hljs-keyword">new</span>[]<br>  &#123;<br>    TimeSpan.FromSeconds(<span class="hljs-number">1</span>),<br>    TimeSpan.FromSeconds(<span class="hljs-number">2</span>),<br>    TimeSpan.FromSeconds(<span class="hljs-number">3</span>)<br>  &#125;, (exception, timeSpan, retryCount, context) =&gt; &#123;<br>    <span class="hljs-comment">// Add logic to be executed before each retry, such as logging    </span><br>  &#125;);<br><br><span class="hljs-comment">// Retry a specified number of times, using a function to </span><br><span class="hljs-comment">// calculate the duration to wait between retries based on </span><br><span class="hljs-comment">// the current retry attempt (allows for exponential backoff)</span><br><span class="hljs-comment">// In this case will wait for</span><br><span class="hljs-comment">//  2 ^ 1 = 2 seconds then</span><br><span class="hljs-comment">//  2 ^ 2 = 4 seconds then</span><br><span class="hljs-comment">//  2 ^ 3 = 8 seconds then</span><br><span class="hljs-comment">//  2 ^ 4 = 16 seconds then</span><br><span class="hljs-comment">//  2 ^ 5 = 32 seconds</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .WaitAndRetry(<span class="hljs-number">5</span>, retryAttempt =&gt; <br>	TimeSpan.FromSeconds(Math.Pow(<span class="hljs-number">2</span>, retryAttempt)) <br>  );<br><br><span class="hljs-comment">// Retry a specified number of times, using a function to </span><br><span class="hljs-comment">// calculate the duration to wait between retries based on </span><br><span class="hljs-comment">// the current retry attempt, calling an action on each retry </span><br><span class="hljs-comment">// with the current exception, duration and context provided </span><br><span class="hljs-comment">// to Execute()</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .WaitAndRetry(<br>    <span class="hljs-number">5</span>, <br>    retryAttempt =&gt; TimeSpan.FromSeconds(Math.Pow(<span class="hljs-number">2</span>, retryAttempt)), <br>    (exception, timeSpan, context) =&gt; &#123;<br>      <span class="hljs-comment">// Add logic to be executed before each retry, such as logging</span><br>    &#125;<br>  );<br><br><span class="hljs-comment">// Retry a specified number of times, using a function to </span><br><span class="hljs-comment">// calculate the duration to wait between retries based on </span><br><span class="hljs-comment">// the current retry attempt, calling an action on each retry </span><br><span class="hljs-comment">// with the current exception, duration, retry count, and context </span><br><span class="hljs-comment">// provided to Execute()</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .WaitAndRetry(<br>    <span class="hljs-number">5</span>, <br>    retryAttempt =&gt; TimeSpan.FromSeconds(Math.Pow(<span class="hljs-number">2</span>, retryAttempt)), <br>    (exception, timeSpan, retryCount, context) =&gt; &#123;<br>      <span class="hljs-comment">// Add logic to be executed before each retry, such as logging</span><br>    &#125;<br>  );<br></code></pre></td></tr></table></figure>

<p><strong>Wait and retry forever (until succeeds)</strong></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Wait and retry forever</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .WaitAndRetryForever(retryAttempt =&gt; <br>	TimeSpan.FromSeconds(Math.Pow(<span class="hljs-number">2</span>, retryAttempt))<br>    );<br><br><span class="hljs-comment">// Wait and retry forever, calling an action on each retry with the </span><br><span class="hljs-comment">// current exception and the time to wait</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .WaitAndRetryForever(<br>    retryAttempt =&gt; TimeSpan.FromSeconds(Math.Pow(<span class="hljs-number">2</span>, retryAttempt)),    <br>    (exception, timespan) =&gt;<br>    &#123;<br>        <span class="hljs-comment">// Add logic to be executed before each retry, such as logging       </span><br>    &#125;);<br><br><span class="hljs-comment">// Wait and retry forever, calling an action on each retry with the</span><br><span class="hljs-comment">// current exception, time to wait, and context provided to Execute()</span><br>Policy<br>  .Handle&lt;SomeExceptionType&gt;()<br>  .WaitAndRetryForever(<br>    retryAttempt =&gt; TimeSpan.FromSeconds(Math.Pow(<span class="hljs-number">2</span>, retryAttempt)),    <br>    (exception, timespan, context) =&gt;<br>    &#123;<br>        <span class="hljs-comment">// Add logic to be executed before each retry, such as logging       </span><br>    &#125;);<br></code></pre></td></tr></table></figure>

<p>Therefore, according to the above examples, we can implement our scenario as follows to see if the requested country is valid or not.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">using</span> Polly;<br><span class="hljs-keyword">using</span> System.Net;<br><span class="hljs-keyword">using</span> System.Net.Http;<br><br>[<span class="hljs-meta">ApiController</span>]<br>[<span class="hljs-meta">Route(<span class="hljs-meta-string">&quot;[controller]&quot;</span>)</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CountryController</span> : <span class="hljs-title">ControllerBase</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IHttpClientFactory _httpClientFactory;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CountryController</span>(<span class="hljs-params">IHttpClientFactory httpClientFactory</span>)</span><br>    &#123;<br>        _httpClientFactory = httpClientFactory;<br>    &#125;<br><br>    <span class="hljs-comment">// http://localhost:5000/Country?country=usa</span><br>    <span class="hljs-comment">// Result: true</span><br>    [<span class="hljs-meta">HttpGet</span>]<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-built_in">bool</span>&gt; <span class="hljs-title">IsValid</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> country</span>)</span><br>    &#123;<br>        <span class="hljs-keyword">var</span> retryPolicy = Policy<br>            .Handle&lt;HttpRequestException&gt;()<br>            .WaitAndRetryAsync(<span class="hljs-number">5</span>, _ =&gt; TimeSpan.FromSeconds(<span class="hljs-number">2</span>));<br><br>        <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">await</span> retryPolicy.ExecuteAsync(<span class="hljs-keyword">async</span> () =&gt;<br>        &#123;<br>            <span class="hljs-keyword">var</span> status = <span class="hljs-keyword">await</span> _httpClientFactory.CreateClient().GetAsync(<span class="hljs-string">$&quot;https://restcountries.eu/rest/v2/name/<span class="hljs-subst">&#123;country&#125;</span>&quot;</span>).ConfigureAwait(<span class="hljs-literal">false</span>);<br>            <span class="hljs-keyword">return</span> status.StatusCode == HttpStatusCode.OK;<br>        &#125;);<br><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Polly-amp-HttpClientFactory"><a href="#Polly-amp-HttpClientFactory" class="headerlink" title="Polly &amp; HttpClientFactory"></a>Polly &amp; HttpClientFactory</h2><p>The following steps show how you can use Http retries with <code>Polly</code> integrated into <code>IHttpClientFactory</code>, which is explained in the previous section.</p>
<p>Install the below package</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Install-Package Microsoft.Extensions.Http.Polly -Version 3.1.8<br>dotnet add package Microsoft.Extensions.Http.Polly --version 3.1.8<br>&lt;PackageReference Include=<span class="hljs-string">&quot;Microsoft.Extensions.Http.Polly&quot;</span> Version=<span class="hljs-string">&quot;3.1.8&quot;</span> /&gt;<br></code></pre></td></tr></table></figure>

<p>Register your <code>Polly</code> policy to <code>HttpClient</code> client</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><br>&#123;<br>    services.AddControllers(); <br><br>    <span class="hljs-comment">// HERE           </span><br>    AsyncRetryPolicy&lt;HttpResponseMessage&gt; retryPolicy = HttpPolicyExtensions<br>        .HandleTransientHttpError()<br>        .OrResult(msg =&gt; msg.StatusCode == System.Net.HttpStatusCode.NotFound)<br>        .WaitAndRetryAsync(<span class="hljs-number">6</span>, retryAttempt =&gt; TimeSpan.FromSeconds(Math.Pow(<span class="hljs-number">2</span>, retryAttempt)));<br><br>    services.AddHttpClient&lt;IBasketService, BasketService&gt;()<br>        .SetHandlerLifetime(TimeSpan.FromMinutes(<span class="hljs-number">5</span>))  <span class="hljs-comment">//Set lifetime to five minutes</span><br>        .AddPolicyHandler(retryPolicy); <span class="hljs-comment">// HERE</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Polly-amp-Refit"><a href="#Polly-amp-Refit" class="headerlink" title="Polly &amp; Refit"></a>Polly &amp; Refit</h2><p>Install the below package</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Install-Package Microsoft.Extensions.Http.Polly -Version 3.1.8<br>dotnet add package Microsoft.Extensions.Http.Polly --version 3.1.8<br>&lt;PackageReference Include=<span class="hljs-string">&quot;Microsoft.Extensions.Http.Polly&quot;</span> Version=<span class="hljs-string">&quot;3.1.8&quot;</span> /&gt;<br></code></pre></td></tr></table></figure>

<p>Register your <code>Polly</code> policy to <code>Refit</code> client</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><br>&#123;<br>    services.AddControllers(); <br><br>    <span class="hljs-comment">// HERE           </span><br>    AsyncRetryPolicy&lt;HttpResponseMessage&gt; retryPolicy = HttpPolicyExtensions<br>        .HandleTransientHttpError()<br>        .Or&lt;TimeoutRejectedException&gt;() <span class="hljs-comment">// Thrown by Polly&#x27;s TimeoutPolicy if the inner call gets     timeout.</span><br>        .OrResult(msg =&gt; msg.StatusCode == System.Net.HttpStatusCode.NotFound)<br>        .WaitAndRetryAsync(<span class="hljs-number">6</span>, retryAttempt =&gt; TimeSpan.FromSeconds(Math.Pow(<span class="hljs-number">2</span>, retryAttempt)));<br><br>    <span class="hljs-keyword">var</span> options = <span class="hljs-keyword">new</span> JsonSerializerOptions()<br>    &#123;<br>        PropertyNamingPolicy = JsonNamingPolicy.CamelCase,                <br>        WriteIndented = <span class="hljs-literal">true</span>,<br>    &#125;;<br><br>    <span class="hljs-keyword">var</span> settings = <span class="hljs-keyword">new</span> RefitSettings()<br>    &#123;<br>        ContentSerializer = <span class="hljs-keyword">new</span> SystemTextJsonContentSerializer(options)<br>    &#125;;<br>    services.AddRefitClient&lt;ICountryApi&gt;(settings)<br>        .ConfigureHttpClient(c =&gt; c.BaseAddress = <span class="hljs-keyword">new</span> Uri(Configuration[<span class="hljs-string">&quot;MyRefitOptions:BaseAddress&quot;</span>]))<br>        .AddPolicyHandler(retryPolicy) <span class="hljs-comment">/*HERE*/</span><br>        ;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Reference-s"><a href="#Reference-s" class="headerlink" title="Reference(s)"></a>Reference(s)</h2><p>Most of the information in this article has gathered from various references.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://json2csharp.com/">https://json2csharp.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/App-vNext/Polly">https://github.com/App-vNext/Polly</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/reactiveui/refit">https://github.com/reactiveui/refit</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/19balazs86/PlayingWithRefit">https://github.com/19balazs86/PlayingWithRefit</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/App-vNext/Polly.Extensions.Http">https://github.com/App-vNext/Polly.Extensions.Http</a></li>
<li><a target="_blank" rel="noopener" href="https://anthonygiretti.com/2019/08/31/building-a-typed-httpclient-with-refit-in-asp-net-core-3/">https://anthonygiretti.com/2019/08/31/building-a-typed-httpclient-with-refit-in-asp-net-core-3/</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.martincostello.com/refit-and-system-text-json/">https://blog.martincostello.com/refit-and-system-text-json/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.talkingdotnet.com/3-ways-to-use-httpclientfactory-in-asp-net-core-2-1/">https://www.talkingdotnet.com/3-ways-to-use-httpclientfactory-in-asp-net-core-2-1/</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/implement-resilient-applications/implement-http-call-retries-exponential-backoff-polly">https://docs.microsoft.com/en-us/dotnet/architecture/microservices/implement-resilient-applications/implement-http-call-retries-exponential-backoff-polly</a></li>
</ul>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/dotnet/">dotnet</a><a class="link-muted mr-2" rel="tag" href="/tags/aspnetcore/">aspnetcore</a><a class="link-muted mr-2" rel="tag" href="/tags/webapi/">webapi</a><a class="link-muted mr-2" rel="tag" href="/tags/api/">api</a><a class="link-muted mr-2" rel="tag" href="/tags/polly/">polly</a><a class="link-muted mr-2" rel="tag" href="/tags/refit/">refit</a><a class="link-muted mr-2" rel="tag" href="/tags/resiliency/">resiliency</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/a-professional-asp.net-core-api-background-task/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">A Professional ASP.NET Core API - Background Task</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/using-puppeteer-with-mocha-or-jest-and-aurelia-2/"><span class="level-item">Using Puppeteer with Mocha/Jest and Aurelia 2</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/pic.png" alt="Hamed Fathi"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Hamed Fathi</p><p class="is-size-6 is-block">Senior Software Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Austria</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">30</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">86</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://twitter.com/Hamed__Fathi" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/hamedfathi"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/hamedfathi"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/Hamed__Fathi"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="StackOverflow" href="https://stackoverflow.com/users/3166171/hamedfathi"><i class="fab fa-stack-overflow"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/hamedfathi88"><i class="fab fa-facebook"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/aspnetcore/"><span class="level-start"><span class="level-item">aspnetcore</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/aspnetcore-api/"><span class="level-start"><span class="level-item">aspnetcore-api</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/aurelia/"><span class="level-start"><span class="level-item">aurelia</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/dotnet/"><span class="level-start"><span class="level-item">dotnet</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/amqp/"><span class="tag">amqp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/api/"><span class="tag">api</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aspnetcore/"><span class="tag">aspnetcore</span><span class="tag">22</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aurelia2/"><span class="tag">aurelia2</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/awesome/"><span class="tag">awesome</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/backgroundtask/"><span class="tag">backgroundtask</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binding/"><span class="tag">binding</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bogus/"><span class="tag">bogus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bootstrap5/"><span class="tag">bootstrap5</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cache/"><span class="tag">cache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/caching/"><span class="tag">caching</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chai/"><span class="tag">chai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cors/"><span class="tag">cors</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp9/"><span class="tag">csharp9</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css-in-js/"><span class="tag">css-in-js</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/default-interface-method/"><span class="tag">default-interface-method</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/di/"><span class="tag">di</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/distributed/"><span class="tag">distributed</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dotnet/"><span class="tag">dotnet</span><span class="tag">26</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dotnet5/"><span class="tag">dotnet5</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dryioc/"><span class="tag">dryioc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/e2e/"><span class="tag">e2e</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/easynetq/"><span class="tag">easynetq</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/emotionjs/"><span class="tag">emotionjs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/end-to-end/"><span class="tag">end-to-end</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/exception/"><span class="tag">exception</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/extension-method/"><span class="tag">extension-method</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fakedata/"><span class="tag">fakedata</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/feature/"><span class="tag">feature</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featureflag/"><span class="tag">featureflag</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featuremanagement/"><span class="tag">featuremanagement</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/file/"><span class="tag">file</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fluentvalidation/"><span class="tag">fluentvalidation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/guard/"><span class="tag">guard</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/header/"><span class="tag">header</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/health/"><span class="tag">health</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/healthcheck/"><span class="tag">healthcheck</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/healthy/"><span class="tag">healthy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hostedservices/"><span class="tag">hostedservices</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/inmemory/"><span class="tag">inmemory</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ioc/"><span class="tag">ioc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jest/"><span class="tag">jest</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lerna/"><span class="tag">lerna</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/localization/"><span class="tag">localization</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log/"><span class="tag">log</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/masstransit/"><span class="tag">masstransit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/messagebroker/"><span class="tag">messagebroker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/middleware/"><span class="tag">middleware</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/miniprofiler/"><span class="tag">miniprofiler</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mixon/"><span class="tag">mixon</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mocha/"><span class="tag">mocha</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/model/"><span class="tag">model</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/modelbinding/"><span class="tag">modelbinding</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/monorepository/"><span class="tag">monorepository</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openapi/"><span class="tag">openapi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pagination/"><span class="tag">pagination</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/paging/"><span class="tag">paging</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pipeline/"><span class="tag">pipeline</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/plugin/"><span class="tag">plugin</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/polly/"><span class="tag">polly</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/profiler/"><span class="tag">profiler</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/puppeteer/"><span class="tag">puppeteer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/queue/"><span class="tag">queue</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rabbitmq/"><span class="tag">rabbitmq</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ratelimit/"><span class="tag">ratelimit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/refit/"><span class="tag">refit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/request/"><span class="tag">request</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/resiliency/"><span class="tag">resiliency</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/response/"><span class="tag">response</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/roslyn/"><span class="tag">roslyn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rss/"><span class="tag">rss</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sourcegenerator/"><span class="tag">sourcegenerator</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sqlserver/"><span class="tag">sqlserver</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swagger/"><span class="tag">swagger</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tailwindcss/"><span class="tag">tailwindcss</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/test/"><span class="tag">test</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testdata/"><span class="tag">testdata</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unhealthy/"><span class="tag">unhealthy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/upload/"><span class="tag">upload</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/validation/"><span class="tag">validation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/versioning/"><span class="tag">versioning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webapi/"><span class="tag">webapi</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webpack/"><span class="tag">webpack</span><span class="tag">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-28T00:00:00.000Z">2023-07-28</time></p><p class="title"><a href="/the-dotnet-world-mixin/">The .NET World - Mixin</a></p><p class="categories"><a href="/categories/dotnet/">dotnet</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-12-08T00:00:00.000Z">2020-12-08</time></p><p class="title"><a href="/the-dotnet-world-csharp-source-generator/">The .NET World - C# Source Generator</a></p><p class="categories"><a href="/categories/dotnet/">dotnet</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-09T00:00:00.000Z">2020-11-09</time></p><p class="title"><a href="/write-a-custom-plugin-with-aurelia-2-and-lerna/">Write a custom plugin with Aurelia 2 and Lerna</a></p><p class="categories"><a href="/categories/aurelia/">aurelia</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-10-23T00:00:00.000Z">2020-10-23</time></p><p class="title"><a href="/a-professional-asp.net-core-api-rabbitmq/">A Professional ASP.NET Core API - RabbitMQ</a></p><p class="categories"><a href="/categories/aspnetcore-api/">aspnetcore-api</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-10-22T00:00:00.000Z">2020-10-22</time></p><p class="title"><a href="/a-professional-asp.net-core-rss/">A Professional ASP.NET Core - RSS</a></p><p class="categories"><a href="/categories/aspnetcore/">aspnetcore</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">July 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Hamed Fathi&#039;s Blog</a><p class="is-size-7"><span>&copy; 2023 Hamed Fathi</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>