<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>A Professional ASP.NET Core - Middleware - Hamed Fathi&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Hamed Fathi&#039;s Blog"><meta name="msapplication-TileImage" content="/img/pic.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Hamed Fathi&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Middleware is software that’s assembled into an app pipeline to handle requests and responses. Each component:  Chooses whether to pass the request to the next component in the pipeline. Can perform w"><meta property="og:type" content="blog"><meta property="og:title" content="A Professional ASP.NET Core - Middleware"><meta property="og:url" content="https://hamedfathi.github.io/a-professional-asp.net-core-middleware/"><meta property="og:site_name" content="Hamed Fathi&#039;s Blog"><meta property="og:description" content="Middleware is software that’s assembled into an app pipeline to handle requests and responses. Each component:  Chooses whether to pass the request to the next component in the pipeline. Can perform w"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://hamedfathi.github.io/images/a-professional-asp.net-core-middleware/request-delegate-pipeline.png"><meta property="og:image" content="https://hamedfathi.github.io/images/a-professional-asp.net-core-middleware/order.png"><meta property="og:image" content="https://hamedfathi.github.io/images/a-professional-asp.net-core-middleware/endpoint.png"><meta property="article:published_time" content="2020-10-11T00:00:00.000Z"><meta property="article:modified_time" content="2023-07-28T08:36:42.662Z"><meta property="article:author" content="Hamed Fathi"><meta property="article:tag" content="dotnet"><meta property="article:tag" content="aspnetcore"><meta property="article:tag" content="webapi"><meta property="article:tag" content="middleware"><meta property="article:tag" content="pipeline"><meta property="article:tag" content="request"><meta property="article:tag" content="response"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://hamedfathi.github.io/images/a-professional-asp.net-core-middleware/request-delegate-pipeline.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hamedfathi.github.io/a-professional-asp.net-core-middleware/"},"headline":"A Professional ASP.NET Core - Middleware","image":["https://hamedfathi.github.io/images/a-professional-asp.net-core-middleware/request-delegate-pipeline.png","https://hamedfathi.github.io/images/a-professional-asp.net-core-middleware/order.png","https://hamedfathi.github.io/images/a-professional-asp.net-core-middleware/endpoint.png"],"datePublished":"2020-10-11T00:00:00.000Z","dateModified":"2023-07-28T08:36:42.662Z","author":{"@type":"Person","name":"Hamed Fathi"},"publisher":{"@type":"Organization","name":"Hamed Fathi's Blog","logo":{"@type":"ImageObject"}},"description":"Middleware is software that’s assembled into an app pipeline to handle requests and responses. Each component:  Chooses whether to pass the request to the next component in the pipeline. Can perform w"}</script><link rel="canonical" href="https://hamedfathi.github.io/a-professional-asp.net-core-middleware/"><link rel="icon" href="/img/pic.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Hamed Fathi&#039;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/hamedfathi"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-10-11T00:00:00.000Z" title="10/11/2020, 12:00:00 AM">2020-10-11</time></span><span class="level-item"><a class="link-muted" href="/categories/aspnetcore/">aspnetcore</a></span></div></div><h1 class="title is-3 is-size-4-mobile">A Professional ASP.NET Core - Middleware</h1><div class="content"><p>Middleware is software that’s assembled into an app pipeline to handle requests and responses. Each component:</p>
<ul>
<li>Chooses whether to pass the request to the next component in the pipeline.</li>
<li>Can perform work before and after the next component in the pipeline.</li>
</ul>
<p>Request delegates are used to build the request pipeline. The request delegates handle each HTTP request.</p>
<p>Request delegates are configured using <code>Run</code>, <code>Map</code>, and <code>Use</code> extension methods. An individual request delegate can be specified in-line as an anonymous method (called in-line middleware), or it can be defined in a reusable class. These reusable classes and in-line anonymous methods are middleware, also called middleware components. Each middleware component in the request pipeline is responsible for invoking the next component in the pipeline or short-circuiting the pipeline. When a middleware short-circuits, it’s called a terminal middleware because it prevents further middleware from processing the request.</p>
<span id="more"></span>

<h2 id="Create-a-middleware-pipeline-with-IApplicationBuilder"><a href="#Create-a-middleware-pipeline-with-IApplicationBuilder" class="headerlink" title="Create a middleware pipeline with IApplicationBuilder"></a>Create a middleware pipeline with IApplicationBuilder</h2><p>The ASP.NET Core request pipeline consists of a sequence of request delegates, called one after the other. The following diagram demonstrates the concept. The thread of execution follows the black arrows.</p>
<p><img src="/images/a-professional-asp.net-core-middleware/request-delegate-pipeline.png"></p>
<p>Each delegate can perform operations before and after the next delegate. Exception-handling delegates should be called early in the pipeline, so they can catch exceptions that occur in later stages of the pipeline.</p>
<p>The simplest possible ASP.NET Core app sets up a single request delegate that handles all requests. This case doesn’t include an actual request pipeline. Instead, a single anonymous function is called in response to every HTTP request.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Configure</span>(<span class="hljs-params">IApplicationBuilder app</span>)</span><br>    &#123;<br>        <span class="hljs-comment">// HERE</span><br>        app.Run(<span class="hljs-keyword">async</span> context =&gt;<br>        &#123;<br>            <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;Hello, World!&quot;</span>);<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Chain multiple request delegates together with <code>Use</code>. The next parameter represents the <code>next</code> delegate in the pipeline. You can short-circuit the pipeline by <strong>not</strong> calling the next parameter. You can typically perform actions both before and after the next delegate, as the following example demonstrates:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Configure</span>(<span class="hljs-params">IApplicationBuilder app</span>)</span><br>    &#123;<br>        <span class="hljs-comment">// HERE</span><br>        app.Use(<span class="hljs-keyword">async</span> (context, next) =&gt;<br>        &#123;<br>            <span class="hljs-comment">// Do work that doesn&#x27;t write to the Response.</span><br>            <span class="hljs-keyword">await</span> next.Invoke();<br>            <span class="hljs-comment">// Do logging or other work that doesn&#x27;t write to the Response.</span><br>        &#125;);<br><br>        app.Run(<span class="hljs-keyword">async</span> context =&gt;<br>        &#123;<br>            <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;Hello from 2nd delegate.&quot;</span>);<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>When a delegate doesn’t pass a request to the <code>next</code> delegate, it’s called <code>short-circuiting</code> the request pipeline. Short-circuiting is often desirable because it avoids unnecessary work. For example, Static File Middleware can act as a terminal middleware by processing a request for a static file and short-circuiting the rest of the pipeline. Middleware added to the pipeline before the middleware that terminates further processing still processes code after their <code>next.Invoke</code> statements. However, see the following warning about attempting to write to a response that has already been sent.</p>
<p><code>Run</code> delegates don’t receive a next parameter. The first <code>Run</code> delegate is always terminal and terminates the pipeline. Run is a convention. Some middleware components may expose <code>Run[Middleware]</code> methods that run at the end of the pipeline:</p>
<h2 id="Middleware-order"><a href="#Middleware-order" class="headerlink" title="Middleware order"></a>Middleware order</h2><p>The following diagram shows the complete request processing pipeline for ASP.NET Core MVC and Razor Pages apps. You can see how, in a typical app, existing middlewares are ordered and where custom middlewares are added. You have full control over how to reorder existing middlewares or inject new custom middlewares as necessary for your scenarios.</p>
<p><img src="/images/a-professional-asp.net-core-middleware/order.png"></p>
<p>The <code>Endpoint</code> middleware in the preceding diagram executes the filter pipeline for the corresponding app type—MVC or Razor Pages.</p>
<p><img src="/images/a-professional-asp.net-core-middleware/endpoint.png"></p>
<h2 id="Methods-at-a-glance"><a href="#Methods-at-a-glance" class="headerlink" title="Methods at a glance"></a>Methods at a glance</h2><p>Request delegates are configured using various extension methods as following:</p>
<p><strong>Run</strong></p>
<p>Terminates chain. No other middleware method will run after this. Should be placed at the end of any pipeline.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cs">app.Run(<span class="hljs-keyword">async</span> context =&gt;<br>&#123;<br>    <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;Hello from &quot;</span> + _environment);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>UseWhen</strong></p>
<p>Performs action before and after next delegate if condition is met.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">HandleBranch</span>(<span class="hljs-params">IApplicationBuilder app</span>)</span><br>&#123;<br>    app.Run(<span class="hljs-keyword">async</span> context =&gt;<br>    &#123;<br>        <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;Condition is fulfilled&quot;</span>);<br>    &#125;);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureUseWhen</span>(<span class="hljs-params">IApplicationBuilder app</span>)</span><br>&#123;<br>    app.UseWhen(context =&gt; &#123;<br>        <span class="hljs-keyword">return</span> context.Request.Query.ContainsKey(<span class="hljs-string">&quot;somekey&quot;</span>);<br>    &#125;, HandleBranch);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Use</strong></p>
<p>Performs action before and after next delegate.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cs">app.Use(<span class="hljs-keyword">async</span> (context, next) =&gt;<br>&#123;<br>    <span class="hljs-comment">//action before next delegate</span><br>    <span class="hljs-keyword">await</span> next.Invoke(); <span class="hljs-comment">//call next middleware</span><br>    <span class="hljs-comment">//action after called middleware</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>MapWhen</strong></p>
<p>Enables branching pipeline. Runs specified middleware if condition is met.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">HandleBranch</span>(<span class="hljs-params">IApplicationBuilder app</span>)</span><br>&#123;<br>    app.Run(<span class="hljs-keyword">async</span> context =&gt;<br>    &#123;<br>        <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;Condition is fulfilled&quot;</span>);<br>    &#125;);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureMapWhen</span>(<span class="hljs-params">IApplicationBuilder app</span>)</span><br>&#123;<br>    app.MapWhen(context =&gt; &#123;<br>        <span class="hljs-keyword">return</span> context.Request.Query.ContainsKey(<span class="hljs-string">&quot;somekey&quot;</span>);<br>    &#125;, HandleBranch);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Map</strong></p>
<p>Similar to <code>MapWhen</code>. Runs middleware if <code>path</code> requested by user equals path provided in parameter.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">HandleMapTest</span>(<span class="hljs-params">IApplicationBuilder app</span>)</span><br>&#123;<br>    app.Run(<span class="hljs-keyword">async</span> context =&gt;<br>    &#123;<br>        <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;Map Test Successful&quot;</span>);<br>    &#125;);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureMapping</span>(<span class="hljs-params">IApplicationBuilder app</span>)</span><br>&#123;<br>    app.Map(<span class="hljs-string">&quot;/maptest&quot;</span>, HandleMapTest);<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Common-middlewares-in-order"><a href="#Common-middlewares-in-order" class="headerlink" title="Common middlewares (in order)"></a>Common middlewares (in order)</h2><p>The following is a list of common middlewares in order:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Configure</span>(<span class="hljs-params">IApplicationBuilder app, IWebHostEnvironment env</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (env.IsDevelopment())<br>    &#123;<br>        <span class="hljs-comment">// Displays detailed information about request exceptions.</span><br>        app.UseDeveloperExceptionPage();<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-comment">// Provide a path to the custom error page that will be displayed to the user.</span><br>        app.UseExceptionHandler(<span class="hljs-string">&quot;/Home/Error&quot;</span>);<br>        <span class="hljs-comment">// Send HTTP Strict Transport Security Protocol (HSTS) headers to clients.</span><br>        app.UseHsts();<br>    &#125;<br>    <span class="hljs-comment">// Redirect HTTP requests to HTTPS.</span><br>    app.UseHttpsRedirection();<br>    <span class="hljs-comment">// Enables static file serving for the current request path.</span><br>    app.UseStaticFiles();<br>    <span class="hljs-comment">// Enables cookie policy capabilities.</span><br>    app.UseCookiePolicy();<br>    <span class="hljs-comment">// Enables dynamically compressing HTTP Responses.</span><br>    app.UseResponseCompression();<br><br>    <span class="hljs-comment">// Matches request to an endpoint.</span><br>    app.UseRouting();<br>    <span class="hljs-comment">// Set culture information for requests based on information provided by the client.</span><br>    app.UseRequestLocalization();<br>    <span class="hljs-comment">// Applies a CORS policy to all the app&#x27;s endpoints with the specified origins.</span><br>    app.UseCors();<br><br>    <span class="hljs-comment">// Authentication is concerned with determining &#x27;who&#x27; made a request. </span><br>    app.UseAuthentication();<br>    <span class="hljs-comment">// Authorization is concerned with &#x27;what&#x27; a user is allowed to access.</span><br>    app.UseAuthorization();<br> <br>    <span class="hljs-comment">// Enable session state for the application.</span><br>    app.UseSession();<br>    <span class="hljs-comment">// Determines when responses are cacheable, stores responses, and serves responses from cache.</span><br>    app.UseResponseCaching();<br><br>    <span class="hljs-comment">// Execute the matched endpoint.</span><br>    app.UseEndpoints(endpoints =&gt;<br>    &#123;<br>        endpoints.MapControllerRoute(<br>            name: <span class="hljs-string">&quot;default&quot;</span>,<br>            pattern: <span class="hljs-string">&quot;&#123;controller=Home&#125;/&#123;action=Index&#125;/&#123;id?&#125;&quot;</span>);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Componentising-custom-middleware"><a href="#Componentising-custom-middleware" class="headerlink" title="Componentising custom middleware"></a>Componentising custom middleware</h2><p>In some scenarios you might want to write a custom middleware.</p>
<p>Write below classes:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CustomMiddleware</span><br>&#123;<br>    <span class="hljs-comment">// A function that can process an HTTP request.</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> RequestDelegate _next;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomMiddleware</span>(<span class="hljs-params">RequestDelegate next</span>)</span><br>    &#123;<br>        _next = next;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">Invoke</span>(<span class="hljs-params">HttpContext httpContext</span>)</span><br>    &#123;<br>        <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;------- Before ------ \n\r&quot;</span>);<br><br>        <span class="hljs-comment">// Call the next delegate/middleware in the pipeline.</span><br>        <span class="hljs-keyword">return</span> _next(httpContext);<br><br>        <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;\n\r------- After ------&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CustomMiddlewareExtensions</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IApplicationBuilder <span class="hljs-title">UseCustomMiddleware</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> IApplicationBuilder builder</span>)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> builder.UseMiddleware&lt;CustomMiddleware&gt;();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>The middleware class must include:</p>
<ul>
<li>A public constructor with a parameter of type <code>RequestDelegate</code>.</li>
<li>A public method named <code>Invoke</code> or <code>InvokeAsync</code>. This method must:<ul>
<li>Return a <code>Task</code>.</li>
<li>Accept a first parameter of type <code>HttpContext</code>.</li>
</ul>
</li>
</ul>
<p>Additional parameters for the constructor and <code>Invoke</code> or <code>InvokeAsync</code> are populated by dependency injection (DI).</p>
<p>Now, use it as following:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Startup.cs</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Configure</span>(<span class="hljs-params">IApplicationBuilder app</span>)</span><br>    &#123;<br>        <span class="hljs-comment">// HERE</span><br>        app.UseCustomMiddleware();<br><br>        app.Run(<span class="hljs-keyword">async</span> (context) =&gt;<br>        &#123;<br>            <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;Hello World!&quot;</span>);<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Adding-custom-options-to-middleware"><a href="#Adding-custom-options-to-middleware" class="headerlink" title="Adding custom options to middleware"></a>Adding custom options to middleware</h2><p>Writing a custom middleware is great but you will come to a point where it needs to be made configurable. </p>
<p>Let’s define a configuration options class which defines some options which the middleware can use.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CustomMiddlewareOptions</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> DisplayBefore &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125; = <span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> DisplayAfter &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125; = <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Write extension methods to get options with <code>Action&lt;CustomMiddlewareOptions&gt;</code> as following:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CustomMiddlewareWithOptionsExtensions</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IServiceCollection <span class="hljs-title">AddCustomMiddlewareWithOptions</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> IServiceCollection service, Action&lt;CustomMiddlewareOptions&gt; options = <span class="hljs-literal">default</span> <span class="hljs-comment">/* HERE */</span></span>)</span><br>    &#123;<br>        options = options ?? (opts =&gt; &#123; &#125;);<br><br>        service.Configure(options);<br>        <span class="hljs-keyword">return</span> service;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IApplicationBuilder <span class="hljs-title">UseCustomMiddlewareWithOptions</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> IApplicationBuilder builder</span>)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> builder.UseMiddleware&lt;CustomMiddlewareWithOptions&gt;();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>The middleware now can be added into the pipeline and be setup using a lambda expression. It can take the Options in through constructor through the DI mechanism. It comes from the <code>IOptions&lt;T&gt;</code> functionality.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">using</span> Microsoft.Extensions.Options;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CustomMiddlewareWithOptions</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> RequestDelegate _next;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> CustomMiddlewareOptions _options;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomMiddlewareWithOptions</span>(<span class="hljs-params">RequestDelegate next, IOptions&lt;CustomMiddlewareOptions&gt; options <span class="hljs-comment">/* HERE */</span></span>)</span><br>    &#123;<br>        _next = next;<br>        _options = options.Value;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">InvokeAsync</span>(<span class="hljs-params">HttpContext context</span>)</span><br>    &#123;<br>        <span class="hljs-keyword">if</span> (_options.DisplayBefore)<br>        &#123;<br>            <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;------- Before ------ \n\r&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">await</span> _next(context);<br><br>        <span class="hljs-keyword">if</span> (_options.DisplayAfter)<br>        &#123;<br>            <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;\n\r------- After ------&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Register and config it as below:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><br>    &#123;<br>        services.AddCustomMiddlewareWithOptions(options =&gt; options.DisplayAfter = <span class="hljs-literal">false</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Configure</span>(<span class="hljs-params">IApplicationBuilder app</span>)</span><br>    &#123;<br>        app.UseCustomMiddlewareWithOptions();<br><br>        app.Run(<span class="hljs-keyword">async</span> (context) =&gt;<br>        &#123;<br>            <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;Hello World!&quot;</span>);<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Multiple-configuration-setup"><a href="#Multiple-configuration-setup" class="headerlink" title="Multiple configuration setup"></a>Multiple configuration setup</h2><p>The other option is the multiple configuration setup option where you want to be able to use the same type of middleware more than once in your application pipeline but want to specify configuration per usage. For this option you specify that you require a configuration option instance directly and it’s not hidden behind <code>IOptions&lt;&gt;</code>.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CustomMiddlewareWithOptionsMultiUse</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> RequestDelegate _next;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> CustomMiddlewareOptions _options;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomMiddlewareWithOptionsMultiUse</span>(<span class="hljs-params">RequestDelegate next, CustomMiddlewareOptions options</span>)</span><br>    &#123;<br>        _next = next;<br>        _options = options;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">InvokeAsync</span>(<span class="hljs-params">HttpContext context</span>)</span><br>    &#123;<br>        <span class="hljs-keyword">if</span> (_options.DisplayBefore)<br>        &#123;<br>            <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;------- Before ------ \n\r&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">await</span> _next(context);<br><br>        <span class="hljs-keyword">if</span> (_options.DisplayAfter)<br>        &#123;<br>            <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;\n\r------- After ------&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Adding this version into the middleware pipeline is much straight forward however using an extension method makes it cleaner from a consumers point of view.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CustomMiddlewareWithOptionsMultiUseExtensions</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IApplicationBuilder <span class="hljs-title">UseCustomMiddlewareWithOptionsMultiUse</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> IApplicationBuilder builder, CustomMiddlewareOptions options = <span class="hljs-literal">default</span></span>)</span><br>    &#123;<br>        options = options ?? <span class="hljs-keyword">new</span> CustomMiddlewareOptions();<br>        <span class="hljs-keyword">return</span> builder.UseMiddleware&lt;CustomMiddlewareWithOptionsMultiUse&gt;(options);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Passing in the options instance into the UseMiddleware method call allows for the DI system inject it into the middleware constructor directly.</p>
<p>Using this extension method we can then add in multiple instances into the pipeline with different configuration options specified.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Configure</span>(<span class="hljs-params">IApplicationBuilder app, IHostingEnvironment env</span>)</span><br>    &#123;<br>        app.UseCustomMiddlewareWithOptionsMultiUse(<span class="hljs-keyword">new</span> CustomMiddlewareOptions &#123; DisplayBefore = <span class="hljs-literal">true</span> &#125;);<br>        app.UseCustomMiddlewareWithOptionsMultiUse(<span class="hljs-keyword">new</span> CustomMiddlewareOptions &#123; DisplayAfter = <span class="hljs-literal">false</span> &#125;);<br><br>        app.Run(<span class="hljs-keyword">async</span> (context) =&gt;<br>        &#123;<br>            <span class="hljs-keyword">await</span> context.Response.WriteAsync(<span class="hljs-string">&quot;Hello World!&quot;</span>);<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Reference-s"><a href="#Reference-s" class="headerlink" title="Reference(s)"></a>Reference(s)</h2><p>Most of the information in this article has gathered from various references.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware">https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware</a></li>
<li><a target="_blank" rel="noopener" href="https://adamstorr.azurewebsites.net/blog/aspnetcore-exploring-custom-middleware">https://adamstorr.azurewebsites.net/blog/aspnetcore-exploring-custom-middleware</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware/write">https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware/write</a></li>
<li><a target="_blank" rel="noopener" href="https://www.devtrends.co.uk/blog/conditional-middleware-based-on-request-in-asp.net-core">https://www.devtrends.co.uk/blog/conditional-middleware-based-on-request-in-asp.net-core</a></li>
<li><a target="_blank" rel="noopener" href="https://riptutorial.com/asp-net-core/example/20718/run--map--use">https://riptutorial.com/asp-net-core/example/20718/run--map--use</a></li>
</ul>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/dotnet/">dotnet</a><a class="link-muted mr-2" rel="tag" href="/tags/aspnetcore/">aspnetcore</a><a class="link-muted mr-2" rel="tag" href="/tags/webapi/">webapi</a><a class="link-muted mr-2" rel="tag" href="/tags/middleware/">middleware</a><a class="link-muted mr-2" rel="tag" href="/tags/pipeline/">pipeline</a><a class="link-muted mr-2" rel="tag" href="/tags/request/">request</a><a class="link-muted mr-2" rel="tag" href="/tags/response/">response</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/a-professional-asp.net-core-file-upload/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">A Professional ASP.NET Core - File Upload</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/a-professional-asp.net-core-model-binding/"><span class="level-item">A Professional ASP.NET Core - Model Binding</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/pic.png" alt="Hamed Fathi"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Hamed Fathi</p><p class="is-size-6 is-block">Senior Software Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Austria</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">30</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">86</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://twitter.com/Hamed__Fathi" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/hamedfathi"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/hamedfathi"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/Hamed__Fathi"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="StackOverflow" href="https://stackoverflow.com/users/3166171/hamedfathi"><i class="fab fa-stack-overflow"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/hamedfathi88"><i class="fab fa-facebook"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/aspnetcore/"><span class="level-start"><span class="level-item">aspnetcore</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/aspnetcore-api/"><span class="level-start"><span class="level-item">aspnetcore-api</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/aurelia/"><span class="level-start"><span class="level-item">aurelia</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/dotnet/"><span class="level-start"><span class="level-item">dotnet</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/amqp/"><span class="tag">amqp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/api/"><span class="tag">api</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aspnetcore/"><span class="tag">aspnetcore</span><span class="tag">22</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aurelia2/"><span class="tag">aurelia2</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/awesome/"><span class="tag">awesome</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/backgroundtask/"><span class="tag">backgroundtask</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binding/"><span class="tag">binding</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bogus/"><span class="tag">bogus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bootstrap5/"><span class="tag">bootstrap5</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cache/"><span class="tag">cache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/caching/"><span class="tag">caching</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chai/"><span class="tag">chai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cors/"><span class="tag">cors</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp9/"><span class="tag">csharp9</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css-in-js/"><span class="tag">css-in-js</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/default-interface-method/"><span class="tag">default-interface-method</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/di/"><span class="tag">di</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/distributed/"><span class="tag">distributed</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dotnet/"><span class="tag">dotnet</span><span class="tag">26</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dotnet5/"><span class="tag">dotnet5</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dryioc/"><span class="tag">dryioc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/e2e/"><span class="tag">e2e</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/easynetq/"><span class="tag">easynetq</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/emotionjs/"><span class="tag">emotionjs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/end-to-end/"><span class="tag">end-to-end</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/exception/"><span class="tag">exception</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/extension-method/"><span class="tag">extension-method</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fakedata/"><span class="tag">fakedata</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/feature/"><span class="tag">feature</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featureflag/"><span class="tag">featureflag</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featuremanagement/"><span class="tag">featuremanagement</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/file/"><span class="tag">file</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fluentvalidation/"><span class="tag">fluentvalidation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/guard/"><span class="tag">guard</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/header/"><span class="tag">header</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/health/"><span class="tag">health</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/healthcheck/"><span class="tag">healthcheck</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/healthy/"><span class="tag">healthy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hostedservices/"><span class="tag">hostedservices</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/inmemory/"><span class="tag">inmemory</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ioc/"><span class="tag">ioc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jest/"><span class="tag">jest</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lerna/"><span class="tag">lerna</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/localization/"><span class="tag">localization</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log/"><span class="tag">log</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/masstransit/"><span class="tag">masstransit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/messagebroker/"><span class="tag">messagebroker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/middleware/"><span class="tag">middleware</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/miniprofiler/"><span class="tag">miniprofiler</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mixon/"><span class="tag">mixon</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mocha/"><span class="tag">mocha</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/model/"><span class="tag">model</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/modelbinding/"><span class="tag">modelbinding</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/monorepository/"><span class="tag">monorepository</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openapi/"><span class="tag">openapi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pagination/"><span class="tag">pagination</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/paging/"><span class="tag">paging</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pipeline/"><span class="tag">pipeline</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/plugin/"><span class="tag">plugin</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/polly/"><span class="tag">polly</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/profiler/"><span class="tag">profiler</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/puppeteer/"><span class="tag">puppeteer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/queue/"><span class="tag">queue</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rabbitmq/"><span class="tag">rabbitmq</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ratelimit/"><span class="tag">ratelimit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/refit/"><span class="tag">refit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/request/"><span class="tag">request</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/resiliency/"><span class="tag">resiliency</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/response/"><span class="tag">response</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/roslyn/"><span class="tag">roslyn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rss/"><span class="tag">rss</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sourcegenerator/"><span class="tag">sourcegenerator</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sqlserver/"><span class="tag">sqlserver</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swagger/"><span class="tag">swagger</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tailwindcss/"><span class="tag">tailwindcss</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/test/"><span class="tag">test</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testdata/"><span class="tag">testdata</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unhealthy/"><span class="tag">unhealthy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/upload/"><span class="tag">upload</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/validation/"><span class="tag">validation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/versioning/"><span class="tag">versioning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webapi/"><span class="tag">webapi</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webpack/"><span class="tag">webpack</span><span class="tag">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-28T00:00:00.000Z">2023-07-28</time></p><p class="title"><a href="/the-dotnet-world-mixin/">The .NET World - Mixin</a></p><p class="categories"><a href="/categories/dotnet/">dotnet</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-12-08T00:00:00.000Z">2020-12-08</time></p><p class="title"><a href="/the-dotnet-world-csharp-source-generator/">The .NET World - C# Source Generator</a></p><p class="categories"><a href="/categories/dotnet/">dotnet</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-09T00:00:00.000Z">2020-11-09</time></p><p class="title"><a href="/write-a-custom-plugin-with-aurelia-2-and-lerna/">Write a custom plugin with Aurelia 2 and Lerna</a></p><p class="categories"><a href="/categories/aurelia/">aurelia</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-10-23T00:00:00.000Z">2020-10-23</time></p><p class="title"><a href="/a-professional-asp.net-core-api-rabbitmq/">A Professional ASP.NET Core API - RabbitMQ</a></p><p class="categories"><a href="/categories/aspnetcore-api/">aspnetcore-api</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-10-22T00:00:00.000Z">2020-10-22</time></p><p class="title"><a href="/a-professional-asp.net-core-rss/">A Professional ASP.NET Core - RSS</a></p><p class="categories"><a href="/categories/aspnetcore/">aspnetcore</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">July 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Hamed Fathi&#039;s Blog</a><p class="is-size-7"><span>&copy; 2023 Hamed Fathi</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>