<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>The .NET World - C# Source Generator - Hamed Fathi&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Hamed Fathi&#039;s Blog"><meta name="msapplication-TileImage" content="/img/pic.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Hamed Fathi&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="I want to talk about one of the most exciting new features in C# 9. A way to generate the source code you want and access it instantly in your editor. Stay tuned."><meta property="og:type" content="blog"><meta property="og:title" content="The .NET World - C# Source Generator"><meta property="og:url" content="https://hamedfathi.github.io/the-dotnet-world-csharp-source-generator/"><meta property="og:site_name" content="Hamed Fathi&#039;s Blog"><meta property="og:description" content="I want to talk about one of the most exciting new features in C# 9. A way to generate the source code you want and access it instantly in your editor. Stay tuned."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/sg.png"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/solution.png"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/solution2.png"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/solution3.png"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/solution4.png"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/generated.png"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/debugger1.png"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/debugger2.png"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/debugger3.png"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/managed.png"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/vs1.png"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/vs2.png"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/vs3.png"><meta property="og:image" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/nuget.png"><meta property="article:published_time" content="2020-12-08T00:00:00.000Z"><meta property="article:modified_time" content="2023-07-28T08:36:42.662Z"><meta property="article:author" content="Hamed Fathi"><meta property="article:tag" content="dotnet"><meta property="article:tag" content="dotnet5"><meta property="article:tag" content="sourcegenerator"><meta property="article:tag" content="roslyn"><meta property="article:tag" content="csharp9"><meta property="article:tag" content="csharp"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/sg.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hamedfathi.github.io/the-dotnet-world-csharp-source-generator/"},"headline":"The .NET World - C# Source Generator","image":["https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/sg.png","https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/solution.png","https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/solution2.png","https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/solution3.png","https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/solution4.png","https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/generated.png","https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/debugger1.png","https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/debugger2.png","https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/debugger3.png","https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/managed.png","https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/vs1.png","https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/vs2.png","https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/vs3.png","https://hamedfathi.github.io/images/the-dotnet-world-csharp-source-generator/nuget.png"],"datePublished":"2020-12-08T00:00:00.000Z","dateModified":"2023-07-28T08:36:42.662Z","author":{"@type":"Person","name":"Hamed Fathi"},"publisher":{"@type":"Organization","name":"Hamed Fathi's Blog","logo":{"@type":"ImageObject"}},"description":"I want to talk about one of the most exciting new features in C# 9. A way to generate the source code you want and access it instantly in your editor. Stay tuned."}</script><link rel="canonical" href="https://hamedfathi.github.io/the-dotnet-world-csharp-source-generator/"><link rel="icon" href="/img/pic.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Hamed Fathi&#039;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/hamedfathi"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-12-08T00:00:00.000Z" title="12/8/2020, 12:00:00 AM">2020-12-08</time></span><span class="level-item"><a class="link-muted" href="/categories/dotnet/">dotnet</a></span></div></div><h1 class="title is-3 is-size-4-mobile">The .NET World - C# Source Generator</h1><div class="content"><p>I want to talk about one of the most exciting new features in <code>C# 9</code>. A way to generate the source code you want and access it instantly in your editor. Stay tuned.</p>
<span id="more"></span>

<h2 id="What-is-a-source-generator"><a href="#What-is-a-source-generator" class="headerlink" title="What is a source generator?"></a>What is a source generator?</h2><p>A Source Generator is a new kind of component that C# developers can write that lets you do two major things:</p>
<ol>
<li>Retrieve a Compilation object that represents all user code that is being compiled. This object can be inspected and you can write code that works with the syntax and semantic models for the code being compiled, just like with analyzers today.</li>
<li>Generate C# source files that can be added to a Compilation object during the course of compilation. In other words, you can provide additional source code as input to a compilation while the code is being compiled.<br>When combined, these two things are what make Source Generators so useful. You can inspect user code with all of the rich metadata that the compiler builds up during compilation, then emit C# code back into the same compilation that is based on the data you’ve analyzed! If you’re familiar with Roslyn Analyzers, you can think of Source Generators as analyzers that can emit C# source code.</li>
</ol>
<p>Source generators run as a phase of compilation visualized below:</p>
<p><img src="/images/the-dotnet-world-csharp-source-generator/sg.png"></p>
<p>A Source Generator is a .NET Standard 2.0 assembly that is loaded by the compiler along with any analyzers. It is usable in environments where .NET Standard components can be loaded and run.</p>
<h2 id="What-are-its-prerequisites"><a href="#What-are-its-prerequisites" class="headerlink" title="What are its prerequisites?"></a>What are its prerequisites?</h2><ul>
<li>C# 9.0+ (SDK 5.0.100+)</li>
<li>Microsoft Visual Studio 16.8.0+ or JetBrains Rider 2020.3.0+</li>
</ul>
<h2 id="What-are-its-limitations"><a href="#What-are-its-limitations" class="headerlink" title="What are its limitations?"></a>What are its limitations?</h2><ul>
<li>Source Generators <strong>do not allow</strong> you to <strong>rewrite</strong> user source code. You can only augment a compilation by <strong>adding</strong> C# source files to it.</li>
<li>Run <strong>un-ordered</strong>, each generator will see the same input compilation, with <strong>no access</strong> to files created by other source generators.</li>
</ul>
<h2 id="What-is-the-scenario"><a href="#What-is-the-scenario" class="headerlink" title="What is the scenario?"></a>What is the scenario?</h2><p>The need to mock static methods in order to add a unit test is a very common problem. It’s often the case that these static methods are in third-party libraries. There are many utility libraries that are completely made up of static methods. While this makes them very easy to use, it makes them really difficult to test.</p>
<p>The way to mock a static method is by creating <strong>a class that wraps the call</strong>, <strong>extracting an interface</strong>, and <strong>passing in the interface</strong>. Then from your unit tests you can create a mock of the interface and pass it in.</p>
<p>In the following, we describe this method and choose <code>Dapper</code> as a real-world example to show you how a wrapper class and interface helps us to test its static (extension) methods.</p>
<p><strong>What is Dapper?</strong></p>
<blockquote>
<p>A simple object mapper for .Net.</p>
</blockquote>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Student</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Family &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> DateTime BirthDate &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br><span class="hljs-keyword">var</span> student = connection.Query&lt;Student&gt;(<span class="hljs-string">&quot;SELECT * FROM STUDENT);</span><br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/StackExchange/Dapper">Dapper</a> contains a lot of extension (static) methods so I’m going to look at how to mock its methods with the instruction above.</p>
<p><strong>Solution structure</strong></p>
<p>Make <code>MockableStaticGenerator</code> solution with these projects:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Template</th>
<th>Target</th>
</tr>
</thead>
<tbody><tr>
<td>MockableStaticGenerator</td>
<td>class library</td>
<td>netstandard2.0</td>
</tr>
<tr>
<td>DapperSample</td>
<td>class library</td>
<td>netstandard2.0</td>
</tr>
<tr>
<td>DapperSampleTest</td>
<td>xUnit test project</td>
<td>net5.0</td>
</tr>
</tbody></table>
<p><img src="/images/the-dotnet-world-csharp-source-generator/solution.png"></p>
<p><strong>MockableStaticGenerator</strong></p>
<p>Open <code>MockableStaticGenerator</code> project and add the following configuration to <code>csproj</code> file.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Project</span> <span class="hljs-attr">Sdk</span>=<span class="hljs-string">&quot;Microsoft.NET.Sdk&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">PropertyGroup</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">TargetFramework</span>&gt;</span>netstandard2.0<span class="hljs-tag">&lt;/<span class="hljs-name">TargetFramework</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Version</span>&gt;</span>0.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">Version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">PackageId</span>&gt;</span>MockableStaticGenerator<span class="hljs-tag">&lt;/<span class="hljs-name">PackageId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">LangVersion</span>&gt;</span>latest<span class="hljs-tag">&lt;/<span class="hljs-name">LangVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">GeneratePackageOnBuild</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">GeneratePackageOnBuild</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">IncludeBuildOutput</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">IncludeBuildOutput</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">EmitCompilerGeneratedFiles</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">EmitCompilerGeneratedFiles</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">CompilerGeneratedFilesOutputPath</span>&gt;</span>$(BaseIntermediateOutputPath)Generated<span class="hljs-tag">&lt;/<span class="hljs-name">CompilerGeneratedFilesOutputPath</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">PropertyGroup</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">PropertyGroup</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">RestoreAdditionalProjectSources</span>&gt;</span>https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet5/nuget/v3/index.json ;$(RestoreAdditionalProjectSources)<span class="hljs-tag">&lt;/<span class="hljs-name">RestoreAdditionalProjectSources</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">PropertyGroup</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">None</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">&quot;$(OutputPath)\$(AssemblyName).dll&quot;</span> <span class="hljs-attr">Pack</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">PackagePath</span>=<span class="hljs-string">&quot;analyzers/dotnet/cs&quot;</span> <span class="hljs-attr">Visible</span>=<span class="hljs-string">&quot;false&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">PackageReference</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">&quot;Microsoft.CodeAnalysis.CSharp.Workspaces&quot;</span> <span class="hljs-attr">Version</span>=<span class="hljs-string">&quot;3.8.0&quot;</span> <span class="hljs-attr">PrivateAssets</span>=<span class="hljs-string">&quot;all&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">PackageReference</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">&quot;Microsoft.CodeAnalysis.Analyzers&quot;</span> <span class="hljs-attr">Version</span>=<span class="hljs-string">&quot;3.3.2&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">PrivateAssets</span>&gt;</span>all<span class="hljs-tag">&lt;/<span class="hljs-name">PrivateAssets</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">IncludeAssets</span>&gt;</span>runtime; build; native; contentfiles; analyzers; buildtransitive<span class="hljs-tag">&lt;/<span class="hljs-name">IncludeAssets</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">PackageReference</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">Project</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>Make sure both below packages are installed.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">Install-Package Microsoft.CodeAnalysis.Analyzers -Version 3.3.2<br>dotnet add package Microsoft.CodeAnalysis.Analyzers --version 3.3.2<br>&lt;PackageReference Include=<span class="hljs-string">&quot;Microsoft.CodeAnalysis.Analyzers&quot;</span> Version=<span class="hljs-string">&quot;3.3.2&quot;</span>&gt;<br>  &lt;PrivateAssets&gt;all&lt;/PrivateAssets&gt;<br>  &lt;IncludeAssets&gt;runtime; build; native; contentfiles; analyzers&lt;/IncludeAssets&gt;<br>&lt;/PackageReference&gt;<br><br>Install-Package Microsoft.CodeAnalysis.CSharp.Workspaces -Version 3.8.0<br>dotnet add package Microsoft.CodeAnalysis.CSharp.Workspaces --version 3.8.0<br>&lt;PackageReference Include=<span class="hljs-string">&quot;Microsoft.CodeAnalysis.CSharp.Workspaces&quot;</span> Version=<span class="hljs-string">&quot;3.8.0&quot;</span> /&gt;<br></code></pre></td></tr></table></figure>

<p><strong>DapperSample</strong></p>
<p>Install the below package</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Install-Package Dapper -Version 2.0.78<br>dotnet add package Dapper --version 2.0.78<br>&lt;PackageReference Include=<span class="hljs-string">&quot;Dapper&quot;</span> Version=<span class="hljs-string">&quot;2.0.78&quot;</span> /&gt;<br></code></pre></td></tr></table></figure>

<p>Then, make each below file in the project.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Student.cs</span><br><span class="hljs-keyword">using</span> System;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Student</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Family &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> DateTime BirthDate &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br><span class="hljs-comment">// IStudentRepository.cs</span><br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IStudentRepository</span><br>&#123;<br>    <span class="hljs-function">IEnumerable&lt;Student&gt; <span class="hljs-title">GetStudents</span>(<span class="hljs-params"></span>)</span>;<br>&#125;<br><br><span class="hljs-comment">// StudentRepository.cs</span><br><span class="hljs-keyword">using</span> Dapper;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> System.Data;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StudentRepository</span> : <span class="hljs-title">IStudentRepository</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IDbConnection _dbConnection;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">StudentRepository</span>(<span class="hljs-params">IDbConnection dbConnection</span>)</span><br>    &#123;<br>        _dbConnection = dbConnection;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;Student&gt; <span class="hljs-title">GetStudents</span>(<span class="hljs-params"></span>)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> _dbConnection.Query&lt;Student&gt;(<span class="hljs-string">&quot;SELECT * FROM STUDENT&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>DapperSampleTest</strong></p>
<p>Install below package </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Install-Package Moq -Version 4.15.2<br>dotnet add package Moq --version 4.15.2<br>&lt;PackageReference Include=<span class="hljs-string">&quot;Moq&quot;</span> Version=<span class="hljs-string">&quot;4.15.2&quot;</span> /&gt;<br></code></pre></td></tr></table></figure>

<p>Then, add <code>DapperSample</code> project reference to this.</p>
<p>Now, we are able to test our repository.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// StudentRepositoryTest.cs</span><br><br><span class="hljs-keyword">using</span> DapperSample;<br><span class="hljs-keyword">using</span> Moq;<br><span class="hljs-keyword">using</span> System.Data;<br><span class="hljs-keyword">using</span> Xunit;<br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">DapperSampleTest</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StudentRepositoryTest</span><br>    &#123;<br>        [<span class="hljs-meta">Fact</span>]<br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">STUDENT_REPOSITORY_TEST</span>(<span class="hljs-params"></span>)</span><br>        &#123;<br>            <span class="hljs-keyword">var</span> mockConn = <span class="hljs-keyword">new</span> Mock&lt;IDbConnection&gt;();<br>            <span class="hljs-keyword">var</span> sut = <span class="hljs-keyword">new</span> StudentRepository(mockConn.Object);<br>            <span class="hljs-keyword">var</span> stu = sut.GetStudents();<br>            Assert.NotNull(stu);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/images/the-dotnet-world-csharp-source-generator/solution2.png"></p>
<p><strong>How is the test run and what happens next?</strong></p>
<p>Run the test then you will get a error like below</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">DapperSampleTest.StudentRepositoryTest.STUDENT_REPOSITORY_TEST<br>  Source: StudentRepositoryTest.cs line 11<br>  Duration: 92 ms<br><br> Message: <br>   System.NullReferenceException : Object reference not <span class="hljs-built_in">set</span> to an instance of an object.<br> Stack Trace: <br>   CommandDefinition.SetupCommand(IDbConnection cnn, Action`2 paramReader) line 113<br>   SqlMapper.QueryImpl[T](IDbConnection cnn, CommandDefinition <span class="hljs-built_in">command</span>, Type effectiveType)+MoveNext() line 1080<br>   List`1.ctor(IEnumerable`1 collection)<br>   Enumerable.ToList[TSource](IEnumerable`1 <span class="hljs-built_in">source</span>)<br>   SqlMapper.Query[T](IDbConnection cnn, String sql, Object param, IDbTransaction transaction, Boolean buffered, Nullable`1 commandTimeout, Nullable`1 commandType) line 725<br>   StudentRepository.GetStudents() line 18<br>   StudentRepositoryTest.STUDENT_REPOSITORY_TEST() line 15<br></code></pre></td></tr></table></figure>

<p>You may have guessed why. Because  mock object of <code>IDbConnection</code> has no <code>Query</code> method in his interface. This is the problem.</p>
<p><strong>How to fix it?</strong></p>
<blockquote>
<p>The way to mock a static method is by creating <strong>a class that wraps the call</strong>, <strong>extracting an interface</strong>, and <strong>passing in the interface</strong>. Then from your unit tests you can create a mock of the interface and pass it in.</p>
</blockquote>
<p>Do this step-by-step changes just like above instruction and add them to <code>DapperSample</code> project.</p>
<ol>
<li>Extracting an interface.</li>
</ol>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// IDapperSqlMapper.cs</span><br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> System.Data;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IDapperSqlMapper</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">Query</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">IDbConnection cnn, <span class="hljs-built_in">string</span> sql, <span class="hljs-built_in">object</span> param = <span class="hljs-literal">null</span>, IDbTransaction transaction = <span class="hljs-literal">null</span>, <span class="hljs-built_in">bool</span> buffered = <span class="hljs-literal">true</span>, <span class="hljs-built_in">int</span>? commandTimeout = <span class="hljs-literal">null</span>, CommandType? commandType = <span class="hljs-literal">null</span></span>)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>The <code>Query</code> is the same as what <code>Dapper</code> has.</p>
<ol start="2">
<li>A class that wraps the (static) call.</li>
</ol>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// DapperSqlMapper.cs</span><br><span class="hljs-keyword">using</span> Dapper;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> System.Data;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DapperSqlMapper</span> : <span class="hljs-title">IDapperSqlMapper</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">Query</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">IDbConnection cnn, <span class="hljs-built_in">string</span> sql, <span class="hljs-built_in">object</span> param = <span class="hljs-literal">null</span>, IDbTransaction transaction = <span class="hljs-literal">null</span>, <span class="hljs-built_in">bool</span> buffered = <span class="hljs-literal">true</span>, <span class="hljs-built_in">int</span>? commandTimeout = <span class="hljs-literal">null</span>, CommandType? commandType = <span class="hljs-literal">null</span></span>)</span><br>    &#123;<br>        <span class="hljs-comment">// Dapper &#x27;Query&#x27; method is here.</span><br>        <span class="hljs-keyword">return</span> cnn.Query&lt;T&gt;(sql, param, transaction, buffered, commandTimeout, commandType);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>Change your <code>StudentRepository</code> class.</li>
</ol>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// StudentRepository.cs</span><br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> System.Data;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StudentRepository</span> : <span class="hljs-title">IStudentRepository</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IDbConnection _dbConnection;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IDapperSqlMapper _dapperSqlMapper;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">StudentRepository</span>(<span class="hljs-params">IDbConnection dbConnection, IDapperSqlMapper dapperSqlMapper</span>)</span><br>    &#123;<br>        _dbConnection = dbConnection;<br>        _dapperSqlMapper = dapperSqlMapper;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;Student&gt; <span class="hljs-title">GetStudents</span>(<span class="hljs-params"></span>)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> _dapperSqlMapper.Query&lt;Student&gt;(_dbConnection, <span class="hljs-string">&quot;SELECT * FROM STUDENT&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Now change your test in <code>DapperSampleTest</code> project as following.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">using</span> DapperSample;<br><span class="hljs-keyword">using</span> Moq;<br><span class="hljs-keyword">using</span> System.Data;<br><span class="hljs-keyword">using</span> Xunit;<br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">DapperSampleTest</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StudentRepositoryTest</span><br>    &#123;<br>        [<span class="hljs-meta">Fact</span>]<br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">STUDENT_REPOSITORY_TEST</span>(<span class="hljs-params"></span>)</span><br>        &#123;<br>            <span class="hljs-keyword">var</span> mockConn = <span class="hljs-keyword">new</span> Mock&lt;IDbConnection&gt;();<br>            <span class="hljs-keyword">var</span> mockDapper = <span class="hljs-keyword">new</span> Mock&lt;IDapperSqlMapper&gt;();<br>            <span class="hljs-keyword">var</span> sut = <span class="hljs-keyword">new</span> StudentRepository(mockConn.Object, mockDapper.Object);<br>            <span class="hljs-keyword">var</span> stu = sut.GetStudents();<br>            Assert.NotNull(stu);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Run the test, you will see the green result!</p>
<p><img src="/images/the-dotnet-world-csharp-source-generator/solution3.png"></p>
<p><strong>What is the new problem?</strong></p>
<p>Everything is good but <strong>very tough repetitive</strong> work especially when you are using external libraries like <code>Dapper</code> with a lot of extension (static) methods to use.</p>
<p>What if this repetitive method was already prepared for all methods?</p>
<h2 id="How-does-a-source-generator-help-us-solve-this-problem"><a href="#How-does-a-source-generator-help-us-solve-this-problem" class="headerlink" title="How does a source generator help us solve this problem?"></a>How does a source generator help us solve this problem?</h2><p>So far, we have learned about the problem and how to deal with it. But now we want to use a source generator to reduce the set of these repetitive tasks to zero.</p>
<p>What if I have <strong>both</strong> of the following possibilities?</p>
<ul>
<li>Generate a wrapper class like above sample for <code>Math</code> class in background.</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Internal usage</span><br><span class="hljs-comment">// My class with a lot of static (extension) methods.</span><br><br>[<span class="hljs-meta">MockableStatic</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Math</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> <span class="hljs-title">Add</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> a, <span class="hljs-built_in">int</span> b</span>)</span> &#123; <span class="hljs-keyword">return</span> a + b; &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> <span class="hljs-title">Sub</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> a, <span class="hljs-built_in">int</span> b</span>)</span> &#123; <span class="hljs-keyword">return</span> a - b; &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>Generate a wrapper class for <code>Dapper.SqlMapper</code> that exists in <code>Dapper</code> assembly in background.</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// External usage</span><br><span class="hljs-comment">// A referenced assembly with a type that contains a lot of static (extension) methods.</span><br><br>[<span class="hljs-meta">MockableStatic(typeof(Dapper.SqlMapper))</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StudentRepositoryTest</span><br>&#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>If you think it’s a good idea, stay tuned.</p>
<h2 id="How-to-write-a-source-generator"><a href="#How-to-write-a-source-generator" class="headerlink" title="How to write a source generator?"></a>How to write a source generator?</h2><p>First of all, go to your <code>MockableStaticGenerator</code> project. Add <code>SourceGeneratorExtensions.cs</code> to the project.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// SourceGeneratorExtensions.cs</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Microsoft.CodeAnalysis</span><br>&#123;<br>    <span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SourceGeneratorExtensions</span><br>    &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;        <br>&#125;<br></code></pre></td></tr></table></figure>

<p>For achieving our ultimate goal we need some useful extension methods to make source code so I will add them to <code>SourceGeneratorExtensions</code> class.</p>
<p>Now, Create <code>SyntaxReceiver</code> class as following:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">using</span> Microsoft.CodeAnalysis;<br><span class="hljs-keyword">using</span> Microsoft.CodeAnalysis.CSharp.Syntax;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">MockableStaticGenerator</span><br>&#123;<br>    <span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SyntaxReceiver</span> : <span class="hljs-title">ISyntaxReceiver</span><br>    &#123;<br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-title">List</span>&lt;<span class="hljs-title">ClassDeclarationSyntax</span>&gt; Classes</span> &#123; <span class="hljs-keyword">get</span>; &#125; = <span class="hljs-keyword">new</span> List&lt;ClassDeclarationSyntax&gt;();<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnVisitSyntaxNode</span>(<span class="hljs-params">SyntaxNode syntaxNode</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (syntaxNode <span class="hljs-keyword">is</span> ClassDeclarationSyntax classDeclarationSyntax<br>                &amp;&amp; classDeclarationSyntax.AttributeLists.Count &gt; <span class="hljs-number">0</span>)<br>            &#123;<br>                Classes.Add(classDeclarationSyntax);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>The purpose of this class is to <strong>identify</strong> the nodes we need to process the current source and generate new code. Here we store all the received classes in the <code>Classes</code> property.</p>
<p>Then, Create <code>MockableGenerator</code> class with below code.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">using</span> Microsoft.CodeAnalysis;<br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">MockableStaticGenerator</span><br>&#123;<br>    [<span class="hljs-meta">Generator</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MockableGenerator</span> : <span class="hljs-title">ISourceGenerator</span><br>    &#123;<br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Execute</span>(<span class="hljs-params">GeneratorExecutionContext context</span>)</span><br>        &#123;<br>            <br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Initialize</span>(<span class="hljs-params">GeneratorInitializationContext context</span>)</span><br>        &#123;<br>            context.RegisterForSyntaxNotifications(() =&gt; <span class="hljs-keyword">new</span> SyntaxReceiver());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>As you can see, You should implement <code>ISourceGenerator</code> and add <code>[Generator]</code> attribute to your source generator class.</p>
<p>There are two methods:</p>
<p><strong>Initialize(GeneratorInitializationContext context)</strong></p>
<p>The process of generating code starts with this method, so we get the target classes by registering our <code>SyntaxReceiver</code>.</p>
<p><strong>Execute(GeneratorExecutionContext context)</strong></p>
<p>You should write how to generate your code in this section and introduce the final output to the compiler.</p>
<p>For next step, add <code>Constants</code> class as following to your project.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">namespace</span> <span class="hljs-title">MockableStaticGenerator</span><br>&#123;<br>    <span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Constants</span><br>    &#123;<br>        <span class="hljs-keyword">internal</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> MockableStaticAttribute = <span class="hljs-string">@&quot;</span><br><span class="hljs-string">            namespace System</span><br><span class="hljs-string">            &#123;</span><br><span class="hljs-string">                [AttributeUsage(AttributeTargets.Class, Inherited = false, AllowMultiple = false)]</span><br><span class="hljs-string">                public sealed class MockableStaticAttribute : Attribute</span><br><span class="hljs-string">                &#123;</span><br><span class="hljs-string">                    public MockableStaticAttribute()</span><br><span class="hljs-string">                    &#123;</span><br><span class="hljs-string">                    &#125;</span><br><span class="hljs-string">                    public MockableStaticAttribute(Type type)</span><br><span class="hljs-string">                    &#123;</span><br><span class="hljs-string">                    &#125;</span><br><span class="hljs-string">                &#125;</span><br><span class="hljs-string">            &#125;&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>As I explained before, We need an attribute (<code>MockableStaticAttribute</code>) to annotate our classes. So, we will use above source code text in our source generator.  </p>
<ul>
<li><code>[MockableStatic]</code> useful for internal usage and current class.</li>
<li><code>[MockableStatic(typeof(Dapper.SqlMapper))]</code> useful for external usage and making a wrapper for an external type.</li>
</ul>
<p><img src="/images/the-dotnet-world-csharp-source-generator/solution4.png"></p>
<p>Let’s go to the <code>Execute</code> method, Add below code to it</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">using</span> Microsoft.CodeAnalysis;<br><span class="hljs-keyword">using</span> Microsoft.CodeAnalysis.CSharp;<br><span class="hljs-keyword">using</span> Microsoft.CodeAnalysis.Text;<br><span class="hljs-keyword">using</span> System.Text;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Execute</span>(<span class="hljs-params">GeneratorExecutionContext context</span>)</span><br>&#123;<br>    <span class="hljs-comment">// 1</span><br>    context.AddSource(<span class="hljs-keyword">nameof</span>(Constants.MockableStaticAttribute), SourceText.From(Constants.MockableStaticAttribute, Encoding.UTF8));<br><br>    <span class="hljs-comment">// 2</span><br>    <span class="hljs-keyword">if</span> (!(context.SyntaxReceiver <span class="hljs-keyword">is</span> SyntaxReceiver receiver))<br>        <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-comment">// 3</span><br>    CSharpParseOptions options = (context.Compilation <span class="hljs-keyword">as</span> CSharpCompilation).SyntaxTrees[<span class="hljs-number">0</span>].Options <span class="hljs-keyword">as</span> CSharpParseOptions;<br>    Compilation compilation = context.Compilation.AddSyntaxTrees(CSharpSyntaxTree.ParseText(SourceText.From(Constants.MockableStaticAttribute, Encoding.UTF8), options));<br>    INamedTypeSymbol attributeSymbol = compilation.GetTypeByMetadataName(<span class="hljs-string">$&quot;System.<span class="hljs-subst">&#123;<span class="hljs-keyword">nameof</span>(Constants.MockableStaticAttribute)&#125;</span>&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(1) we added our <code>MockableStaticAttribute</code> text source to the project.</p>
<p>(2) I checked if there is no <code>SyntaxReceiver</code> just return without any generated code.</p>
<p>(3) The most important part is finding our <code>MockableStaticAttribute</code> text source from syntax tree and use its information.</p>
<p>In summary, You need to add source code text as a part of project then get it from compiler as a Symbol type to work with it in strongly typed way.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// 3</span><br><span class="hljs-comment">// ...</span><br><span class="hljs-comment">// 4</span><br><span class="hljs-keyword">var</span> sources = <span class="hljs-keyword">new</span> StringBuilder();<br><span class="hljs-comment">// 5</span><br><span class="hljs-keyword">var</span> assemblyName = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-comment">// 6</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> cls <span class="hljs-keyword">in</span> receiver.Classes)<br>&#123;<br>    <span class="hljs-comment">// 7</span><br>    SemanticModel model = compilation.GetSemanticModel(cls.SyntaxTree);<br>    <span class="hljs-keyword">var</span> clsSymbol = model.GetDeclaredSymbol(cls);<br><br>    <span class="hljs-comment">// 8</span><br>    <span class="hljs-keyword">var</span> attr = clsSymbol.GetAttributes().FirstOrDefault(ad =&gt; ad.AttributeClass.Equals(attributeSymbol, SymbolEqualityComparer.Default));<br><br>    <span class="hljs-comment">// 9</span><br>    <span class="hljs-keyword">if</span> (attr == <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>;<br>    <br>    <span class="hljs-comment">// 10</span><br>    <span class="hljs-keyword">var</span> isParameterlessCtor = attr?.ConstructorArguments.Length == <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">// 11</span><br>    <span class="hljs-keyword">var</span> sbInterface = <span class="hljs-keyword">new</span> StringBuilder();<br>    <span class="hljs-comment">// 12</span><br>    <span class="hljs-keyword">var</span> sbClass = <span class="hljs-keyword">new</span> StringBuilder();<br></code></pre></td></tr></table></figure>

<p>(4) We need aggregate our sources.</p>
<p>(5) We store assembly name.</p>
<p>(6) Our <code>SyntaxReceiver</code> classes were stored in <code>receiver</code> variable now we need to use them one-by-one.</p>
<p>(7) Access to current class symbol.</p>
<p>(8) Check it has the same attribute as we want or not.</p>
<p>(9) If not, so go to next item.</p>
<p>(10) As I talked before, We are faced with two source generating models.</p>
<p>I- Parameterless: It generates a wrapper for the annotated class.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cs">[<span class="hljs-meta">MockableStatic</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Math</span> &#123; &#125;<br></code></pre></td></tr></table></figure>

<p>The source generator generates a wrapper for statics methods of <code>Math</code> class.</p>
<p>II- With parameter: It gets <code>typeof</code> as a parameter.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cs">[<span class="hljs-meta">MockableStatic(typeof(Dapper.SqlMapper))</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StudentRepository</span> &#123; &#125;<br></code></pre></td></tr></table></figure>

<p>The source generator generates a wrapper for statics methods of <code>SqlMapper</code> class inside <code>Dapper</code> assembly.</p>
<p>(11) (12) The generated class and interface are stored in these variables.</p>
<p>So we continue to work in two parts.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// 12</span><br><span class="hljs-comment">// ...</span><br><span class="hljs-comment">// 13</span><br><span class="hljs-keyword">if</span> (isParameterlessCtor)<br>&#123;<br>    <span class="hljs-comment">// 14</span><br>    <span class="hljs-keyword">var</span> methods = cls.DescendantNodes().OfType&lt;MethodDeclarationSyntax&gt;().Where(x =&gt; x.IsPublic() &amp;&amp; x.IsStatic()).ToList();<br>    <span class="hljs-keyword">if</span> (methods.Count == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<br><br>    <span class="hljs-comment">// 15</span><br>    <span class="hljs-keyword">var</span> className = clsSymbol.Name;<br>    <span class="hljs-comment">// 16</span><br>    <span class="hljs-keyword">var</span> ns = <span class="hljs-built_in">string</span>.IsNullOrEmpty(cls.GetNamespace()) ? <span class="hljs-string">&quot;&quot;</span> : cls.GetNamespace() + <span class="hljs-string">&quot;.&quot;</span>;<br>    <span class="hljs-comment">// 17</span><br>    <span class="hljs-keyword">var</span> baseList = <span class="hljs-built_in">string</span>.IsNullOrEmpty(cls.BaseList?.ToFullString()) ? <span class="hljs-string">&quot;:&quot;</span> : cls.BaseList?.ToFullString().Trim() + <span class="hljs-string">&quot;,&quot;</span>;<br>    <span class="hljs-comment">// 18</span><br>    assemblyName = clsSymbol.ContainingAssembly.Identity.Name;<br>    <span class="hljs-comment">// 19</span><br>    <span class="hljs-keyword">var</span> wrapperClassName = !className.Contains(<span class="hljs-string">&#x27;&lt;&#x27;</span>) ? className + <span class="hljs-string">&quot;Wrapper&quot;</span> : className.Replace(<span class="hljs-string">&quot;&lt;&quot;</span>, <span class="hljs-string">&quot;Wrapper&lt;&quot;</span>);<br>    <span class="hljs-comment">// 20</span><br>    <span class="hljs-keyword">var</span> classTypeParameters = cls.GetTypeParameters() ?? <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-comment">// 21</span><br>    <span class="hljs-keyword">var</span> constraintClauses = cls.GetConstraintClauses() ?? <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-comment">// 22</span><br>    sbInterface.AppendLine(<span class="hljs-string">$&quot;\tpublic partial interface I<span class="hljs-subst">&#123;wrapperClassName&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span> <span class="hljs-subst">&#123;constraintClauses&#125;</span> &#123;&#123;&quot;</span>);<br>    <span class="hljs-comment">// 23</span><br>    sbClass.AppendLine(<span class="hljs-string">$&quot;\tpublic partial class <span class="hljs-subst">&#123;wrapperClassName&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span> <span class="hljs-subst">&#123;baseList&#125;</span> I<span class="hljs-subst">&#123;wrapperClassName&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span> <span class="hljs-subst">&#123;constraintClauses&#125;</span> &#123;&#123;&quot;</span>);<br>    <span class="hljs-comment">// 24</span><br>    <span class="hljs-keyword">foreach</span> (MethodDeclarationSyntax method <span class="hljs-keyword">in</span> methods)<br>    &#123;<br>        <span class="hljs-comment">// 25</span><br>        <span class="hljs-keyword">var</span> text = method.GetSignatureText();<br><br>        <span class="hljs-comment">// 26</span><br>        <span class="hljs-keyword">if</span> (!sbInterface.ToString().Contains(text))<br>            sbInterface.AppendLine(<span class="hljs-string">$&quot;\t\t<span class="hljs-subst">&#123;text&#125;</span>;&quot;</span>);<br><br>        <span class="hljs-comment">// 27</span><br>        <span class="hljs-keyword">if</span> (!sbClass.ToString().Contains(text))<br>        &#123;<br>            <span class="hljs-comment">// 28</span><br>            <span class="hljs-keyword">var</span> returnKeyword = method.ReturnsVoid() ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;return &quot;</span>;<br>            <br>            <span class="hljs-comment">// 29</span><br>            <span class="hljs-keyword">var</span> obsoleteAttrText = <span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-keyword">var</span> isObsolete = method.TryGetObsoleteAttribute(<span class="hljs-keyword">out</span> obsoleteAttrText);<br>            <span class="hljs-keyword">if</span> (isObsolete)<br>                sbClass.AppendLine(<span class="hljs-string">$&quot;\t\t<span class="hljs-subst">&#123;obsoleteAttrText&#125;</span>&quot;</span>);<br><br>            <span class="hljs-comment">// 30</span><br>            sbClass.AppendLine(<span class="hljs-string">$&quot;\t\tpublic <span class="hljs-subst">&#123;method.GetSignatureText()&#125;</span> &#123;&#123;&quot;</span>);<br>            sbClass.AppendLine(<span class="hljs-string">$&quot;\t\t\t<span class="hljs-subst">&#123;returnKeyword&#125;</span><span class="hljs-subst">&#123;ns&#125;</span><span class="hljs-subst">&#123;className&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span>.<span class="hljs-subst">&#123;method.GetCallableSignatureText()&#125;</span>;&quot;</span>);<br>            sbClass.AppendLine(<span class="hljs-string">$&quot;\t\t&#125;&#125;&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 31</span><br>    sbInterface.AppendLine(<span class="hljs-string">$&quot;\t&#125;&#125;&quot;</span>);<br>    sbClass.AppendLine(<span class="hljs-string">$&quot;\t&#125;&#125;&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(13) Our class annotated with parameterless attribute.</p>
<p>(14) Find all <code>public static</code> methods of the class. If there no one skip the process.</p>
<p>To do this, Add two below extension methods to <code>SourceGeneratorExtensions</code> class.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// SourceGeneratorExtensions.cs</span><br><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsPublic</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MethodDeclarationSyntax methodDeclarationSyntax</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> methodDeclarationSyntax.Modifiers.Select(x =&gt; x.ValueText).Contains(<span class="hljs-string">&quot;public&quot;</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsStatic</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MethodDeclarationSyntax methodDeclarationSyntax</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> methodDeclarationSyntax.Modifiers.Select(x =&gt; x.ValueText).Contains(<span class="hljs-string">&quot;static&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(15) Simple class name.</p>
<p>(16) The Class name with namespace. To find the namespace we need a recursive extension method as following.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// SourceGeneratorExtensions.cs</span><br><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetNamespace</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> SyntaxNode syntaxNode</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> syntaxNode.Parent <span class="hljs-keyword">switch</span><br>    &#123;<br>        NamespaceDeclarationSyntax namespaceDeclarationSyntax =&gt; namespaceDeclarationSyntax.Name.ToString(),<br>        <span class="hljs-literal">null</span> =&gt; <span class="hljs-built_in">string</span>.Empty,<br>        _ =&gt; GetNamespace(syntaxNode.Parent)<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(17) If it has inherited from a class or implemented interfaces, its information is available here.</p>
<p>(18) Assembly name.</p>
<p>(19) We append <code>Wrapper</code> to end of the class name. so We will have something like these samples:</p>
<p><code>SqlMapper</code> =&gt; ISqlMapper<strong>Wrapper</strong> and SqlMapper<strong>Wrapper</strong><br><code>SqlMapper&lt;T&gt;</code> =&gt; ISqlMapper<strong>Wrapper</strong><T> and SqlMapper<strong>Wrapper</strong><T></p>
<p>(20) Your class may have type parameters (generic).</p>
<p>Add below method to <code>SourceGeneratorExtensions</code> class.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetTypeParameters</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> ClassDeclarationSyntax classDeclarationSyntax</span>)</span><br>&#123;<br>    <span class="hljs-keyword">var</span> result = classDeclarationSyntax.TypeParameterList?.ToFullString().Trim();<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.IsNullOrEmpty(result) ? <span class="hljs-literal">null</span> : result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Now we can check it there.</p>
<p>(21) If your class is generic, Has it any constraint clauses? With the following extension method we can find out.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// SourceGeneratorExtensions.cs</span><br><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetConstraintClauses</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> ClassDeclarationSyntax classDeclarationSyntax</span>)</span><br>&#123;<br>    <span class="hljs-keyword">var</span> result = classDeclarationSyntax.ConstraintClauses.ToFullString().Trim();<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.IsNullOrEmpty(result) ? <span class="hljs-literal">null</span> : result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(22) (23) With current information we are able to create our interface and class for wrapping the main class static methods.</p>
<p>(24) Let’s start examining the methods.</p>
<p>(25) We should add our methods to interface so we need to know about its signature.</p>
<p>So add the following extension method to your <code>SourceGeneratorExtensions</code> class.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetSignatureText</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MethodDeclarationSyntax methodDeclarationSyntax</span>)</span><br>&#123;<br>    <span class="hljs-keyword">var</span> name = methodDeclarationSyntax.Identifier.ValueText;<br>    <span class="hljs-keyword">var</span> parameters = methodDeclarationSyntax.ParameterList?.ToFullString().Trim();<br>    <span class="hljs-keyword">var</span> typeParameters = methodDeclarationSyntax.TypeParameterList?.ToFullString().Trim();<br>    <span class="hljs-keyword">var</span> constraintClauses = methodDeclarationSyntax.ConstraintClauses.ToFullString().Replace(System.Environment.NewLine, <span class="hljs-string">&quot;&quot;</span>).Trim();<br>    <span class="hljs-keyword">var</span> returnType = methodDeclarationSyntax.ReturnType.ToFullString().Trim();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;returnType&#125;</span> <span class="hljs-subst">&#123;name&#125;</span><span class="hljs-subst">&#123;typeParameters&#125;</span><span class="hljs-subst">&#123;parameters&#125;</span> <span class="hljs-subst">&#123;constraintClauses&#125;</span>&quot;</span>.Trim();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>The information it returns includes: </p>
<ul>
<li>Return type.</li>
<li>Method name.</li>
<li>Type parameter(s), if it is generic.</li>
<li>Method parameter(s) (with type and name).</li>
<li>Constraint Clauses, if it is generic.</li>
</ul>
<p>(26) We check if there is no same method then we add it to our string builder.</p>
<p>(27) Just previous step we check the same condition for adding to our class string builder.</p>
<p>(28) The method needs <code>return</code> keyword or it returns nothing (void).<br>To find out we need another extension method.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// SourceGeneratorExtensions.cs</span><br><br><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">ReturnsVoid</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MethodDeclarationSyntax methodDeclarationSyntax</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> methodDeclarationSyntax.ReturnType.ToFullString().Trim() == <span class="hljs-string">&quot;void&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(29) One of the most important things to consider is whether the method is marked with <code>Obsolete Attribute</code> or not.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// SourceGeneratorExtensions.cs</span><br><br><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">TryGetObsoleteAttribute</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MethodDeclarationSyntax methodDeclarationSyntax, <span class="hljs-keyword">out</span> <span class="hljs-built_in">string</span> text</span>)</span><br>&#123;<br>    <span class="hljs-keyword">var</span> attr = methodDeclarationSyntax.AttributeLists.Where(x =&gt; x <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> &amp;&amp; IsObsolete(x.GetText().ToString())).Select(x =&gt; x.GetText().ToString()).ToList();<br><br>    text = attr.Count != <span class="hljs-number">0</span> ? ReplaceFirst(attr[<span class="hljs-number">0</span>].Trim(), <span class="hljs-string">&quot;Obsolete&quot;</span>, <span class="hljs-string">&quot;System.Obsolete&quot;</span>) : <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">return</span> attr.Count != <span class="hljs-number">0</span>;<br><br>    <span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">IsObsolete</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> text</span>)</span><br>    &#123;<br>        Match match = Regex.Match(text, <span class="hljs-string">@&quot;\[\s*Obsolete[Attribute]*\s*\(&quot;</span>);<br>        <span class="hljs-keyword">return</span> match.Success;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">ReplaceFirst</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> text, <span class="hljs-built_in">string</span> search, <span class="hljs-built_in">string</span> replace</span>)</span><br>    &#123;<br>        <span class="hljs-built_in">int</span> pos = text.IndexOf(search);<br>        <span class="hljs-keyword">if</span> (pos &lt; <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-keyword">return</span> text;<br>        &#125;<br>        <span class="hljs-keyword">return</span> text.Substring(<span class="hljs-number">0</span>, pos) + replace + text.Substring(pos + search.Length);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>If yes, we need to add the same <code>ObsoleteAttribute</code> to top of our new method.</p>
<p>(30) We need to know how call the main static method inside of a wrapper method so we should add another extension method.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetCallableSignatureText</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MethodDeclarationSyntax methodDeclarationSyntax</span>)</span><br>&#123;<br>    <span class="hljs-keyword">var</span> name = methodDeclarationSyntax.Identifier.ValueText;<br>    <span class="hljs-keyword">var</span> parameters = methodDeclarationSyntax.ParameterList.GetParametersText();<br>    <span class="hljs-keyword">var</span> typeParameters = methodDeclarationSyntax.TypeParameterList?.ToFullString().Trim();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;name&#125;</span><span class="hljs-subst">&#123;typeParameters&#125;</span><span class="hljs-subst">&#123;parameters&#125;</span>&quot;</span>.Trim();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetParametersText</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> ParameterListSyntax parameterListSyntax</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (parameterListSyntax == <span class="hljs-literal">null</span> || parameterListSyntax.Parameters.Count == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;()&quot;</span>;<br>    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> parameterListSyntax.Parameters)<br>    &#123;<br>        <span class="hljs-keyword">var</span> variableName = item.Identifier;<br>        <span class="hljs-keyword">var</span> modifiers = item.Modifiers.Select(x =&gt; x.ValueText).ToList();<br>        <span class="hljs-keyword">var</span> modifiersText = modifiers.Count == <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;&quot;</span> : modifiers.Aggregate((a, b) =&gt; a + <span class="hljs-string">&quot; &quot;</span> + b);<br>        result.Add(<span class="hljs-string">$&quot;<span class="hljs-subst">&#123;modifiersText&#125;</span> <span class="hljs-subst">&#123;variableName&#125;</span>&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> result.Count == <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;()&quot;</span> : <span class="hljs-string">$&quot;(<span class="hljs-subst">&#123;result.Aggregate((a, b) =&gt; a + <span class="hljs-string">&quot;, &quot;</span> + b).Trim()&#125;</span>)&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>The information it returns includes: </p>
<ul>
<li>Method name.</li>
<li>Type parameter(s), if it is generic.</li>
<li>Method parameter(s) (with name and without type).</li>
</ul>
<p>Now, We can add the whole wrapper method.</p>
<p>(31) At the end, we should complete our interface and class with final <code>&#125;</code>.</p>
<p>Part one finished. What happens if we want to generate a wrapper for a type?</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// 31</span><br><span class="hljs-comment">// ...</span><br><span class="hljs-comment">// 32</span><br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-comment">// 33</span><br>    <span class="hljs-keyword">var</span> ctor = ((INamedTypeSymbol)attr?.ConstructorArguments[<span class="hljs-number">0</span>].Value);<br>    <span class="hljs-comment">// 34</span><br>    <span class="hljs-keyword">var</span> assemblySymbol = ctor.ContainingAssembly.GlobalNamespace;<br>    <span class="hljs-comment">// 35</span><br>    assemblyName = ctor.ContainingAssembly.Identity.Name;<br>    <span class="hljs-comment">// 36</span><br>    <span class="hljs-keyword">var</span> visitor = <span class="hljs-keyword">new</span> MethodSymbolVisitor(ctor.ToDisplayString());<br>    visitor.Visit(assemblySymbol);<br>    <span class="hljs-comment">// 62</span><br>    sbInterface.AppendLine(_interfaces.Aggregate((a, b) =&gt; a + Environment.NewLine + b) + Environment.NewLine + <span class="hljs-string">&quot;\t&#125;&quot;</span>);<br>    sbClass.AppendLine(_classes.Aggregate((a, b) =&gt; a + Environment.NewLine + b) + Environment.NewLine + <span class="hljs-string">&quot;\t&#125;&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(32) This part is for constructor with a parameter.</p>
<p>(33) Getting the value of the constructor argument.</p>
<p>(34) Getting the assembly information of the type introduced.</p>
<p>(35) Assembly name.</p>
<p>(36) We need a visitor class to know about static methods of the type introduced in the external assembly. We sends the type’s name to the constructor of our visitor because we want to generate wrapper for that type.</p>
<p>To write <code>MethodSymbolVisitor</code> add below code to <code>MockableGenerator</code> class as a <strong>nested class</strong>.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// 37</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title">List</span>&lt;<span class="hljs-title">string</span>&gt; _interfaces</span> = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();<br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title">List</span>&lt;<span class="hljs-title">string</span>&gt; _classes</span> = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();<br><br><span class="hljs-comment">// 38</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MethodSymbolVisitor</span> : <span class="hljs-title">SymbolVisitor</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> _typeName;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MethodSymbolVisitor</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> typeName</span>)</span><br>    &#123;<br>        _typeName = typeName;<br>    &#125;<br>    <span class="hljs-comment">// 39</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VisitNamespace</span>(<span class="hljs-params">INamespaceSymbol symbol</span>)</span><br>    &#123;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> child <span class="hljs-keyword">in</span> symbol.GetMembers())<br>        &#123;<br>            child.Accept(<span class="hljs-keyword">this</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// 40</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VisitNamedType</span>(<span class="hljs-params">INamedTypeSymbol symbol</span>)</span><br>    &#123;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> child <span class="hljs-keyword">in</span> symbol.GetMembers())<br>        &#123;<br>            child.Accept(<span class="hljs-keyword">this</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// 41</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VisitMethod</span>(<span class="hljs-params">IMethodSymbol symbol</span>)</span><br>    &#123;<br>        <span class="hljs-comment">// 42</span><br>        <span class="hljs-keyword">var</span> cls = symbol.ReceiverType;<br>        <span class="hljs-keyword">var</span> isClass = symbol.ReceiverType.TypeKind == TypeKind.Class;<br>        <span class="hljs-keyword">var</span> isPublic = <span class="hljs-built_in">string</span>.Equals(symbol.ReceiverType.DeclaredAccessibility.ToString().ToLowerInvariant(), <span class="hljs-string">&quot;public&quot;</span>, StringComparison.InvariantCultureIgnoreCase);<br>        <br>        <span class="hljs-comment">// 43</span><br>        <span class="hljs-keyword">if</span> (isClass &amp;&amp; isPublic &amp;&amp; symbol.IsStatic &amp;&amp; symbol.MethodKind == MethodKind.Ordinary)<br>        &#123;<br>            <span class="hljs-comment">// 44</span><br>            <span class="hljs-keyword">var</span> className = cls.Name;<br>            <span class="hljs-keyword">var</span> classNameWithNs = cls.ToDisplayString();<br>            <span class="hljs-comment">// 45</span><br>            <span class="hljs-keyword">if</span> (classNameWithNs != _typeName) <span class="hljs-keyword">return</span>;<br>            <span class="hljs-comment">// 46</span><br>            <span class="hljs-keyword">var</span> wrapperClassName = !className.Contains(<span class="hljs-string">&#x27;&lt;&#x27;</span>) ? className + <span class="hljs-string">&quot;Wrapper&quot;</span> : className.Replace(<span class="hljs-string">&quot;&lt;&quot;</span>, <span class="hljs-string">&quot;Wrapper&lt;&quot;</span>);<br>            <span class="hljs-comment">// 47</span><br>            <span class="hljs-keyword">var</span> classTypeParameters = ((INamedTypeSymbol)cls).GetTypeParameters();<br>            <span class="hljs-comment">// 48</span><br>            <span class="hljs-keyword">var</span> wrapperInterfaceName = <span class="hljs-string">$&quot;I<span class="hljs-subst">&#123;wrapperClassName&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span>&quot;</span>;<br>            <span class="hljs-comment">// 49</span><br>            <span class="hljs-keyword">var</span> constraintClauses = ((INamedTypeSymbol)cls).GetConstraintClauses();<br>            <span class="hljs-comment">// 50</span><br>            <span class="hljs-keyword">var</span> baseList = ((INamedTypeSymbol)cls).GetBaseList(wrapperInterfaceName);<br>            <span class="hljs-comment">// 51</span><br>            <span class="hljs-keyword">var</span> returnKeyword = symbol.ReturnsVoid ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;return &quot;</span>;<br>            <span class="hljs-comment">// 52</span><br>            <span class="hljs-keyword">var</span> methodSignature = symbol.GetSignatureText();<br>            <span class="hljs-comment">// 53</span><br>            <span class="hljs-keyword">var</span> callableMethodSignature = symbol.GetCallableSignatureText();<br>            <span class="hljs-comment">// 54</span><br>            <span class="hljs-keyword">var</span> obsoleteAttribute = symbol.GetAttributes().FirstOrDefault(x =&gt; x.ToString().StartsWith(<span class="hljs-string">&quot;System.ObsoleteAttribute(&quot;</span>))?.ToString();<br><br>            <span class="hljs-comment">// 55</span><br>            <span class="hljs-keyword">var</span> interfaceSource = <span class="hljs-string">$&quot;\tpublic partial interface I<span class="hljs-subst">&#123;wrapperClassName&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span> <span class="hljs-subst">&#123;constraintClauses&#125;</span> &#123;&#123;&quot;</span>;<br>            <span class="hljs-keyword">var</span> classSource = <span class="hljs-string">$&quot;\tpublic partial class <span class="hljs-subst">&#123;wrapperClassName&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span> <span class="hljs-subst">&#123;baseList&#125;</span> <span class="hljs-subst">&#123;constraintClauses&#125;</span> &#123;&#123;&quot;</span>;<br><br>            <span class="hljs-comment">// 56</span><br>            <span class="hljs-keyword">if</span> (!_interfaces.Contains(interfaceSource))<br>                _interfaces.Add(interfaceSource);<br><br>            <span class="hljs-comment">// 57</span><br>            <span class="hljs-keyword">if</span> (!_classes.Contains(classSource))<br>                _classes.Add(classSource);<br><br>            <span class="hljs-comment">// 58</span><br>            <span class="hljs-keyword">if</span> (!_interfaces.Contains(methodSignature))<br>            &#123;<br>                _interfaces.Add(<span class="hljs-string">$&quot;\t\t<span class="hljs-subst">&#123;methodSignature&#125;</span>;&quot;</span>);<br>            &#125;<br><br>            <span class="hljs-comment">// 59</span><br>            <span class="hljs-keyword">if</span> (!_classes.Contains(methodSignature))<br>            &#123;<br>                <span class="hljs-comment">// 60</span><br>                <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.IsNullOrEmpty(obsoleteAttribute))<br>                &#123;<br>                    _classes.Add(<span class="hljs-string">$&quot;\t\t[<span class="hljs-subst">&#123;obsoleteAttribute&#125;</span>]&quot;</span>);<br>                &#125;<br>                <span class="hljs-comment">// 61</span><br>                _classes.Add(<span class="hljs-string">$&quot;\t\tpublic <span class="hljs-subst">&#123;methodSignature&#125;</span> &#123;&#123;&quot;</span>);<br>                _classes.Add(<span class="hljs-string">$&quot;\t\t\t<span class="hljs-subst">&#123;returnKeyword&#125;</span><span class="hljs-subst">&#123;classNameWithNs&#125;</span>.<span class="hljs-subst">&#123;callableMethodSignature&#125;</span>;&quot;</span>);<br>                _classes.Add(<span class="hljs-string">&quot;\t\t&#125;&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(37) We need some lists to add our generated source codes.</p>
<p>(38) Our nested <code>MethodSymbolVisitor</code> inherits from <code>SymbolVisitor</code>.</p>
<p>(39) We should first visit <code>Namespace</code> and accepts its members to get to the details we want.</p>
<p>(40) We need to go one step deeper to get to the methods so visit named types and its members.</p>
<p>(41) Now it is the time to get any information we need from methods.</p>
<p>(42) We need to check <code>ReceiverType</code>. It should be a <code>public class</code>.</p>
<p>(43) If the <code>ReceiverType</code> is a <code>public class</code> and also the method symbol is an ordinary static method we should continue our journy.</p>
<p>(44) We are able to get class name and its namespace.</p>
<p>(45) If the current class is not same as what we are expecting so we need to skip the whole process.</p>
<p>(46) Just like part one we add <code>Wrapper</code> at the end of our interface and class name.</p>
<p>(47) Your class may have type parameters (generic).</p>
<p>Add below method to <code>SourceGeneratorExtensions</code> class.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetTypeParameters</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> INamedTypeSymbol namedTypeSymbol</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> namedTypeSymbol.TypeParameters.Length == <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;&quot;</span><br>        : <span class="hljs-string">$&quot;&lt;<span class="hljs-subst">&#123;namedTypeSymbol.TypeParameters.Select(x =&gt; x.Name).Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>)&#125;</span>&gt;&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(48) We create the name and structure of the interface.</p>
<p>(49) If your class is generic, Has it any constraint clauses? With the following extension method we can find out.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// SourceGeneratorExtensions.cs</span><br><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetConstraintClauses</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> INamedTypeSymbol namedTypeSymbol</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (namedTypeSymbol.TypeParameters.Length == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> namedTypeSymbol.TypeParameters)<br>    &#123;<br>        <span class="hljs-keyword">var</span> constraintType = item.ToDisplayString();<br>        <span class="hljs-keyword">var</span> constraintItems = item.ConstraintTypes.Select(x =&gt; x.ToDisplayString()).Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>).Trim();<br>        result.Add(<span class="hljs-string">$&quot;where <span class="hljs-subst">&#123;constraintType&#125;</span> : <span class="hljs-subst">&#123;constraintItems&#125;</span>&quot;</span>.Trim());<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> result.Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span> <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>).Trim();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(50) If it has inherited from a class or implemented interfaces, information can be accessed through the following extension method.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// SourceGeneratorExtensions.cs</span><br><br><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetBaseList</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> INamedTypeSymbol namedTypeSymbol, <span class="hljs-keyword">params</span> <span class="hljs-built_in">string</span>[] others</span>)</span><br>&#123;<br>    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();<br>    <span class="hljs-keyword">if</span> (namedTypeSymbol.BaseType != <span class="hljs-literal">null</span> &amp;&amp; !<span class="hljs-built_in">string</span>.Equals(namedTypeSymbol.BaseType.Name, <span class="hljs-string">&quot;object&quot;</span>, StringComparison.InvariantCultureIgnoreCase))<br>        result.Add(namedTypeSymbol.BaseType.Name);<br>    <span class="hljs-keyword">if</span> (namedTypeSymbol.AllInterfaces.Length != <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> namedTypeSymbol.AllInterfaces)<br>        &#123;<br>            result.Add(item.Name);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (others != <span class="hljs-literal">null</span> &amp;&amp; others.Length != <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> others)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.IsNullOrEmpty(item))<br>                result.Add(item);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> result.Count == <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">$&quot;: <span class="hljs-subst">&#123;result.Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>)&#125;</span>&quot;</span>.Trim();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(51) The method needs <code>return</code> keyword or it returns nothing (void).</p>
<p>(52) We should add our methods to interface so we need to know about its signature.</p>
<p>So add the following extension method to your <code>SourceGeneratorExtensions</code> class.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetSignatureText</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> IMethodSymbol methodSymbol</span>)</span><br>&#123;<br>    <span class="hljs-keyword">var</span> name = methodSymbol.Name;<br><br>    <span class="hljs-keyword">var</span> parametersText = methodSymbol.Parameters.Length == <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;()&quot;</span><br>        : <span class="hljs-string">&quot;(&quot;</span> + methodSymbol.Parameters.Select(x =&gt; getKind(x) + <span class="hljs-string">$&quot; <span class="hljs-subst">&#123;x.Type&#125;</span> &quot;</span> + x.Name + getDefaultValue(x))<br>                          .Aggregate((a, b) =&gt; a + <span class="hljs-string">&quot;, &quot;</span> + b).Trim() + <span class="hljs-string">&quot;)&quot;</span>;<br><br>    <span class="hljs-keyword">var</span> returnType = methodSymbol.ReturnsVoid ? <span class="hljs-string">&quot;void&quot;</span> : methodSymbol.ReturnType.ToDisplayString();<br>    <span class="hljs-keyword">var</span> typeParameters = methodSymbol.TypeParameters.Length == <span class="hljs-number">0</span><br>        ? <span class="hljs-string">&quot;&quot;</span><br>        : <span class="hljs-string">&quot;&lt;&quot;</span> + methodSymbol.TypeParameters.Select(x =&gt; x.Name).Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>).Trim() + <span class="hljs-string">&quot;&gt;&quot;</span>;<br>    <span class="hljs-keyword">var</span> constraintClauses = methodSymbol.TypeParameters.Length == <span class="hljs-number">0</span><br>        ? <span class="hljs-string">&quot;&quot;</span><br>        : methodSymbol.TypeParameters.Select(x =&gt; getConstraintClauses(x)).Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span> <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>)<br>    ;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;returnType&#125;</span> <span class="hljs-subst">&#123;name&#125;</span><span class="hljs-subst">&#123;typeParameters&#125;</span><span class="hljs-subst">&#123;parametersText&#125;</span> <span class="hljs-subst">&#123;constraintClauses&#125;</span>&quot;</span>.Trim();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToStringValue</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> RefKind refKind</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (refKind == RefKind.RefReadOnly) <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ref readonly&quot;</span>;<br>    <span class="hljs-keyword">switch</span> (refKind)<br>    &#123;<br>        <span class="hljs-keyword">case</span> RefKind.Ref:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ref&quot;</span>;<br>        <span class="hljs-keyword">case</span> RefKind.Out:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;out&quot;</span>;<br>        <span class="hljs-keyword">case</span> RefKind.In:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;in&quot;</span>;<br>        <span class="hljs-literal">default</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>&#125;<br>        <br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">getKind</span>(<span class="hljs-params">IParameterSymbol parameterSymbol</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> parameterSymbol.IsParams ? <span class="hljs-string">&quot;params&quot;</span> : parameterSymbol.RefKind.ToStringValue();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">getDefaultValue</span>(<span class="hljs-params">IParameterSymbol parameterSymbol</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (parameterSymbol.HasExplicitDefaultValue)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (parameterSymbol.ExplicitDefaultValue == <span class="hljs-literal">null</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot; = null&quot;</span>;<br>        <span class="hljs-keyword">if</span> (parameterSymbol.ExplicitDefaultValue <span class="hljs-keyword">is</span> <span class="hljs-built_in">bool</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot; = <span class="hljs-subst">&#123;parameterSymbol.ExplicitDefaultValue.ToString().ToLowerInvariant()&#125;</span>&quot;</span>;<br>        <span class="hljs-keyword">if</span> (parameterSymbol.ExplicitDefaultValue <span class="hljs-keyword">is</span> <span class="hljs-built_in">string</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot; = \&quot;<span class="hljs-subst">&#123;parameterSymbol.ExplicitDefaultValue&#125;</span>\&quot;&quot;</span>;<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot; = <span class="hljs-subst">&#123;parameterSymbol.ExplicitDefaultValue&#125;</span>&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">getConstraintClauses</span>(<span class="hljs-params">ITypeParameterSymbol typeParameterSymbol</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (typeParameterSymbol.ConstraintTypes.Length &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">var</span> constraintType = typeParameterSymbol.ToDisplayString();<br>        <span class="hljs-keyword">var</span> constraintItems = typeParameterSymbol.ConstraintTypes.Select(x =&gt; x.ToDisplayString()).Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>).Trim();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot;where <span class="hljs-subst">&#123;constraintType&#125;</span> : <span class="hljs-subst">&#123;constraintItems&#125;</span>&quot;</span>.Trim();<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>The information it returns includes: </p>
<ul>
<li>Return type.</li>
<li>Method name.</li>
<li>Type parameter(s), if it is generic.</li>
<li>Method parameter(s) (with type and name).</li>
<li>Constraint Clauses, if it is generic.</li>
</ul>
<p>(53) We need to know how call the main static method inside of a wrapper method so we should add another extension method.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// SourceGeneratorExtensions.cs</span><br><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetCallableSignatureText</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> IMethodSymbol methodSymbol</span>)</span><br>&#123;<br>    <span class="hljs-keyword">var</span> name = methodSymbol.Name;<br><br>    <span class="hljs-keyword">var</span> parametersText = methodSymbol.Parameters.Length == <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;()&quot;</span><br>        : <span class="hljs-string">&quot;(&quot;</span> + methodSymbol.Parameters.Select(x =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;getKind(x)&#125;</span> <span class="hljs-subst">&#123;x.Name&#125;</span>&quot;</span>)<br>                          .Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>).Trim() + <span class="hljs-string">&quot;)&quot;</span>;<br>    <span class="hljs-keyword">var</span> typeParameters = methodSymbol.TypeParameters.Length == <span class="hljs-number">0</span><br>        ? <span class="hljs-string">&quot;&quot;</span><br>        : <span class="hljs-string">&quot;&lt;&quot;</span> + methodSymbol.TypeParameters.Select(x =&gt; x.Name).Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>).Trim() + <span class="hljs-string">&quot;&gt;&quot;</span>;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;name&#125;</span><span class="hljs-subst">&#123;typeParameters&#125;</span><span class="hljs-subst">&#123;parametersText&#125;</span>&quot;</span>.Trim();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>The information it returns includes: </p>
<ul>
<li>Method name.</li>
<li>Type parameter(s), if it is generic.</li>
<li>Method parameter(s) (with name and without type).</li>
</ul>
<p>(54) Just like the part one, We should check the method has <code>ObsoleteAttribute</code> or not.</p>
<p>(55) It’s time to build the interface and the class.</p>
<p>(56) If the generated source code does not include it, add the interface source.</p>
<p>(57) If the generated source code does not include it, add the class source.</p>
<p>(58) Add the method signature to the interface if does not exist.</p>
<p>(59) Add the method signature to the class if does not exist.</p>
<p>(60) If the method have an <code>ObsoleteAttribute</code> Add it on top of the generated wrapper method too.</p>
<p>(61) With the whole information we have, we are able to complete the wrapper method.</p>
<p>(62) Finally, we should complete our interface and class with final <code>&#125;</code>.</p>
<p>At the end of the <code>foreach</code> we have</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> cls <span class="hljs-keyword">in</span> receiver.Classes)<br>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-comment">// 63</span><br>    <span class="hljs-keyword">var</span> interfaceWrapper = sbInterface.ToString();<br>    <span class="hljs-keyword">var</span> classWrapper = sbClass.ToString();<br>    <span class="hljs-comment">// 64</span><br>    sources.AppendLine(interfaceWrapper);<br>    sources.AppendLine(classWrapper);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(63) Convert our interface and class string builder to string.</p>
<p>(64) And append them to <code>sources</code> variable which we created at the beginning of the source code.</p>
<p>Finally, Our <code>Execute</code> method ends with</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// 65</span><br><span class="hljs-keyword">var</span> defaultUsings = <span class="hljs-keyword">new</span> StringBuilder();<br>defaultUsings.AppendLine(<span class="hljs-string">&quot;using System;&quot;</span>);<br>defaultUsings.AppendLine(<span class="hljs-string">&quot;using System.Collections.Generic;&quot;</span>);<br>defaultUsings.AppendLine(<span class="hljs-string">&quot;using System.Linq;&quot;</span>);<br>defaultUsings.AppendLine(<span class="hljs-string">&quot;using System.Text;&quot;</span>);<br>defaultUsings.AppendLine(<span class="hljs-string">&quot;using System.Threading.Tasks;&quot;</span>);<br><span class="hljs-keyword">var</span> usings = defaultUsings.ToString();<br><span class="hljs-comment">// 66</span><br><span class="hljs-keyword">var</span> src = sources.ToString();<br><span class="hljs-keyword">var</span> @namespace = <span class="hljs-keyword">new</span> StringBuilder();<br>@namespace.AppendLine(usings);<br>@namespace.AppendLine(<span class="hljs-string">$&quot;namespace <span class="hljs-subst">&#123;assemblyName&#125;</span>.MockableGenerated &#123;&#123;&quot;</span>);<br>@namespace.AppendLine(src);<br>@namespace.Append(<span class="hljs-string">&quot;&#125;&quot;</span>);<br><span class="hljs-keyword">var</span> result = @namespace.ToString();<br><span class="hljs-comment">// 67</span><br>context.AddSource(<span class="hljs-string">$&quot;<span class="hljs-subst">&#123;assemblyName&#125;</span>MockableGenerated&quot;</span>, SourceText.From(result,Encoding.UTF8));<br></code></pre></td></tr></table></figure>

<p>(65) We are able to add some default using statements.</p>
<p>(66) To use the end result, we need a specific namespace to aggregate all the generated code. As you can see, the final code is accessible through the following namespace.</p>
<p><code>Assembly name</code> + <code>.MockableGenerated</code> =&gt; <strong>Dapper.MockableGenerated</strong></p>
<p>(67) Finally, we add all the generated source code to the current source so that the compiler knows about it.</p>
<p>Now, It’s time to add <code>MockableStaticGenerator</code> project to <code>DapperSample</code> as a reference project but you should update <code>DapperSample.csproj</code> file as following. </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">ProjectReference</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">&quot;..\MockableStaticGenerator\MockableStaticGenerator.csproj&quot;</span> </span><br><span class="hljs-tag">                    <span class="hljs-attr">OutputItemType</span>=<span class="hljs-string">&quot;Analyzer&quot;</span></span><br><span class="hljs-tag">                    <span class="hljs-attr">ReferenceOutputAssembly</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>This is not a “normal” <code>ProjectReference</code>. It needs the additional ‘OutputItemType’ and ‘ReferenceOutputAssmbly’ attributes to act as an analyzor.</p>
<p>So you should be able to access to generated namespace. No need to use <code>DapperSqlMapper</code> and <code>IDapperSqlMapper</code> any more just update your <code>StudentRepository</code> as following</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// StudentRepository.cs</span><br><br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> System.Data;<br><span class="hljs-keyword">using</span> System;<br><span class="hljs-keyword">using</span> Dapper.MockableGenerated; <span class="hljs-comment">// HERE</span><br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">DapperSample</span><br>&#123;<br>    <span class="hljs-comment">// HERE</span><br>    [<span class="hljs-meta">MockableStatic(typeof(Dapper.SqlMapper))</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StudentRepository</span> : <span class="hljs-title">IStudentRepository</span><br>    &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IDbConnection _dbConnection;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ISqlMapperWrapper _dapperSqlMapper;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">StudentRepository</span>(<span class="hljs-params">IDbConnection dbConnection, ISqlMapperWrapper dapperSqlMapper <span class="hljs-comment">/*HERE*/</span></span>)</span><br>        &#123;            <br>            _dbConnection = dbConnection;<br>            _dapperSqlMapper = dapperSqlMapper;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;Student&gt; <span class="hljs-title">GetStudents</span>(<span class="hljs-params"></span>)</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> _dapperSqlMapper.Query&lt;Student&gt;(_dbConnection, <span class="hljs-string">&quot;SELECT * FROM STUDENT&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>And also <code>DapperSampleTest</code> project and <code>StudentRepositoryTest.cs</code> file.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">using</span> DapperSample;<br><span class="hljs-keyword">using</span> Moq;<br><span class="hljs-keyword">using</span> System.Data;<br><span class="hljs-keyword">using</span> Xunit;<br><span class="hljs-keyword">using</span> Dapper.MockableGenerated; <span class="hljs-comment">// HERE</span><br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">DapperSampleTest</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StudentRepositoryTest</span><br>    &#123;<br>        [<span class="hljs-meta">Fact</span>]<br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">STUDENT_REPOSITORY_TEST</span>(<span class="hljs-params"></span>)</span><br>        &#123;            <br>            <span class="hljs-keyword">var</span> mockConn = <span class="hljs-keyword">new</span> Mock&lt;IDbConnection&gt;();<br>            <span class="hljs-keyword">var</span> mockDapper = <span class="hljs-keyword">new</span> Mock&lt;ISqlMapperWrapper&gt;(); <span class="hljs-comment">// HERE</span><br>            <span class="hljs-keyword">var</span> sut = <span class="hljs-keyword">new</span> StudentRepository(mockConn.Object, mockDapper.Object <span class="hljs-comment">/*HERE*/</span>);<br>            <span class="hljs-keyword">var</span> stu = sut.GetStudents();<br>            Assert.NotNull(stu);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>You can find the whole source code here:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// SourceGeneratorExtensions.cs</span><br><br><span class="hljs-keyword">using</span> Microsoft.CodeAnalysis.CSharp.Syntax;<br><span class="hljs-keyword">using</span> System;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> System.Collections.Immutable;<br><span class="hljs-keyword">using</span> System.Linq;<br><span class="hljs-keyword">using</span> System.Text.RegularExpressions;<br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Microsoft.CodeAnalysis</span><br>&#123;<br>    <span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SourceGeneratorExtensions</span><br>    &#123;<br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToStringValue</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> RefKind refKind</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (refKind == RefKind.RefReadOnly) <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ref readonly&quot;</span>;<br>            <span class="hljs-keyword">switch</span> (refKind)<br>            &#123;<br>                <span class="hljs-keyword">case</span> RefKind.Ref:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ref&quot;</span>;<br>                <span class="hljs-keyword">case</span> RefKind.Out:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;out&quot;</span>;<br>                <span class="hljs-keyword">case</span> RefKind.In:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;in&quot;</span>;<br>                <span class="hljs-literal">default</span>:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsPublic</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> ISymbol symbol</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.Equals(symbol.DeclaredAccessibility.ToString(), <span class="hljs-string">&quot;public&quot;</span>, StringComparison.InvariantCultureIgnoreCase);<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetTypeParameters</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> ClassDeclarationSyntax classDeclarationSyntax</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">var</span> result = classDeclarationSyntax.TypeParameterList?.ToFullString().Trim();<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.IsNullOrEmpty(result) ? <span class="hljs-literal">null</span> : result;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetConstraintClauses</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> ClassDeclarationSyntax classDeclarationSyntax</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">var</span> result = classDeclarationSyntax.ConstraintClauses.ToFullString().Trim();<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.IsNullOrEmpty(result) ? <span class="hljs-literal">null</span> : result;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsPublic</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MethodDeclarationSyntax methodDeclarationSyntax</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> methodDeclarationSyntax.Modifiers.Select(x =&gt; x.ValueText).Contains(<span class="hljs-string">&quot;public&quot;</span>);<br>        &#125;<br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsStatic</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MethodDeclarationSyntax methodDeclarationSyntax</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> methodDeclarationSyntax.Modifiers.Select(x =&gt; x.ValueText).Contains(<span class="hljs-string">&quot;static&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">ReturnsVoid</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MethodDeclarationSyntax methodDeclarationSyntax</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> methodDeclarationSyntax.ReturnType.ToFullString().Trim() == <span class="hljs-string">&quot;void&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetSignatureText</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MethodDeclarationSyntax methodDeclarationSyntax</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">var</span> name = methodDeclarationSyntax.Identifier.ValueText;<br>            <span class="hljs-keyword">var</span> parameters = methodDeclarationSyntax.ParameterList?.ToFullString().Trim();<br>            <span class="hljs-keyword">var</span> typeParameters = methodDeclarationSyntax.TypeParameterList?.ToFullString().Trim();<br>            <span class="hljs-keyword">var</span> constraintClauses = methodDeclarationSyntax.ConstraintClauses.ToFullString().Replace(System.Environment.NewLine, <span class="hljs-string">&quot;&quot;</span>).Trim();<br>            <span class="hljs-keyword">var</span> returnType = methodDeclarationSyntax.ReturnType.ToFullString().Trim();<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;returnType&#125;</span> <span class="hljs-subst">&#123;name&#125;</span><span class="hljs-subst">&#123;typeParameters&#125;</span><span class="hljs-subst">&#123;parameters&#125;</span> <span class="hljs-subst">&#123;constraintClauses&#125;</span>&quot;</span>.Trim();<br>        &#125;<br><br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetParametersText</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> ParameterListSyntax parameterListSyntax</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (parameterListSyntax == <span class="hljs-literal">null</span> || parameterListSyntax.Parameters.Count == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;()&quot;</span>;<br>            <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();<br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> parameterListSyntax.Parameters)<br>            &#123;<br>                <span class="hljs-keyword">var</span> variableName = item.Identifier;<br>                <span class="hljs-keyword">var</span> modifiers = item.Modifiers.Select(x =&gt; x.ValueText).ToList();<br>                <span class="hljs-keyword">var</span> modifiersText = modifiers.Count == <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;&quot;</span> : modifiers.Aggregate((a, b) =&gt; a + <span class="hljs-string">&quot; &quot;</span> + b);<br>                result.Add(<span class="hljs-string">$&quot;<span class="hljs-subst">&#123;modifiersText&#125;</span> <span class="hljs-subst">&#123;variableName&#125;</span>&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">return</span> result.Count == <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;()&quot;</span> : <span class="hljs-string">$&quot;(<span class="hljs-subst">&#123;result.Aggregate((a, b) =&gt; a + <span class="hljs-string">&quot;, &quot;</span> + b).Trim()&#125;</span>)&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetCallableSignatureText</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MethodDeclarationSyntax methodDeclarationSyntax</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">var</span> name = methodDeclarationSyntax.Identifier.ValueText;<br>            <span class="hljs-keyword">var</span> parameters = methodDeclarationSyntax.ParameterList.GetParametersText();<br>            <span class="hljs-keyword">var</span> typeParameters = methodDeclarationSyntax.TypeParameterList?.ToFullString().Trim();<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;name&#125;</span><span class="hljs-subst">&#123;typeParameters&#125;</span><span class="hljs-subst">&#123;parameters&#125;</span>&quot;</span>.Trim();<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">TryGetObsoleteAttribute</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MethodDeclarationSyntax methodDeclarationSyntax, <span class="hljs-keyword">out</span> <span class="hljs-built_in">string</span> text</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">var</span> attr = methodDeclarationSyntax.AttributeLists.Where(x =&gt; x <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> &amp;&amp; IsObsolete(x.GetText().ToString())).Select(x =&gt; x.GetText().ToString()).ToList();<br><br>            text = attr.Count != <span class="hljs-number">0</span> ? ReplaceFirst(attr[<span class="hljs-number">0</span>].Trim(), <span class="hljs-string">&quot;Obsolete&quot;</span>, <span class="hljs-string">&quot;System.Obsolete&quot;</span>) : <span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-keyword">return</span> attr.Count != <span class="hljs-number">0</span>;<br><br>            <span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">IsObsolete</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> text</span>)</span><br>            &#123;<br>                Match match = Regex.Match(text, <span class="hljs-string">@&quot;\[\s*Obsolete[Attribute]*\s*\(&quot;</span>);<br>                <span class="hljs-keyword">return</span> match.Success;<br>            &#125;<br>            <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">ReplaceFirst</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> text, <span class="hljs-built_in">string</span> search, <span class="hljs-built_in">string</span> replace</span>)</span><br>            &#123;<br>                <span class="hljs-built_in">int</span> pos = text.IndexOf(search);<br>                <span class="hljs-keyword">if</span> (pos &lt; <span class="hljs-number">0</span>)<br>                &#123;<br>                    <span class="hljs-keyword">return</span> text;<br>                &#125;<br>                <span class="hljs-keyword">return</span> text.Substring(<span class="hljs-number">0</span>, pos) + replace + text.Substring(pos + search.Length);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetNamespace</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> SyntaxNode syntaxNode</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> syntaxNode.Parent <span class="hljs-keyword">switch</span><br>            &#123;<br>                NamespaceDeclarationSyntax namespaceDeclarationSyntax =&gt; namespaceDeclarationSyntax.Name.ToString(),<br>                <span class="hljs-literal">null</span> =&gt; <span class="hljs-built_in">string</span>.Empty,<br>                _ =&gt; GetNamespace(syntaxNode.Parent)<br>            &#125;;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetTypeParameters</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> INamedTypeSymbol namedTypeSymbol</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> namedTypeSymbol.TypeParameters.Length == <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;&quot;</span><br>                : <span class="hljs-string">$&quot;&lt;<span class="hljs-subst">&#123;namedTypeSymbol.TypeParameters.Select(x =&gt; x.Name).Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>)&#125;</span>&gt;&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetConstraintClauses</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> INamedTypeSymbol namedTypeSymbol</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (namedTypeSymbol.TypeParameters.Length == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();<br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> namedTypeSymbol.TypeParameters)<br>            &#123;<br>                <span class="hljs-keyword">var</span> constraintType = item.ToDisplayString();<br>                <span class="hljs-keyword">var</span> constraintItems = item.ConstraintTypes.Select(x =&gt; x.ToDisplayString()).Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>).Trim();<br>                result.Add(<span class="hljs-string">$&quot;where <span class="hljs-subst">&#123;constraintType&#125;</span> : <span class="hljs-subst">&#123;constraintItems&#125;</span>&quot;</span>.Trim());<br>            &#125;<br><br>            <span class="hljs-keyword">return</span> result.Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span> <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>).Trim();<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetBaseList</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> INamedTypeSymbol namedTypeSymbol, <span class="hljs-keyword">params</span> <span class="hljs-built_in">string</span>[] others</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();<br>            <span class="hljs-keyword">if</span> (namedTypeSymbol.BaseType != <span class="hljs-literal">null</span> &amp;&amp; !<span class="hljs-built_in">string</span>.Equals(namedTypeSymbol.BaseType.Name, <span class="hljs-string">&quot;object&quot;</span>, StringComparison.InvariantCultureIgnoreCase))<br>                result.Add(namedTypeSymbol.BaseType.Name);<br>            <span class="hljs-keyword">if</span> (namedTypeSymbol.AllInterfaces.Length != <span class="hljs-number">0</span>)<br>            &#123;<br>                <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> namedTypeSymbol.AllInterfaces)<br>                &#123;<br>                    result.Add(item.Name);<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (others != <span class="hljs-literal">null</span> &amp;&amp; others.Length != <span class="hljs-number">0</span>)<br>            &#123;<br>                <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> others)<br>                &#123;<br>                    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.IsNullOrEmpty(item))<br>                        result.Add(item);<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span> result.Count == <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">$&quot;: <span class="hljs-subst">&#123;result.Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>)&#125;</span>&quot;</span>.Trim();<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">getKind</span>(<span class="hljs-params">IParameterSymbol parameterSymbol</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> parameterSymbol.IsParams ? <span class="hljs-string">&quot;params&quot;</span> : parameterSymbol.RefKind.ToStringValue();<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">getDefaultValue</span>(<span class="hljs-params">IParameterSymbol parameterSymbol</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (parameterSymbol.HasExplicitDefaultValue)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (parameterSymbol.ExplicitDefaultValue == <span class="hljs-literal">null</span>)<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot; = null&quot;</span>;<br>                <span class="hljs-keyword">if</span> (parameterSymbol.ExplicitDefaultValue <span class="hljs-keyword">is</span> <span class="hljs-built_in">bool</span>)<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot; = <span class="hljs-subst">&#123;parameterSymbol.ExplicitDefaultValue.ToString().ToLowerInvariant()&#125;</span>&quot;</span>;<br>                <span class="hljs-keyword">if</span> (parameterSymbol.ExplicitDefaultValue <span class="hljs-keyword">is</span> <span class="hljs-built_in">string</span>)<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot; = \&quot;<span class="hljs-subst">&#123;parameterSymbol.ExplicitDefaultValue&#125;</span>\&quot;&quot;</span>;<br>                <span class="hljs-keyword">else</span><br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot; = <span class="hljs-subst">&#123;parameterSymbol.ExplicitDefaultValue&#125;</span>&quot;</span>;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">getConstraintClauses</span>(<span class="hljs-params">ITypeParameterSymbol typeParameterSymbol</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (typeParameterSymbol.ConstraintTypes.Length &gt; <span class="hljs-number">0</span>)<br>            &#123;<br>                <span class="hljs-keyword">var</span> constraintType = typeParameterSymbol.ToDisplayString();<br>                <span class="hljs-keyword">var</span> constraintItems = typeParameterSymbol.ConstraintTypes.Select(x =&gt; x.ToDisplayString()).Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>).Trim();<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot;where <span class="hljs-subst">&#123;constraintType&#125;</span> : <span class="hljs-subst">&#123;constraintItems&#125;</span>&quot;</span>.Trim();<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>        &#125;<br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetSignatureText</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> IMethodSymbol methodSymbol</span>)</span><br>        &#123;<br><br>            <span class="hljs-keyword">var</span> name = methodSymbol.Name;<br><br>            <span class="hljs-keyword">var</span> parametersText = methodSymbol.Parameters.Length == <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;()&quot;</span><br>                : <span class="hljs-string">&quot;(&quot;</span> + methodSymbol.Parameters.Select(x =&gt; getKind(x) + <span class="hljs-string">$&quot; <span class="hljs-subst">&#123;x.Type&#125;</span> &quot;</span> + x.Name + getDefaultValue(x))<br>                                  .Aggregate((a, b) =&gt; a + <span class="hljs-string">&quot;, &quot;</span> + b).Trim() + <span class="hljs-string">&quot;)&quot;</span>;<br><br>            <span class="hljs-keyword">var</span> returnType = methodSymbol.ReturnsVoid ? <span class="hljs-string">&quot;void&quot;</span> : methodSymbol.ReturnType.ToDisplayString();<br>            <span class="hljs-keyword">var</span> typeParameters = methodSymbol.TypeParameters.Length == <span class="hljs-number">0</span><br>                ? <span class="hljs-string">&quot;&quot;</span><br>                : <span class="hljs-string">&quot;&lt;&quot;</span> + methodSymbol.TypeParameters.Select(x =&gt; x.Name).Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>).Trim() + <span class="hljs-string">&quot;&gt;&quot;</span>;<br>            <span class="hljs-keyword">var</span> constraintClauses = methodSymbol.TypeParameters.Length == <span class="hljs-number">0</span><br>                ? <span class="hljs-string">&quot;&quot;</span><br>                : methodSymbol.TypeParameters.Select(x =&gt; getConstraintClauses(x)).Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span> <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>)<br>            ;<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;returnType&#125;</span> <span class="hljs-subst">&#123;name&#125;</span><span class="hljs-subst">&#123;typeParameters&#125;</span><span class="hljs-subst">&#123;parametersText&#125;</span> <span class="hljs-subst">&#123;constraintClauses&#125;</span>&quot;</span>.Trim();<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetCallableSignatureText</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> IMethodSymbol methodSymbol</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">var</span> name = methodSymbol.Name;<br><br>            <span class="hljs-keyword">var</span> parametersText = methodSymbol.Parameters.Length == <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;()&quot;</span><br>                : <span class="hljs-string">&quot;(&quot;</span> + methodSymbol.Parameters.Select(x =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;getKind(x)&#125;</span> <span class="hljs-subst">&#123;x.Name&#125;</span>&quot;</span>)<br>                                  .Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>).Trim() + <span class="hljs-string">&quot;)&quot;</span>;<br>            <span class="hljs-keyword">var</span> typeParameters = methodSymbol.TypeParameters.Length == <span class="hljs-number">0</span><br>                ? <span class="hljs-string">&quot;&quot;</span><br>                : <span class="hljs-string">&quot;&lt;&quot;</span> + methodSymbol.TypeParameters.Select(x =&gt; x.Name).Aggregate((a, b) =&gt; <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>&quot;</span>).Trim() + <span class="hljs-string">&quot;&gt;&quot;</span>;<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">$&quot;<span class="hljs-subst">&#123;name&#125;</span><span class="hljs-subst">&#123;typeParameters&#125;</span><span class="hljs-subst">&#123;parametersText&#125;</span>&quot;</span>.Trim();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// MockableGenerator.cs</span><br><span class="hljs-keyword">using</span> Microsoft.CodeAnalysis;<br><span class="hljs-keyword">using</span> Microsoft.CodeAnalysis.CSharp;<br><span class="hljs-keyword">using</span> Microsoft.CodeAnalysis.CSharp.Syntax;<br><span class="hljs-keyword">using</span> Microsoft.CodeAnalysis.Text;<br><span class="hljs-keyword">using</span> System;<br><span class="hljs-keyword">using</span> System.Collections.Generic;<br><span class="hljs-keyword">using</span> System.Linq;<br><span class="hljs-keyword">using</span> System.Text;<br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">MockableStaticGenerator</span><br>&#123;<br>    [<span class="hljs-meta">Generator</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MockableGenerator</span> : <span class="hljs-title">ISourceGenerator</span><br>    &#123;<br>        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title">List</span>&lt;<span class="hljs-title">string</span>&gt; _interfaces</span> = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();<br>        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title">List</span>&lt;<span class="hljs-title">string</span>&gt; _classes</span> = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MethodSymbolVisitor</span> : <span class="hljs-title">SymbolVisitor</span><br>        &#123;<br>            <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> _typeName;<br><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MethodSymbolVisitor</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> typeName</span>)</span><br>            &#123;<br>                _typeName = typeName;<br>            &#125;<br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VisitNamespace</span>(<span class="hljs-params">INamespaceSymbol symbol</span>)</span><br>            &#123;<br>                <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> child <span class="hljs-keyword">in</span> symbol.GetMembers())<br>                &#123;<br>                    child.Accept(<span class="hljs-keyword">this</span>);<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VisitNamedType</span>(<span class="hljs-params">INamedTypeSymbol symbol</span>)</span><br>            &#123;<br>                <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> child <span class="hljs-keyword">in</span> symbol.GetMembers())<br>                &#123;<br>                    child.Accept(<span class="hljs-keyword">this</span>);<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VisitMethod</span>(<span class="hljs-params">IMethodSymbol symbol</span>)</span><br>            &#123;<br>                <span class="hljs-keyword">var</span> cls = symbol.ReceiverType;<br>                <span class="hljs-keyword">var</span> isClass = symbol.ReceiverType.TypeKind == TypeKind.Class;<br>                <span class="hljs-keyword">var</span> isPublic = <span class="hljs-built_in">string</span>.Equals(symbol.ReceiverType.DeclaredAccessibility.ToString().ToLowerInvariant(), <span class="hljs-string">&quot;public&quot;</span>, StringComparison.InvariantCultureIgnoreCase);<br>                <span class="hljs-keyword">if</span> (isClass &amp;&amp; isPublic &amp;&amp; symbol.IsStatic &amp;&amp; symbol.MethodKind == MethodKind.Ordinary)<br>                &#123;<br>                    <span class="hljs-keyword">var</span> className = cls.Name;<br>                    <span class="hljs-keyword">var</span> classNameWithNs = cls.ToDisplayString();<br>                    <span class="hljs-keyword">if</span> (classNameWithNs != _typeName) <span class="hljs-keyword">return</span>;<br><br>                    <span class="hljs-keyword">var</span> wrapperClassName = !className.Contains(<span class="hljs-string">&#x27;&lt;&#x27;</span>) ? className + <span class="hljs-string">&quot;Wrapper&quot;</span> : className.Replace(<span class="hljs-string">&quot;&lt;&quot;</span>, <span class="hljs-string">&quot;Wrapper&lt;&quot;</span>);<br>                    <span class="hljs-keyword">var</span> classTypeParameters = ((INamedTypeSymbol)cls).GetTypeParameters();<br>                    <span class="hljs-keyword">var</span> wrapperInterfaceName = <span class="hljs-string">$&quot;I<span class="hljs-subst">&#123;wrapperClassName&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span>&quot;</span>;<br>                    <span class="hljs-keyword">var</span> constraintClauses = ((INamedTypeSymbol)cls).GetConstraintClauses();<br>                    <span class="hljs-keyword">var</span> baseList = ((INamedTypeSymbol)cls).GetBaseList(wrapperInterfaceName);<br>                    <span class="hljs-keyword">var</span> returnKeyword = symbol.ReturnsVoid ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;return &quot;</span>;<br>                    <span class="hljs-keyword">var</span> methodSignature = symbol.GetSignatureText();<br>                    <span class="hljs-keyword">var</span> callableMethodSignature = symbol.GetCallableSignatureText();<br>                    <span class="hljs-keyword">var</span> obsoleteAttribute = symbol.GetAttributes().FirstOrDefault(x =&gt; x.ToString().StartsWith(<span class="hljs-string">&quot;System.ObsoleteAttribute(&quot;</span>))?.ToString();<br><br>                    <span class="hljs-keyword">var</span> interfaceSource = <span class="hljs-string">$&quot;\tpublic partial interface I<span class="hljs-subst">&#123;wrapperClassName&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span> <span class="hljs-subst">&#123;constraintClauses&#125;</span> &#123;&#123;&quot;</span>;<br>                    <span class="hljs-keyword">var</span> classSource = <span class="hljs-string">$&quot;\tpublic partial class <span class="hljs-subst">&#123;wrapperClassName&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span> <span class="hljs-subst">&#123;baseList&#125;</span> <span class="hljs-subst">&#123;constraintClauses&#125;</span> &#123;&#123;&quot;</span>;<br><br><br>                    <span class="hljs-keyword">if</span> (!_interfaces.Contains(interfaceSource))<br>                        _interfaces.Add(interfaceSource);<br><br>                    <span class="hljs-keyword">if</span> (!_classes.Contains(classSource))<br>                        _classes.Add(classSource);<br><br>                    <span class="hljs-keyword">if</span> (!_interfaces.Contains(methodSignature))<br>                    &#123;<br>                        _interfaces.Add(<span class="hljs-string">$&quot;\t\t<span class="hljs-subst">&#123;methodSignature&#125;</span>;&quot;</span>);<br>                    &#125;<br><br>                    <span class="hljs-keyword">if</span> (!_classes.Contains(methodSignature))<br>                    &#123;<br>                        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.IsNullOrEmpty(obsoleteAttribute))<br>                        &#123;<br>                            _classes.Add(<span class="hljs-string">$&quot;\t\t[<span class="hljs-subst">&#123;obsoleteAttribute&#125;</span>]&quot;</span>);<br>                        &#125;<br>                        _classes.Add(<span class="hljs-string">$&quot;\t\tpublic <span class="hljs-subst">&#123;methodSignature&#125;</span> &#123;&#123;&quot;</span>);<br>                        _classes.Add(<span class="hljs-string">$&quot;\t\t\t<span class="hljs-subst">&#123;returnKeyword&#125;</span><span class="hljs-subst">&#123;classNameWithNs&#125;</span>.<span class="hljs-subst">&#123;callableMethodSignature&#125;</span>;&quot;</span>);<br>                        _classes.Add(<span class="hljs-string">&quot;\t\t&#125;&quot;</span>);<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Execute</span>(<span class="hljs-params">GeneratorExecutionContext context</span>)</span><br>        &#123;<br>            context.AddSource(<span class="hljs-keyword">nameof</span>(Constants.MockableStaticAttribute), SourceText.From(Constants.MockableStaticAttribute, Encoding.UTF8));<br><br>            <span class="hljs-keyword">if</span> (context.SyntaxReceiver <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> SyntaxReceiver receiver)<br>                <span class="hljs-keyword">return</span>;<br><br>            CSharpParseOptions options = (context.Compilation <span class="hljs-keyword">as</span> CSharpCompilation).SyntaxTrees[<span class="hljs-number">0</span>].Options <span class="hljs-keyword">as</span> CSharpParseOptions;<br>            Compilation compilation = context.Compilation.AddSyntaxTrees(CSharpSyntaxTree.ParseText(SourceText.From(Constants.MockableStaticAttribute, Encoding.UTF8), options));<br>            INamedTypeSymbol attributeSymbol = compilation.GetTypeByMetadataName(<span class="hljs-string">$&quot;System.<span class="hljs-subst">&#123;<span class="hljs-keyword">nameof</span>(Constants.MockableStaticAttribute)&#125;</span>&quot;</span>);<br><br>            <span class="hljs-keyword">var</span> sources = <span class="hljs-keyword">new</span> StringBuilder();<br>            <span class="hljs-keyword">var</span> assemblyName = <span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> cls <span class="hljs-keyword">in</span> receiver.Classes)<br>            &#123;<br>                SemanticModel model = compilation.GetSemanticModel(cls.SyntaxTree);<br>                <span class="hljs-keyword">var</span> clsSymbol = model.GetDeclaredSymbol(cls);<br><br>                <span class="hljs-keyword">var</span> attr = clsSymbol.GetAttributes().FirstOrDefault(ad =&gt; ad.AttributeClass.Equals(attributeSymbol, SymbolEqualityComparer.Default));<br><br>                <span class="hljs-keyword">if</span> (attr == <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>;<br>                <span class="hljs-keyword">var</span> isParameterlessCtor = attr?.ConstructorArguments.Length == <span class="hljs-number">0</span>;<br><br>                <span class="hljs-keyword">var</span> sbInterface = <span class="hljs-keyword">new</span> StringBuilder();<br>                <span class="hljs-keyword">var</span> sbClass = <span class="hljs-keyword">new</span> StringBuilder();<br><br>                <span class="hljs-keyword">if</span> (isParameterlessCtor)<br>                &#123;<br>                    <span class="hljs-keyword">var</span> methods = cls.DescendantNodes().OfType&lt;MethodDeclarationSyntax&gt;().Where(x =&gt; x.IsPublic() &amp;&amp; x.IsStatic()).ToList();<br>                    <span class="hljs-keyword">if</span> (methods.Count == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<br><br>                    <span class="hljs-keyword">var</span> className = clsSymbol.Name;<br>                    <span class="hljs-keyword">var</span> ns = <span class="hljs-built_in">string</span>.IsNullOrEmpty(cls.GetNamespace()) ? <span class="hljs-string">&quot;&quot;</span> : cls.GetNamespace() + <span class="hljs-string">&quot;.&quot;</span>;<br>                    <span class="hljs-keyword">var</span> baseList = <span class="hljs-built_in">string</span>.IsNullOrEmpty(cls.BaseList?.ToFullString()) ? <span class="hljs-string">&quot;:&quot;</span> : cls.BaseList?.ToFullString().Trim() + <span class="hljs-string">&quot;,&quot;</span>;<br>                    assemblyName = clsSymbol.ContainingAssembly.Identity.Name;<br>                    <span class="hljs-keyword">var</span> wrapperClassName = !className.Contains(<span class="hljs-string">&#x27;&lt;&#x27;</span>) ? className + <span class="hljs-string">&quot;Wrapper&quot;</span> : className.Replace(<span class="hljs-string">&quot;&lt;&quot;</span>, <span class="hljs-string">&quot;Wrapper&lt;&quot;</span>);<br>                    <span class="hljs-keyword">var</span> classTypeParameters = cls.GetTypeParameters() ?? <span class="hljs-string">&quot;&quot;</span>;<br>                    <span class="hljs-keyword">var</span> constraintClauses = cls.GetConstraintClauses() ?? <span class="hljs-string">&quot;&quot;</span>;<br>                    sbInterface.AppendLine(<span class="hljs-string">$&quot;\tpublic partial interface I<span class="hljs-subst">&#123;wrapperClassName&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span> <span class="hljs-subst">&#123;constraintClauses&#125;</span> &#123;&#123;&quot;</span>);<br>                    sbClass.AppendLine(<span class="hljs-string">$&quot;\tpublic partial class <span class="hljs-subst">&#123;wrapperClassName&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span> <span class="hljs-subst">&#123;baseList&#125;</span> I<span class="hljs-subst">&#123;wrapperClassName&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span> <span class="hljs-subst">&#123;constraintClauses&#125;</span> &#123;&#123;&quot;</span>);<br><br>                    <span class="hljs-keyword">foreach</span> (MethodDeclarationSyntax method <span class="hljs-keyword">in</span> methods)<br>                    &#123;<br>                        <span class="hljs-keyword">var</span> text = method.GetSignatureText();<br><br>                        <span class="hljs-keyword">if</span> (!sbInterface.ToString().Contains(text))<br>                            sbInterface.AppendLine(<span class="hljs-string">$&quot;\t\t<span class="hljs-subst">&#123;text&#125;</span>;&quot;</span>);<br><br>                        <span class="hljs-keyword">if</span> (!sbClass.ToString().Contains(text))<br>                        &#123;<br>                            <span class="hljs-keyword">var</span> returnKeyword = method.ReturnsVoid() ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;return &quot;</span>;<br>                            <span class="hljs-keyword">var</span> obsoleteAttrText = <span class="hljs-string">&quot;&quot;</span>;<br>                            <span class="hljs-keyword">var</span> isObsolete = method.TryGetObsoleteAttribute(<span class="hljs-keyword">out</span> obsoleteAttrText);<br>                            <span class="hljs-keyword">if</span> (isObsolete)<br>                                sbClass.AppendLine(<span class="hljs-string">$&quot;\t\t<span class="hljs-subst">&#123;obsoleteAttrText&#125;</span>&quot;</span>);<br><br>                            sbClass.AppendLine(<span class="hljs-string">$&quot;\t\tpublic <span class="hljs-subst">&#123;method.GetSignatureText()&#125;</span> &#123;&#123;&quot;</span>);<br>                            sbClass.AppendLine(<span class="hljs-string">$&quot;\t\t\t<span class="hljs-subst">&#123;returnKeyword&#125;</span><span class="hljs-subst">&#123;ns&#125;</span><span class="hljs-subst">&#123;className&#125;</span><span class="hljs-subst">&#123;classTypeParameters&#125;</span>.<span class="hljs-subst">&#123;method.GetCallableSignatureText()&#125;</span>;&quot;</span>);<br>                            sbClass.AppendLine(<span class="hljs-string">$&quot;\t\t&#125;&#125;&quot;</span>);<br>                        &#125;<br>                    &#125;<br><br>                    sbInterface.AppendLine(<span class="hljs-string">$&quot;\t&#125;&#125;&quot;</span>);<br>                    sbClass.AppendLine(<span class="hljs-string">$&quot;\t&#125;&#125;&quot;</span>);<br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    <span class="hljs-keyword">var</span> ctor = ((INamedTypeSymbol)attr?.ConstructorArguments[<span class="hljs-number">0</span>].Value);<br>                    <span class="hljs-keyword">var</span> assemblySymbol = ctor.ContainingAssembly.GlobalNamespace;<br>                    assemblyName = ctor.ContainingAssembly.Identity.Name;<br>                    <span class="hljs-keyword">var</span> visitor = <span class="hljs-keyword">new</span> MethodSymbolVisitor(ctor.ToDisplayString());<br>                    visitor.Visit(assemblySymbol);<br>                    sbInterface.AppendLine(_interfaces.Aggregate((a, b) =&gt; a + Environment.NewLine + b) + Environment.NewLine + <span class="hljs-string">&quot;\t&#125;&quot;</span>);<br>                    sbClass.AppendLine(_classes.Aggregate((a, b) =&gt; a + Environment.NewLine + b) + Environment.NewLine + <span class="hljs-string">&quot;\t&#125;&quot;</span>);<br>                &#125;<br><br>                <span class="hljs-keyword">var</span> interfaceWrapper = sbInterface.ToString();<br>                <span class="hljs-keyword">var</span> classWrapper = sbClass.ToString();<br><br>                sources.AppendLine(interfaceWrapper);<br>                sources.AppendLine(classWrapper);<br>            &#125;<br><br>            <span class="hljs-keyword">var</span> defaultUsings = <span class="hljs-keyword">new</span> StringBuilder();<br>            defaultUsings.AppendLine(<span class="hljs-string">&quot;using System;&quot;</span>);<br>            defaultUsings.AppendLine(<span class="hljs-string">&quot;using System.Collections.Generic;&quot;</span>);<br>            defaultUsings.AppendLine(<span class="hljs-string">&quot;using System.Linq;&quot;</span>);<br>            defaultUsings.AppendLine(<span class="hljs-string">&quot;using System.Text;&quot;</span>);<br>            defaultUsings.AppendLine(<span class="hljs-string">&quot;using System.Threading.Tasks;&quot;</span>);<br>            <span class="hljs-keyword">var</span> usings = defaultUsings.ToString();<br><br>            <span class="hljs-keyword">var</span> src = sources.ToString();<br>            <span class="hljs-keyword">var</span> @namespace = <span class="hljs-keyword">new</span> StringBuilder();<br>            @namespace.AppendLine(usings);<br>            @namespace.AppendLine(<span class="hljs-string">$&quot;namespace <span class="hljs-subst">&#123;assemblyName&#125;</span>.MockableGenerated &#123;&#123;&quot;</span>);<br>            @namespace.AppendLine(src);<br>            @namespace.Append(<span class="hljs-string">&quot;&#125;&quot;</span>);<br>            <span class="hljs-keyword">var</span> result = @namespace.ToString();<br><br>            context.AddSource(<span class="hljs-string">$&quot;<span class="hljs-subst">&#123;assemblyName&#125;</span>MockableGenerated&quot;</span>, SourceText.From(result, Encoding.UTF8));<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Initialize</span>(<span class="hljs-params">GeneratorInitializationContext context</span>)</span><br>        &#123;<br>            <span class="hljs-comment">// System.Diagnostics.Debugger.Launch();</span><br>            context.RegisterForSyntaxNotifications(() =&gt; <span class="hljs-keyword">new</span> SyntaxReceiver());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/images/the-dotnet-world-csharp-source-generator/generated.png"></p>
<h2 id="Visual-Studio-does-not-detect-my-source-generators-What-should-I-do"><a href="#Visual-Studio-does-not-detect-my-source-generators-What-should-I-do" class="headerlink" title="Visual Studio does not detect my source generators, What should I do?"></a>Visual Studio does not detect my source generators, What should I do?</h2><p>Unfortunately, the current version of Visual Studio (16.8.2) has a lot of problems while you are using code generators, but you can try the following steps.</p>
<ol start="0">
<li>Make sure you follow the steps above correctly.</li>
<li>Use <code>dotnet clean</code>, Maybe you need to delete all <code>bin</code> and <code>obj</code> folders.</li>
<li>After that, use <code>dotnet build</code> to make sure your source code has no error and the problem is caused by Visual Studio.</li>
<li>Reset your Visual Studio.</li>
</ol>
<h2 id="How-to-debug-it"><a href="#How-to-debug-it" class="headerlink" title="How to debug it?"></a>How to debug it?</h2><p>To start debug you can add <code>System.Diagnostics.Debugger.Launch();</code> as following:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Initialize</span>(<span class="hljs-params">GeneratorInitializationContext context</span>)</span><br>&#123;<br>    System.Diagnostics.Debugger.Launch(); <span class="hljs-comment">// HERE</span><br>    context.RegisterForSyntaxNotifications(() =&gt; <span class="hljs-keyword">new</span> SyntaxReceiver());<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Run the debugger and you will see it stops at <code>System.Diagnostics.Debugger.Launch()</code> line.</p>
<p><img src="/images/the-dotnet-world-csharp-source-generator/debugger1.png"></p>
<p><img src="/images/the-dotnet-world-csharp-source-generator/debugger2.png"></p>
<p><img src="/images/the-dotnet-world-csharp-source-generator/debugger3.png"></p>
<p>If you have any problem for debugging, like what I had before</p>
<p><img src="/images/the-dotnet-world-csharp-source-generator/managed.png"></p>
<p>Make sure you are running Visual Studio as administrator.</p>
<p><strong>Open Visual Studio as Administrator</strong></p>
<p>If you want to start Visual Studio as Administrator you can do the following:</p>
<ul>
<li>Right-click on your VS task bar shortcut</li>
<li>Right-click on your VS product and select Properties</li>
<li>From Properties window select Advanced…</li>
<li>From Advanced Properties check on Run as Administrator option</li>
<li>select Ok in Advanced Properties window, Apply and then Ok on VS 2019 Properties.</li>
</ul>
<p><img src="/images/the-dotnet-world-csharp-source-generator/vs1.png"></p>
<p><strong>Open every Visual Studio Solution (.sln) as Administrator</strong></p>
<p>Although not the best idea if you open third-party VS solutions, it may come in handy if you need to open the same solutions as Administrator again and again. To do so, right-click on <code>devenv.exe</code> and select <code>Troubleshoot Compatibility</code>.</p>
<p><img src="/images/the-dotnet-world-csharp-source-generator/vs2.png"></p>
<p>You may then proceed to the following steps:</p>
<ul>
<li>On the Program Compatibility Troubleshooter window, click on Troubleshoot Program</li>
<li>Check The program requires additional permissions and click Next</li>
<li>On the next window, click on Test the program… and VS will open as administrator</li>
<li>Click next and then click on Yes, save these settings for this program</li>
</ul>
<p><img src="/images/the-dotnet-world-csharp-source-generator/vs3.png"></p>
<p>Following the above, whenever you open a solution (.sln) it will always open as Adminsitrator. If you want to disable this function, you will need to follow again the steps above without checking though The Program requires additional permissions.</p>
<h2 id="How-to-work-with-files"><a href="#How-to-work-with-files" class="headerlink" title="How to work with files?"></a>How to work with files?</h2><p>If you are using a specific physical file with source generators you <strong>should</strong> use <code>AdditionalFiles</code> in your <code>csproj</code>.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">AdditionalFiles</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">&quot;People.csv&quot;</span> <span class="hljs-attr">CsvLoadType</span>=<span class="hljs-string">&quot;Startup&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">AdditionalFiles</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">&quot;Cars.csv&quot;</span> <span class="hljs-attr">CsvLoadType</span>=<span class="hljs-string">&quot;OnDemand&quot;</span> <span class="hljs-attr">CacheObjects</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>To access your attributes like <code>CsvLoadType</code> or <code>CacheObjects</code>, You are able to use the following approach:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">static</span> IEnumerable&lt;(CsvLoadType, <span class="hljs-built_in">bool</span>, AdditionalText)&gt; GetLoadOptions(SourceGeneratorContext context)<br>&#123;<br>    <span class="hljs-keyword">foreach</span> (AdditionalText file <span class="hljs-keyword">in</span> context.AdditionalFiles)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (Path.GetExtension(file.Path).Equals(<span class="hljs-string">&quot;.csv&quot;</span>, StringComparison.OrdinalIgnoreCase))<br>        &#123;<br>            <span class="hljs-comment">// HERE</span><br>            context.AnalyzerConfigOptions.GetOptions(file)<br>                .TryGetValue(<span class="hljs-string">&quot;build_metadata.additionalfiles.CsvLoadType&quot;</span>, <span class="hljs-keyword">out</span> <span class="hljs-built_in">string</span>? loadTimeString);<br>            Enum.TryParse(loadTimeString, ignoreCase: <span class="hljs-literal">true</span>, <span class="hljs-keyword">out</span> CsvLoadType loadType);<br><br>            context.AnalyzerConfigOptions.GetOptions(file)<br>                .TryGetValue(<span class="hljs-string">&quot;build_metadata.additionalfiles.CacheObjects&quot;</span>, <span class="hljs-keyword">out</span> <span class="hljs-built_in">string</span>? cacheObjectsString);<br>            <span class="hljs-built_in">bool</span>.TryParse(cacheObjectsString, <span class="hljs-keyword">out</span> <span class="hljs-built_in">bool</span> cacheObjects);<br><br>            <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-title">return</span> (<span class="hljs-params">loadType, cacheObjects, file</span>)</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="How-to-publish-it-through-Nuget"><a href="#How-to-publish-it-through-Nuget" class="headerlink" title="How to publish it through Nuget?"></a>How to publish it through Nuget?</h2><p>To do this you have two important xml blocks in your <code>csproj</code> as folowing.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">PropertyGroup</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">IncludeBuildOutput</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">IncludeBuildOutput</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">PropertyGroup</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">None</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">&quot;$(OutputPath)\$(AssemblyName).dll&quot;</span> <span class="hljs-attr">Pack</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">PackagePath</span>=<span class="hljs-string">&quot;analyzers/dotnet/cs&quot;</span> <span class="hljs-attr">Visible</span>=<span class="hljs-string">&quot;false&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><img src="/images/the-dotnet-world-csharp-source-generator/nuget.png"></p>
<h2 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h2><p>You can check the source of this project and its nuget package from the following addresses:</p>
<p><a target="_blank" rel="noopener" href="https://github.com/HamedFathi/MockableStaticGenerator">GitHub</a></p>
<p><a target="_blank" rel="noopener" href="https://www.nuget.org/packages/MockableStaticGenerator">Nuget</a></p>
<h2 id="Reference-s"><a href="#Reference-s" class="headerlink" title="Reference(s)"></a>Reference(s)</h2><p>Some of the information in this article has gathered from various references.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://makolyte.com/how-to-mock-static-methods/">https://makolyte.com/how-to-mock-static-methods/</a></li>
<li><a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/dotnet/introducing-c-source-generators/">https://devblogs.microsoft.com/dotnet/introducing-c-source-generators/</a></li>
<li><a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/dotnet/new-c-source-generator-samples/">https://devblogs.microsoft.com/dotnet/new-c-source-generator-samples/</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dotnet/roslyn/blob/master/docs/features/source-generators.cookbook.md">https://github.com/dotnet/roslyn/blob/master/docs/features/source-generators.cookbook.md</a></li>
<li><a target="_blank" rel="noopener" href="https://ppolyzos.com/2017/08/08/always-run-visual-studio-as-administrator/">https://ppolyzos.com/2017/08/08/always-run-visual-studio-as-administrator/</a></li>
</ul>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/dotnet/">dotnet</a><a class="link-muted mr-2" rel="tag" href="/tags/dotnet5/">dotnet5</a><a class="link-muted mr-2" rel="tag" href="/tags/sourcegenerator/">sourcegenerator</a><a class="link-muted mr-2" rel="tag" href="/tags/roslyn/">roslyn</a><a class="link-muted mr-2" rel="tag" href="/tags/csharp9/">csharp9</a><a class="link-muted mr-2" rel="tag" href="/tags/csharp/">csharp</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/the-dotnet-world-mixin/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">The .NET World - Mixin</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/write-a-custom-plugin-with-aurelia-2-and-lerna/"><span class="level-item">Write a custom plugin with Aurelia 2 and Lerna</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/pic.png" alt="Hamed Fathi"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Hamed Fathi</p><p class="is-size-6 is-block">Senior Software Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Austria</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">30</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">86</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://twitter.com/Hamed__Fathi" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/hamedfathi"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/hamedfathi"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/Hamed__Fathi"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="StackOverflow" href="https://stackoverflow.com/users/3166171/hamedfathi"><i class="fab fa-stack-overflow"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/hamedfathi88"><i class="fab fa-facebook"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/aspnetcore/"><span class="level-start"><span class="level-item">aspnetcore</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/aspnetcore-api/"><span class="level-start"><span class="level-item">aspnetcore-api</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/aurelia/"><span class="level-start"><span class="level-item">aurelia</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/dotnet/"><span class="level-start"><span class="level-item">dotnet</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/amqp/"><span class="tag">amqp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/api/"><span class="tag">api</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aspnetcore/"><span class="tag">aspnetcore</span><span class="tag">22</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aurelia2/"><span class="tag">aurelia2</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/awesome/"><span class="tag">awesome</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/backgroundtask/"><span class="tag">backgroundtask</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binding/"><span class="tag">binding</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bogus/"><span class="tag">bogus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bootstrap5/"><span class="tag">bootstrap5</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cache/"><span class="tag">cache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/caching/"><span class="tag">caching</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chai/"><span class="tag">chai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cors/"><span class="tag">cors</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp9/"><span class="tag">csharp9</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css-in-js/"><span class="tag">css-in-js</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/default-interface-method/"><span class="tag">default-interface-method</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/di/"><span class="tag">di</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/distributed/"><span class="tag">distributed</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dotnet/"><span class="tag">dotnet</span><span class="tag">26</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dotnet5/"><span class="tag">dotnet5</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dryioc/"><span class="tag">dryioc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/e2e/"><span class="tag">e2e</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/easynetq/"><span class="tag">easynetq</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/emotionjs/"><span class="tag">emotionjs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/end-to-end/"><span class="tag">end-to-end</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/exception/"><span class="tag">exception</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/extension-method/"><span class="tag">extension-method</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fakedata/"><span class="tag">fakedata</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/feature/"><span class="tag">feature</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featureflag/"><span class="tag">featureflag</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featuremanagement/"><span class="tag">featuremanagement</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/file/"><span class="tag">file</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fluentvalidation/"><span class="tag">fluentvalidation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/guard/"><span class="tag">guard</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/header/"><span class="tag">header</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/health/"><span class="tag">health</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/healthcheck/"><span class="tag">healthcheck</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/healthy/"><span class="tag">healthy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hostedservices/"><span class="tag">hostedservices</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/inmemory/"><span class="tag">inmemory</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ioc/"><span class="tag">ioc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jest/"><span class="tag">jest</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lerna/"><span class="tag">lerna</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/localization/"><span class="tag">localization</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log/"><span class="tag">log</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/masstransit/"><span class="tag">masstransit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/messagebroker/"><span class="tag">messagebroker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/middleware/"><span class="tag">middleware</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/miniprofiler/"><span class="tag">miniprofiler</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mixon/"><span class="tag">mixon</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mocha/"><span class="tag">mocha</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/model/"><span class="tag">model</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/modelbinding/"><span class="tag">modelbinding</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/monorepository/"><span class="tag">monorepository</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openapi/"><span class="tag">openapi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pagination/"><span class="tag">pagination</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/paging/"><span class="tag">paging</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pipeline/"><span class="tag">pipeline</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/plugin/"><span class="tag">plugin</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/polly/"><span class="tag">polly</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/profiler/"><span class="tag">profiler</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/puppeteer/"><span class="tag">puppeteer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/queue/"><span class="tag">queue</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rabbitmq/"><span class="tag">rabbitmq</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ratelimit/"><span class="tag">ratelimit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/refit/"><span class="tag">refit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/request/"><span class="tag">request</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/resiliency/"><span class="tag">resiliency</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/response/"><span class="tag">response</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/roslyn/"><span class="tag">roslyn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rss/"><span class="tag">rss</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sourcegenerator/"><span class="tag">sourcegenerator</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sqlserver/"><span class="tag">sqlserver</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swagger/"><span class="tag">swagger</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tailwindcss/"><span class="tag">tailwindcss</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/test/"><span class="tag">test</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testdata/"><span class="tag">testdata</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unhealthy/"><span class="tag">unhealthy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/upload/"><span class="tag">upload</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/validation/"><span class="tag">validation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/versioning/"><span class="tag">versioning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webapi/"><span class="tag">webapi</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webpack/"><span class="tag">webpack</span><span class="tag">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-28T00:00:00.000Z">2023-07-28</time></p><p class="title"><a href="/the-dotnet-world-mixin/">The .NET World - Mixin</a></p><p class="categories"><a href="/categories/dotnet/">dotnet</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-12-08T00:00:00.000Z">2020-12-08</time></p><p class="title"><a href="/the-dotnet-world-csharp-source-generator/">The .NET World - C# Source Generator</a></p><p class="categories"><a href="/categories/dotnet/">dotnet</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-09T00:00:00.000Z">2020-11-09</time></p><p class="title"><a href="/write-a-custom-plugin-with-aurelia-2-and-lerna/">Write a custom plugin with Aurelia 2 and Lerna</a></p><p class="categories"><a href="/categories/aurelia/">aurelia</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-10-23T00:00:00.000Z">2020-10-23</time></p><p class="title"><a href="/a-professional-asp.net-core-api-rabbitmq/">A Professional ASP.NET Core API - RabbitMQ</a></p><p class="categories"><a href="/categories/aspnetcore-api/">aspnetcore-api</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-10-22T00:00:00.000Z">2020-10-22</time></p><p class="title"><a href="/a-professional-asp.net-core-rss/">A Professional ASP.NET Core - RSS</a></p><p class="categories"><a href="/categories/aspnetcore/">aspnetcore</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">July 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Hamed Fathi&#039;s Blog</a><p class="is-size-7"><span>&copy; 2023 Hamed Fathi</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>