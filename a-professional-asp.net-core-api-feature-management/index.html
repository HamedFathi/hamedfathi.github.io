<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>A Professional ASP.NET Core API - Feature Management - Hamed Fathi&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Hamed Fathi&#039;s Blog"><meta name="msapplication-TileImage" content="/img/pic.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Hamed Fathi&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="The .NET Core Feature Management libraries provide idiomatic support for implementing feature flags in a .NET or ASP.NET Core application. These libraries allow you to declaratively add feature flags"><meta property="og:type" content="blog"><meta property="og:title" content="A Professional ASP.NET Core API - Feature Management"><meta property="og:url" content="https://hamedfathi.github.io/a-professional-asp.net-core-api-feature-management/"><meta property="og:site_name" content="Hamed Fathi&#039;s Blog"><meta property="og:description" content="The .NET Core Feature Management libraries provide idiomatic support for implementing feature flags in a .NET or ASP.NET Core application. These libraries allow you to declaratively add feature flags"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://hamedfathi.github.io/img/og_image.png"><meta property="article:published_time" content="2020-10-06T00:00:00.000Z"><meta property="article:modified_time" content="2023-07-28T08:36:42.658Z"><meta property="article:author" content="Hamed Fathi"><meta property="article:tag" content="dotnet"><meta property="article:tag" content="aspnetcore"><meta property="article:tag" content="webapi"><meta property="article:tag" content="featuremanagement"><meta property="article:tag" content="feature"><meta property="article:tag" content="featureflag"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://hamedfathi.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hamedfathi.github.io/a-professional-asp.net-core-api-feature-management/"},"headline":"A Professional ASP.NET Core API - Feature Management","image":["https://hamedfathi.github.io/img/og_image.png"],"datePublished":"2020-10-06T00:00:00.000Z","dateModified":"2023-07-28T08:36:42.658Z","author":{"@type":"Person","name":"Hamed Fathi"},"publisher":{"@type":"Organization","name":"Hamed Fathi's Blog","logo":{"@type":"ImageObject"}},"description":"The .NET Core Feature Management libraries provide idiomatic support for implementing feature flags in a .NET or ASP.NET Core application. These libraries allow you to declaratively add feature flags"}</script><link rel="canonical" href="https://hamedfathi.github.io/a-professional-asp.net-core-api-feature-management/"><link rel="icon" href="/img/pic.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Hamed Fathi&#039;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/hamedfathi"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-10-06T00:00:00.000Z" title="10/6/2020, 12:00:00 AM">2020-10-06</time></span><span class="level-item"><a class="link-muted" href="/categories/aspnetcore-api/">aspnetcore-api</a></span></div></div><h1 class="title is-3 is-size-4-mobile">A Professional ASP.NET Core API - Feature Management</h1><div class="content"><p>The .NET Core <code>Feature Management</code> libraries provide idiomatic support for implementing feature flags in a .NET or ASP.NET Core application. These libraries allow you to declaratively add feature flags to your code so that you don’t have to write all the <code>if</code> statements for them manually.</p>
<span id="more"></span>

<p>Install the below packages</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Install-Package Microsoft.FeatureManagement -Version 2.2.0<br>dotnet add package Microsoft.FeatureManagement --version 2.2.0<br>&lt;PackageReference Include=<span class="hljs-string">&quot;Microsoft.FeatureManagement&quot;</span> Version=<span class="hljs-string">&quot;2.2.0&quot;</span> /&gt;<br><br>Install-Package Microsoft.FeatureManagement.AspNetCore -Version 2.2.0<br>dotnet add package Microsoft.FeatureManagement.AspNetCore --version 2.2.0<br>&lt;PackageReference Include=<span class="hljs-string">&quot;Microsoft.FeatureManagement.AspNetCore&quot;</span> Version=<span class="hljs-string">&quot;2.2.0&quot;</span> /&gt;<br></code></pre></td></tr></table></figure>

<p>The .NET Core feature manager <code>IFeatureManager</code> gets feature flags from the framework’s native configuration system. As a result, you can define your application’s feature flags by using any configuration source that .NET Core supports, including the local appsettings.json file or environment variables. <code>IFeatureManager</code> relies on .NET Core dependency injection. You can register the feature management services by using standard conventions:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Startup.ConfigureServices</span><br><br><span class="hljs-keyword">using</span> Microsoft.FeatureManagement;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><br>    &#123;<br>        services.AddFeatureManagement();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>By default, the feature manager retrieves feature flags from the “FeatureManagement” section of the .NET Core configuration data (<code>appsettings.json</code>). </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-string">&quot;FeatureManagement&quot;</span>: &#123;<br>  <span class="hljs-attr">&quot;MoreResults&quot;</span>: <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>The following example tells the feature manager to read from a different section called “MyFeatureFlags” instead:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Startup.ConfigureServices</span><br><br><span class="hljs-keyword">using</span> Microsoft.FeatureManagement;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><br>    &#123;<br>        services.AddFeatureManagement(options =&gt;<br>        &#123;<br>                options.UseConfiguration(Configuration.GetSection(<span class="hljs-string">&quot;MyFeatureFlags&quot;</span>));<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-string">&quot;MyFeatureFlags&quot;</span>: &#123;<br>  <span class="hljs-attr">&quot;MoreResults&quot;</span>: <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Adding-simple-feature-flags"><a href="#Adding-simple-feature-flags" class="headerlink" title="Adding simple feature flags"></a>Adding simple feature flags</h2><p>The <code>IFeatureManager</code> service allows you to interrogate the feature management system to identify whether a feature flag is enabled or not. <code>IFeatureManager</code> exposes a single method, for checking whether a feature flag is enabled:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs cs">[<span class="hljs-meta">ApiController</span>]<br>[<span class="hljs-meta">Route(<span class="hljs-meta-string">&quot;[controller]&quot;</span>)</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WeatherForecastController</span> : <span class="hljs-title">ControllerBase</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IFeatureManager _featureManager;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span>[] Summaries = <span class="hljs-keyword">new</span>[]<br>    &#123;<br>        <span class="hljs-string">&quot;Freezing&quot;</span>, <span class="hljs-string">&quot;Bracing&quot;</span>, <span class="hljs-string">&quot;Chilly&quot;</span>, <span class="hljs-string">&quot;Cool&quot;</span>, <span class="hljs-string">&quot;Mild&quot;</span>, <span class="hljs-string">&quot;Warm&quot;</span>, <span class="hljs-string">&quot;Balmy&quot;</span>, <span class="hljs-string">&quot;Hot&quot;</span>, <span class="hljs-string">&quot;Sweltering&quot;</span>, <span class="hljs-string">&quot;Scorching&quot;</span><br>    &#125;;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WeatherForecastController</span>(<span class="hljs-params">IFeatureManager featureManager <span class="hljs-comment">/* HERE */</span></span>)</span><br>    &#123;<br>        _featureManager = featureManager;<br>    &#125;<br><br>    [<span class="hljs-meta">HttpGet</span>]<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;WeatherForecast&gt; <span class="hljs-title">Get</span>(<span class="hljs-params"></span>)</span><br>    &#123;<br>        <span class="hljs-keyword">var</span> rng = <span class="hljs-keyword">new</span> Random();<br>        IEnumerable&lt;<span class="hljs-built_in">int</span>&gt; range = <span class="hljs-literal">null</span>;<br>        <br>        <span class="hljs-comment">// HERE</span><br>        <span class="hljs-keyword">if</span> (_featureManager.IsEnabledAsync(<span class="hljs-string">&quot;MoreResults&quot;</span>).GetAwaiter().GetResult())<br>        &#123;<br>            range = Enumerable.Range(<span class="hljs-number">1</span>, <span class="hljs-number">50</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            range = Enumerable.Range(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> range.Select(index =&gt; <span class="hljs-keyword">new</span> WeatherForecast<br>        &#123;<br>            Date = DateTime.Now.AddDays(index),<br>            TemperatureC = rng.Next(<span class="hljs-number">-20</span>, <span class="hljs-number">55</span>),<br>            Summary = Summaries[rng.Next(Summaries.Length)]<br>        &#125;)<br>        .ToArray();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Avoid-strings"><a href="#Avoid-strings" class="headerlink" title="Avoid strings"></a>Avoid strings</h2><p>Feature flags are identified in code using magic-strings: “MoreResults” in the previous example. Instead of scattering these around your code, the official docs recommend creating a <code>FeatureFlags</code> <code>enum</code>, and calling <code>nameof()</code> to reference the values, e.g:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Define your flags in an enum</span><br><span class="hljs-comment">// Be careful not to refactor/rename any typos, as that will break configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> FeatureFlags<br>&#123;<br>    MoreResults<br>&#125;<br><br><span class="hljs-comment">// Reference the feature flags using nameof()</span><br><span class="hljs-keyword">var</span> isEnabled = <span class="hljs-keyword">await</span> _featureManager.IsEnabledAsync(<span class="hljs-keyword">nameof</span>(FeatureFlags.MoreResults));<br></code></pre></td></tr></table></figure>

<p><strong>Static class</strong></p>
<p>Using a static class and string constants, it reduces the verbosity at the call site.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Using a static class separates the &quot;name&quot; of the feature flag</span><br><span class="hljs-comment">// from its string value</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FeatureFlags</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> MoreResults = <span class="hljs-string">&quot;MoreResults&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">// No need for nameof() at the call site</span><br><span class="hljs-keyword">var</span> isEnabled = <span class="hljs-keyword">await</span> _featureManager.IsEnabledAsync(FeatureFlags.MoreResults);<br></code></pre></td></tr></table></figure>

<h2 id="FeatureGate"><a href="#FeatureGate" class="headerlink" title="FeatureGate"></a>FeatureGate</h2><p>We can block access to entire controllers or action methods using the <code>FeatureGate</code> action filter.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// BetaController.cs</span><br><br><span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;<br><span class="hljs-keyword">using</span> Microsoft.FeatureManagement.Mvc;<br><br><span class="hljs-comment">// HERE</span><br>[<span class="hljs-meta">FeatureGate(<span class="hljs-meta-string">&quot;Beta&quot;</span>)</span>] <span class="hljs-comment">// Beta feature flag must be enabled</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BetaController</span> : <span class="hljs-title">Controller</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">Index</span>(<span class="hljs-params"></span>)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> View();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>If you try to navigate to this page (<code>/Beta</code>) when the feature is <code>enabled</code>, you’ll see the View rendered. However, if the Beta feature flag is <code>disabled</code>, you’ll get a <code>404</code> when trying to view the page:</p>
<p>The <code>[FeatureGate]</code> attribute takes an array of feature flags, in its constructor. If <code>any</code> of those features are enabled, the controller is enabled.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cs">[<span class="hljs-meta">FeatureGate(<span class="hljs-meta-string">&quot;Beta&quot;</span>, <span class="hljs-meta-string">&quot;Alpha&quot;</span>)</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BetaController</span> : <span class="hljs-title">Controller</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">Index</span>(<span class="hljs-params"></span>)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> View();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Custom-handling-of-missing-actions"><a href="#Custom-handling-of-missing-actions" class="headerlink" title="Custom handling of missing actions"></a>Custom handling of missing actions</h2><p>If an action is removed due to a feature being disabled, the default is to generate a 404 response. That may be fine for some applications, especially if you’re using error handling middleware to customise error responses to avoid ugly “raw” 404.</p>
<p>However, it’s also possible that you may want to generate a different response in this situation. Maybe you want to redirect users to a “stable” page, return a “join the waiting list” view, or simply return a different response, like a 403 Forbidden.</p>
<p>You can achieve any of these approaches by creating a service that implements the <code>IDisabledFeaturesHandler</code> interface. Implementers are invoked as part of the action filter pipeline, when an action method is “removed” due to a feature being disabled. In the example below, I show how to generate a 403 Forbidden response, but you have access to the whole <code>ActionExecutingContext</code> in the method, so you can do anything you can in a standard action filter:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">using</span> Microsoft.FeatureManagement.Mvc;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">RedirectDisabledFeatureHandler</span> : <span class="hljs-title">IDisabledFeaturesHandler</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">HandleDisabledFeatures</span>(<span class="hljs-params">IEnumerable&lt;<span class="hljs-built_in">string</span>&gt; features, ActionExecutingContext context</span>)</span><br>    &#123;<br>        context.Result = <span class="hljs-keyword">new</span> ForbidResult(); <span class="hljs-comment">// generate a 403</span><br>        <span class="hljs-keyword">return</span> Task.CompletedTask;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>To register the handler, update your call to <code>AddFeatureManagement()</code>:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Startup.ConfigureServices</span><br><br><span class="hljs-keyword">using</span> Microsoft.FeatureManagement;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><br>    &#123;<br>        services.AddFeatureManagement()<br>            .UseDisabledFeaturesHandler(<span class="hljs-keyword">new</span> RedirectDisabledFeatureHandler()); <span class="hljs-comment">/* HERE */</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>With the handler registered, if you now try to access a disabled feature, a 403 response is generated, which is intercepted by the error handling middleware, and you’re redirected to the “Access Denied” page for the app:</p>
<h2 id="Razor"><a href="#Razor" class="headerlink" title="Razor"></a>Razor</h2><p>You can use feature flags inside your Views.</p>
<p><strong>Dependency injection</strong></p>
<p> You can <code>inject</code> the <code>IFeatureManager</code> service into views using dependency injection. You could use the <code>@inject</code> directive, and check for the feature manually:</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-comment">&lt;!-- Inject the service using DI  --&gt;</span><br>@inject  Microsoft.FeatureManagement.IFeatureManager _featureManager; <br><br><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- Check if the feature is enabled  --&gt;</span><br>        @if (await _featureManager.IsEnabledAsync(FeatureFlags.PromotionDiscounts))<br>        &#123;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav-item&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav-link text-dark&quot;</span> <span class="hljs-attr">asp-controller</span>=<span class="hljs-string">&quot;PromotionDiscount&quot;</span> <span class="hljs-attr">asp-action</span>=<span class="hljs-string">&quot;Index&quot;</span>&gt;</span>Discount<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        &#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>Using Tag Helper</strong></p>
<p>If you have any UI elements you want to hide under feature flags you can use the tag helper provided in <code>Microsoft.FeatureManagement.AspNetCore</code> library to do that. </p>
<p>First, you need to add the tag helper to the <code>_ViewImports.cshtml</code> so your views can access it.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cs">@addTagHelper *, Microsoft.FeatureManagement.AspNetCore<br></code></pre></td></tr></table></figure>

<p>Next, you can use <code>&lt;feature&gt;</code> tag helper to wrap the UI elements you want to put behind a feature flag.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml">@model HomeViewModel<br>@&#123;<br>    ViewData[&quot;Title&quot;] = &quot;Home Page&quot;;<br>&#125;<br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-center&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">feature</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;@Features.PromotionDiscounts&quot;</span> <span class="hljs-attr">negate</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;display-4&quot;</span>&gt;</span>Enjoy the latest music from your favorite artist<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">feature</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">feature</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;@Features.PromotionDiscounts&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;display-4&quot;</span>&gt;</span>Enjoy 25% off for selected albums from your favorite artist<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">feature</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">feature</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;@Features.UserSuggestions&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">partial</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;_UserSuggestionsPartial&quot;</span> <span class="hljs-attr">model</span>=<span class="hljs-string">&quot;@Model.Suggestions&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">feature</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>We can use <code>negate</code> attribute and set it to true if you want to show the content between feature tag helper when the feature is disabled.</p>
<h2 id="Dynamic-Features"><a href="#Dynamic-Features" class="headerlink" title="Dynamic Features"></a>Dynamic Features</h2><p>We introduce feature filters, which are a much more powerful way of working with feature flags. These let you enable a feature based on arbitrary data. For example, you could enable a feature based on headers in an incoming request, based on the current time, or based on the current user’s claims.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;FeatureManagement&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;Beta&quot;</span>: <span class="hljs-literal">false</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>With this configuration, the Beta feature flag is always false for all users (until configuration changes). While this will be useful in some cases, you may often want to enable features for only some of your users, or only some of the time.</p>
<p><code>Microsoft.FeatureManagement</code> introduces an interface <code>IFeatureFilter</code> which can be used to decide whether a feature is enabled or not based on any logic you require.</p>
<p><strong>Enabling a feature flag based on the current time with TimeWindowFilter</strong></p>
<p>The <code>TimeWindowFilter</code> does as its name suggests - it enables a feature for a given time window. You provide the start and ending DateTime, and any calls to <code>IFeatureManager.IsEnabledAsync()</code> for the feature will be true only between those times.</p>
<p>Add the feature management services in <code>Startup.ConfigureServices</code>, by calling <code>AddFeatureManagement()</code>, which returns an IFeatureManagementBuilder. You can enable the time window filter by calling <code>AddFeatureFilter&lt;&gt;()</code> on the builder:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Startup.ConfigureServices</span><br><br><span class="hljs-keyword">using</span> Microsoft.FeatureManagement;<br><span class="hljs-keyword">using</span> Microsoft.FeatureManagement.FeatureFilters;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> <br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><br>    &#123;<br>        services.AddFeatureManagement()<br>            .AddFeatureFilter&lt;TimeWindowFilter&gt;(); <span class="hljs-comment">// HERE</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>This adds the <code>IFeatureFilter</code> to your app, but you need to configure it using the configuration system. Each <code>IFeatureFilter</code> can have an associated “settings” object, depending on the implementation. For the <code>TimeWindowFilter</code>, this looks like:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// TimeWindowSettings.cs</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TimeWindowSettings</span><br>&#123;<br>    <span class="hljs-keyword">public</span> DateTimeOffset? Start &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> DateTimeOffset? End &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>So let’s consider a scenario: I want to enable a custom Christmas banner which goes live on boxing day at 2am UTC, and ends three days later at 1am UTC.</p>
<p>We’ll start by creating a feature flag for it in code called <code>ChristmasBanner</code></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FeatureFlags</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> ChristmasBanner = <span class="hljs-string">&quot;ChristmasBanner&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Now we’ll add the configuration. As before, we nest the configuration under the <code>FeatureManagement</code> key and provide the name of the feature. However, instead of using a Boolean for the feature, we use <code>EnabledFor</code>, and specify an array of feature filters.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-string">&quot;FeatureManagement&quot;</span>: &#123;<br>  <span class="hljs-attr">&quot;ChristmasBanner&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;EnabledFor&quot;</span>: [<br>      &#123;<br>        <span class="hljs-attr">&quot;Name&quot;</span>: <span class="hljs-string">&quot;Microsoft.TimeWindow&quot;</span>,<br>        <span class="hljs-attr">&quot;Parameters&quot;</span>: &#123;<br>          <span class="hljs-attr">&quot;Start&quot;</span>: <span class="hljs-string">&quot;26 Dec 2019 02:00:00 +00:00&quot;</span>,<br>          <span class="hljs-attr">&quot;End&quot;</span>: <span class="hljs-string">&quot;29 Dec 2019 01:00:00 +00:00&quot;</span><br>        &#125;<br>      &#125;<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>It’s important you get the configuration correct here. The general pattern is identical for all feature filters:</p>
<ul>
<li>The feature name (“ChristmasBanner”) should be the key of an object:</li>
<li>This object should contains a single property, <code>EnabledFor</code>, which is an array of objects.</li>
<li>Each of the objects in the array represents an <code>IFeatureFilter</code>. For each filter<ul>
<li>Provide the <code>Name</code> of the filter (“Microsoft.TimeWindow” for the <code>TimeWindowFilter</code>)</li>
<li>Optionally provide a <code>Parameters</code> object, which is bound to the settings object of the feature filter (<code>TimeWindowSettings</code> in this case).</li>
</ul>
</li>
<li>If any of the feature filters in the array are satisfied for a given request, the feature is enabled. It is only disabled if all <code>IFeatureFilters</code> indicate it should be disabled.</li>
</ul>
<p>With this configuration, the <code>ChristmasBanner</code> feature flag will return false until <code>DateTime.UtcNow</code> falls between the provided dates:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// WeatherForecastController.cs</span><br><br><span class="hljs-keyword">using</span> Microsoft.FeatureManagement;<br><br>[<span class="hljs-meta">ApiController</span>]<br>[<span class="hljs-meta">Route(<span class="hljs-meta-string">&quot;[controller]&quot;</span>)</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WeatherForecastController</span> : <span class="hljs-title">ControllerBase</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IFeatureManager _featureManager;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WeatherForecastController</span>(<span class="hljs-params">IFeatureManager featureManager</span>)</span><br>    &#123;<br>        _featureManager = featureManager;<br>        <span class="hljs-comment">// only returns true during provided time window</span><br>        <span class="hljs-keyword">var</span> showBanner = <span class="hljs-keyword">await</span>  _featureManager.IsEnabledAsync(FeatureFlags.ChristmasBanner);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>The real benefit to using <code>IFeatureFilters</code> is that you get dynamic behaviour, but you can still control it from configuration.</p>
<p><strong>Note</strong>: that TimeWindowSettings has nullable values for Start and End, to give you open-ended time windows e.g. always enable until a given date, or only enable from a given date.</p>
<p><strong>Rolling features out slowly with PercentageFilter</strong></p>
<p>The <code>PercentageFilter</code> also behaves as you might expect - it only enables a feature for x percent of requests, where x is controlled via settings. Enabling the <code>PercentageFilter</code> follows the same procedure as for <code>TimeWindowFilter</code>.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Startup.ConfigureServices</span><br><br><span class="hljs-keyword">using</span> Microsoft.FeatureManagement;<br><span class="hljs-keyword">using</span> Microsoft.FeatureManagement.FeatureFilters;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> <br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><br>    &#123;<br>        services.AddFeatureManagement()<br>            .AddFeatureFilter&lt;PercentageFilter&gt;(); <span class="hljs-comment">// HERE</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Create a feature flag:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FeatureFlags</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> FancyFonts = <span class="hljs-string">&quot;FancyFonts&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Configure the feature in configuration:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-string">&quot;FeatureManagement&quot;</span>: &#123;<br>  <span class="hljs-attr">&quot;FancyFonts&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;EnabledFor&quot;</span>: [<br>      &#123;<br>        <span class="hljs-attr">&quot;Name&quot;</span>: <span class="hljs-string">&quot;Microsoft.Percentage&quot;</span>,<br>        <span class="hljs-attr">&quot;Parameters&quot;</span>: &#123;<br>          <span class="hljs-attr">&quot;Value&quot;</span>: <span class="hljs-number">10</span><br>        &#125;<br>      &#125;<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>The <code>PercentageSettings</code> object consists of a single int, which is the percentage of the time the flag should be enabled. In the example above, the flag will be enabled for 10% of calls to <code>IFeatureManager.IsEnabledAsync(FeatureFlags.FancyFonts)</code>.</p>
<h2 id="Creating-a-custom-IFeatureFilter"><a href="#Creating-a-custom-IFeatureFilter" class="headerlink" title="Creating a custom IFeatureFilter"></a>Creating a custom IFeatureFilter</h2><p>The example in this post looks for a Claim in the currently logged-in user’s <code>ClaimsPrincipal</code> and enables a feature flag if it’s present. You could use this filter to enable a feature for a subset of your users.</p>
<p>Creating a custom feature filter requires two things:</p>
<ul>
<li>Create a class that derives from <code>IFeatureFilter</code>.</li>
<li>Optionally create a settings class to control your feature filter.</li>
</ul>
<p><strong>Creating the filter settings class</strong></p>
<p>For this example, we want to enable a feature for only those users that have a certain set of claims. For simplicity, I’m only going to require the presence of a claim type and ignore the claim’s value, but extending the example in this post should be simple enough. The settings object contains an array of claim types:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ClaimsFilterSettings</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>[] RequiredClaims &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Implementing IFeatureFilter</strong></p>
<p>To create a feature filter, you must implement the <code>IFeatureFilter</code> interface, which consists of a single method:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IFeatureFilter</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">Evaluate</span>(<span class="hljs-params">FeatureFilterEvaluationContext context</span>)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>The <code>FeatureFilterEvaluationContext</code> argument passed in to the method contains the name of the feature requested, and an <code>IConfiguration</code> object that allows you to access the settings for the feature:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FeatureFilterEvaluationContext</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> FeatureName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> IConfiguration Parameters &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>It’s worth noting that there’s nothing specific to ASP.NET Core here - there’s no <code>HttpContext</code>, and no <code>IServiceProvider</code>. Luckily, your class is pulled from the DI container, so you should be able to get everything you need in your feature filter’s constructor.</p>
<p><strong>Creating the custom feature filter</strong></p>
<p>In order to implement our custom feature filter, we need to know who the current user is for the request. To do so, we need to access the <code>HttpContext</code>. The correct way to do that (when you don’t have direct access to it as you do in MVC controllers etc) is to use the <code>IHttpContextAccessor</code>.</p>
<p>The <code>ClaimsFeatureFilter</code> below takes an <code>IHttpContextAccessor</code> in its constructor and uses the exposed <code>HttpContext</code> to retrieve the current user from the request.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cs">[<span class="hljs-meta">FilterAlias(<span class="hljs-meta-string">&quot;Claims&quot;</span>)</span>] <span class="hljs-comment">// How we will refer to the filter in configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ClaimsFeatureFilter</span> : <span class="hljs-title">IFeatureFilter</span><br>&#123;<br>    <span class="hljs-comment">// Used to access HttpContext</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IHttpContextAccessor _httpContextAccessor;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ClaimsFeatureFilter</span>(<span class="hljs-params">IHttpContextAccessor httpContextAccessor</span>)</span><br>    &#123;<br>        _httpContextAccessor = httpContextAccessor;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">Evaluate</span>(<span class="hljs-params">FeatureFilterEvaluationContext context</span>)</span><br>    &#123;<br>        <span class="hljs-comment">// Get the ClaimsFilterSettings from configuration</span><br>        <span class="hljs-keyword">var</span> settings = context.Parameters.Get&lt;ClaimsFilterSettings&gt;();<br><br>        <span class="hljs-comment">// Retrieve the current user (ClaimsPrincipal)</span><br>        <span class="hljs-keyword">var</span> user = _httpContextAccessor.HttpContext.User;<br><br>        <span class="hljs-comment">// Only enable the feature if the user has ALL the required claims</span><br>        <span class="hljs-keyword">var</span> isEnabled = settings.RequiredClaims<br>            .All(claimType =&gt; user.HasClaim(claim =&gt; claim.Type == claimType));<br><br>        <span class="hljs-keyword">return</span> isEnabled;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>I named this feature filter “Claims” using the <code>[FilterAlias]</code> attribute. This is the string you need to add in configuration to enable the filter, as you’ll see shortly. You can retrieve the <code>ClaimsFilterSettings</code> associated with a given instance of the custom feature filter by calling <code>context.Parameters.Get&lt;&gt;()</code>.</p>
<p>The logic of the filter is relatively straightforward - if the <code>ClaimsPrincipal</code> for the request has all of the required claims, the associated feature is enabled, otherwise the feature is disabled.</p>
<p><strong>Using the custom feature filter</strong></p>
<p>To use the custom feature filter, you must explicitly register it with the feature management system in <code>Startup.ConfigureServices()</code>. We also need to make sure the <code>IHttpContextAccessor</code> is available in DI:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">using</span> Microsoft.FeatureManagement;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> <br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><br>    &#123;<br>        <span class="hljs-comment">// Add IHttpContextAccessor if it&#x27;s not yet added</span><br>        services.AddHttpContextAccessor();<br><br>        services.AddFeatureManagement()<br>            <span class="hljs-comment">// HERE</span><br>            .AddFeatureFilter&lt;ClaimsFeatureFilter&gt;(); <span class="hljs-comment">// add our custom filter</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>That’s all the custom configuration needed to enable our <code>ClaimsFeatureFilter</code>. To actually use it in an app, we’ll add a feature flag called “Beta”:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FeatureFlags</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> Beta = <span class="hljs-string">&quot;Beta&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>and enable the filter in configuration using the format:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-string">&quot;FeatureManagement&quot;</span>: &#123;<br>  <span class="hljs-attr">&quot;Beta&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;EnabledFor&quot;</span>: [<br>      &#123;<br>        <span class="hljs-attr">&quot;Name&quot;</span>: <span class="hljs-string">&quot;Claims&quot;</span>,<br>        <span class="hljs-attr">&quot;Parameters&quot;</span>: &#123;<br>          <span class="hljs-attr">&quot;RequiredClaims&quot;</span>: [ <span class="hljs-string">&quot;Internal&quot;</span> ]<br>        &#125;<br>      &#125;<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Notice that I’ve used the <code>[FilterAlias]</code> value of “Claims” as the filter’s <code>Name</code>. The <code>Parameters</code> object corresponds to the <code>ClaimsFilterSettings</code> settings object. With this configuration, user’s who have the “Internal” claim will have the Beta feature flag enabled - other user’s will find it’s disabled.</p>
<p><strong>Testing the ClaimsFeatureFilter</strong></p>
<p>To test out the feature filter, it’s easiest to start with an ASP.NET Core app that has individual authentication enabled. For demonstration purposes, I updated the home page Index.cshtml to show a banner when the <code>Beta</code> feature flag is enabled using the FeatureTagHelper:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml">@page<br>@model IndexModel<br>@&#123;<br>    ViewData[&quot;Title&quot;] = &quot;Home page&quot;;<br>&#125;<br><br><span class="hljs-comment">&lt;!-- Only visible when Beta feature flag is enabled --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">feature</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;@FeatureFlags.Beta&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert alert-primary&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;alert&quot;</span>&gt;</span><br>        Congratulations - You&#x27;re in the Beta test!<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">feature</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- ... --&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="Limitations-with-the-ClaimsFeatureFilter"><a href="#Limitations-with-the-ClaimsFeatureFilter" class="headerlink" title="Limitations with the ClaimsFeatureFilter"></a>Limitations with the ClaimsFeatureFilter</h2><p>The custom feature filter <code>ClaimsFeatureFilter</code> described in this post is only intended as an example of a filter you could use. The reliance on <code>HttpContext</code> gives it a specific limitation: it can’t be used outside the context of an HTTP request.</p>
<p>Attempting to access HttpContext outside of an HTTP request can result in a NullReferenceException. You also need to be careful about using it in a background thread, as HttpContext is not thread safe.</p>
<p>One of the slightly dangerous implications of this is that consumers of the feature flags don’t necessarily know which features are safe to interrogate in which context. There’s nothing in the following code that suggests it could throw when used on a background thread, or in a hosted service.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">var</span> isEnabled = <span class="hljs-keyword">await</span> _featureManager.IsEnabledAsync(FeatureFlags.Beta); <span class="hljs-comment">// may throw!</span><br></code></pre></td></tr></table></figure>

<p>One basic option to avoid this situation is to use naming conventions for your feature flags. For example, you could use a convention where feature flags prefixed with “UI_” are only considered “safe” to access when withan an HTTP request context.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FeatureFlags</span><br>&#123;<br>    <span class="hljs-comment">// These flags are safe to access in any context</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> NewBranding = <span class="hljs-string">&quot;NewBranding&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> AlternativeColours = <span class="hljs-string">&quot;AlternativeColours&quot;</span>;<br><br>    <span class="hljs-comment">// These flags are only safe to access from an HttpContext-safe request</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Ui</span><br>    &#123;<br>      <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> _prefix = <span class="hljs-string">&quot;UI_&quot;</span>;<br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> Beta = _prefix + <span class="hljs-string">&quot;Beta&quot;</span>;<br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> NewOnboardingExperiences = _prefix + <span class="hljs-string">&quot;NewOnboardingExperiences&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>This at least gives an indication to the caller when the flag is used. Obviously it requires you configure the flags correctly, but it’s a step in the right direction!</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// Flags on the main FeatureFlags class are safe to use everywhere</span><br><span class="hljs-keyword">var</span> isEnabled = <span class="hljs-keyword">await</span> _featureManager.IsEnabledAsync(FeatureFlags.NewBranding); <br><br><span class="hljs-comment">// Flags on the nested Ui class are only safe when HttpContext is available</span><br><span class="hljs-keyword">var</span> isEnabled = <span class="hljs-keyword">await</span> _featureManager.IsEnabledAsync(FeatureFlags.Ui.Beta); <br></code></pre></td></tr></table></figure>

<h2 id="Reference-s"><a href="#Reference-s" class="headerlink" title="Reference(s)"></a>Reference(s)</h2><p>Most of the information in this article has gathered from various references.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/azure-app-configuration/use-feature-flags-dotnet-core">https://docs.microsoft.com/en-us/azure/azure-app-configuration/use-feature-flags-dotnet-core</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/azure-app-configuration/quickstart-feature-flag-aspnet-core">https://docs.microsoft.com/en-us/azure/azure-app-configuration/quickstart-feature-flag-aspnet-core</a></li>
<li><a target="_blank" rel="noopener" href="http://dontcodetired.com/blog/post/Using-the-Microsoft-Feature-Toggle-Library-in-ASPNET-Core-(MicrosoftFeatureManagement)">http://dontcodetired.com/blog/post/Using-the-Microsoft-Feature-Toggle-Library-in-ASPNET-Core-(MicrosoftFeatureManagement)</a></li>
<li><a target="_blank" rel="noopener" href="https://andrewlock.net/introducing-the-microsoft-featuremanagement-library-adding-feature-flags-to-an-asp-net-core-app-part-1/">https://andrewlock.net/introducing-the-microsoft-featuremanagement-library-adding-feature-flags-to-an-asp-net-core-app-part-1/</a></li>
<li><a target="_blank" rel="noopener" href="https://andrewlock.net/filtering-action-methods-with-feature-flags-adding-feature-flags-to-an-asp-net-core-app-part-2/">https://andrewlock.net/filtering-action-methods-with-feature-flags-adding-feature-flags-to-an-asp-net-core-app-part-2/</a></li>
<li><a target="_blank" rel="noopener" href="https://andrewlock.net/creating-dynamic-feature-flags-with-feature-filters-adding-feature-flags-to-an-asp-net-core-app-part-3/">https://andrewlock.net/creating-dynamic-feature-flags-with-feature-filters-adding-feature-flags-to-an-asp-net-core-app-part-3/</a></li>
<li><a target="_blank" rel="noopener" href="https://andrewlock.net/creating-a-custom-feature-filter-adding-feature-flags-to-an-asp-net-core-app-part-4/">https://andrewlock.net/creating-a-custom-feature-filter-adding-feature-flags-to-an-asp-net-core-app-part-4/</a></li>
<li><a target="_blank" rel="noopener" href="https://andrewlock.net/keeping-consistent-feature-flags-across-requests-adding-feature-flags-to-an-asp-net-core-app-part-5/">https://andrewlock.net/keeping-consistent-feature-flags-across-requests-adding-feature-flags-to-an-asp-net-core-app-part-5/</a></li>
<li><a target="_blank" rel="noopener" href="https://kasunkodagoda.com/2020/01/16/implementing-feature-flags-for-asp-net-core-applications-using-microsoft-featuremanagement-library/">https://kasunkodagoda.com/2020/01/16/implementing-feature-flags-for-asp-net-core-applications-using-microsoft-featuremanagement-library/</a></li>
</ul>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/dotnet/">dotnet</a><a class="link-muted mr-2" rel="tag" href="/tags/aspnetcore/">aspnetcore</a><a class="link-muted mr-2" rel="tag" href="/tags/webapi/">webapi</a><a class="link-muted mr-2" rel="tag" href="/tags/featuremanagement/">featuremanagement</a><a class="link-muted mr-2" rel="tag" href="/tags/feature/">feature</a><a class="link-muted mr-2" rel="tag" href="/tags/featureflag/">featureflag</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/a-professional-asp.net-core-api-caching/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">A Professional ASP.NET Core API - Caching</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/a-professional-asp.net-core-api-health-check/"><span class="level-item">A Professional ASP.NET Core API - HealthCheck</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/pic.png" alt="Hamed Fathi"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Hamed Fathi</p><p class="is-size-6 is-block">Senior Software Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Austria</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">30</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">86</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://twitter.com/Hamed__Fathi" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/hamedfathi"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/hamedfathi"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/Hamed__Fathi"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="StackOverflow" href="https://stackoverflow.com/users/3166171/hamedfathi"><i class="fab fa-stack-overflow"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/hamedfathi88"><i class="fab fa-facebook"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/aspnetcore/"><span class="level-start"><span class="level-item">aspnetcore</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/aspnetcore-api/"><span class="level-start"><span class="level-item">aspnetcore-api</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/aurelia/"><span class="level-start"><span class="level-item">aurelia</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/dotnet/"><span class="level-start"><span class="level-item">dotnet</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/amqp/"><span class="tag">amqp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/api/"><span class="tag">api</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aspnetcore/"><span class="tag">aspnetcore</span><span class="tag">22</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aurelia2/"><span class="tag">aurelia2</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/awesome/"><span class="tag">awesome</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/backgroundtask/"><span class="tag">backgroundtask</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binding/"><span class="tag">binding</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bogus/"><span class="tag">bogus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bootstrap5/"><span class="tag">bootstrap5</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cache/"><span class="tag">cache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/caching/"><span class="tag">caching</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chai/"><span class="tag">chai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cors/"><span class="tag">cors</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp9/"><span class="tag">csharp9</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css-in-js/"><span class="tag">css-in-js</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/default-interface-method/"><span class="tag">default-interface-method</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/di/"><span class="tag">di</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/distributed/"><span class="tag">distributed</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dotnet/"><span class="tag">dotnet</span><span class="tag">26</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dotnet5/"><span class="tag">dotnet5</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dryioc/"><span class="tag">dryioc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/e2e/"><span class="tag">e2e</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/easynetq/"><span class="tag">easynetq</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/emotionjs/"><span class="tag">emotionjs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/end-to-end/"><span class="tag">end-to-end</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/exception/"><span class="tag">exception</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/extension-method/"><span class="tag">extension-method</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fakedata/"><span class="tag">fakedata</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/feature/"><span class="tag">feature</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featureflag/"><span class="tag">featureflag</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featuremanagement/"><span class="tag">featuremanagement</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/file/"><span class="tag">file</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fluentvalidation/"><span class="tag">fluentvalidation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/guard/"><span class="tag">guard</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/header/"><span class="tag">header</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/health/"><span class="tag">health</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/healthcheck/"><span class="tag">healthcheck</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/healthy/"><span class="tag">healthy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hostedservices/"><span class="tag">hostedservices</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/inmemory/"><span class="tag">inmemory</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ioc/"><span class="tag">ioc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jest/"><span class="tag">jest</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lerna/"><span class="tag">lerna</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/localization/"><span class="tag">localization</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log/"><span class="tag">log</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/masstransit/"><span class="tag">masstransit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/messagebroker/"><span class="tag">messagebroker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/middleware/"><span class="tag">middleware</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/miniprofiler/"><span class="tag">miniprofiler</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mixon/"><span class="tag">mixon</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mocha/"><span class="tag">mocha</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/model/"><span class="tag">model</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/modelbinding/"><span class="tag">modelbinding</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/monorepository/"><span class="tag">monorepository</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openapi/"><span class="tag">openapi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pagination/"><span class="tag">pagination</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/paging/"><span class="tag">paging</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pipeline/"><span class="tag">pipeline</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/plugin/"><span class="tag">plugin</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/polly/"><span class="tag">polly</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/profiler/"><span class="tag">profiler</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/puppeteer/"><span class="tag">puppeteer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/queue/"><span class="tag">queue</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rabbitmq/"><span class="tag">rabbitmq</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ratelimit/"><span class="tag">ratelimit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/refit/"><span class="tag">refit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/request/"><span class="tag">request</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/resiliency/"><span class="tag">resiliency</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/response/"><span class="tag">response</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/roslyn/"><span class="tag">roslyn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rss/"><span class="tag">rss</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sourcegenerator/"><span class="tag">sourcegenerator</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sqlserver/"><span class="tag">sqlserver</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swagger/"><span class="tag">swagger</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tailwindcss/"><span class="tag">tailwindcss</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/test/"><span class="tag">test</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testdata/"><span class="tag">testdata</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unhealthy/"><span class="tag">unhealthy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/upload/"><span class="tag">upload</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/validation/"><span class="tag">validation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/versioning/"><span class="tag">versioning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webapi/"><span class="tag">webapi</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webpack/"><span class="tag">webpack</span><span class="tag">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-28T00:00:00.000Z">2023-07-28</time></p><p class="title"><a href="/the-dotnet-world-mixin/">The .NET World - Mixin</a></p><p class="categories"><a href="/categories/dotnet/">dotnet</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-12-08T00:00:00.000Z">2020-12-08</time></p><p class="title"><a href="/the-dotnet-world-csharp-source-generator/">The .NET World - C# Source Generator</a></p><p class="categories"><a href="/categories/dotnet/">dotnet</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-09T00:00:00.000Z">2020-11-09</time></p><p class="title"><a href="/write-a-custom-plugin-with-aurelia-2-and-lerna/">Write a custom plugin with Aurelia 2 and Lerna</a></p><p class="categories"><a href="/categories/aurelia/">aurelia</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-10-23T00:00:00.000Z">2020-10-23</time></p><p class="title"><a href="/a-professional-asp.net-core-api-rabbitmq/">A Professional ASP.NET Core API - RabbitMQ</a></p><p class="categories"><a href="/categories/aspnetcore-api/">aspnetcore-api</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-10-22T00:00:00.000Z">2020-10-22</time></p><p class="title"><a href="/a-professional-asp.net-core-rss/">A Professional ASP.NET Core - RSS</a></p><p class="categories"><a href="/categories/aspnetcore/">aspnetcore</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">July 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Hamed Fathi&#039;s Blog</a><p class="is-size-7"><span>&copy; 2023 Hamed Fathi</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>